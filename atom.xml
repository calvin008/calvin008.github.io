<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>王大合</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://weimumu.top/"/>
  <updated>2020-09-25T10:22:49.635Z</updated>
  <id>http://weimumu.top/</id>
  
  <author>
    <name>王大合</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>VUE3.0视频教程2020最新全套应用实战项目</title>
    <link href="http://weimumu.top/2020/ckfi3nyx70002u0nl1j364pqk/"/>
    <id>http://weimumu.top/2020/ckfi3nyx70002u0nl1j364pqk/</id>
    <published>2020-09-02T07:40:30.000Z</published>
    <updated>2020-09-25T10:22:49.635Z</updated>
    
    <content type="html"><![CDATA[<h3 id="vue3-0入门到精通"><a href="#vue3-0入门到精通" class="headerlink" title="vue3.0入门到精通"></a>vue3.0入门到精通</h3><h4 id="vue3-0-安装"><a href="#vue3-0-安装" class="headerlink" title="vue3.0 安装"></a>vue3.0 安装</h4><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="https:///player.bilibili.com/player.html?aid=414394899&bvid=BV13V411S79q&cid=231695368&page=1&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><p>前安装过vue的2.0版本，你需要把2.0相关的删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uni -g vue-cli</span><br></pre></td></tr></table></figure><p>安装vue/cli脚架</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g @vue&#x2F;cli</span><br></pre></td></tr></table></figure><p>检查版本号,目前安装vuecli 4.5.4</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue -V</span><br></pre></td></tr></table></figure><p>创建:在命令窗口输入指令</p><p>选择default vue 3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名称</span><br></pre></td></tr></table></figure><h4 id="vue-composition-API"><a href="#vue-composition-API" class="headerlink" title="vue composition API"></a>vue composition API</h4><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="//player.bilibili.com/player.html?aid=414394899&bvid=BV13V411S79q&cid=233918031&page=2&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><p>vue3.0 侧重于解决代码组织与逻辑复用问题</p><p>目前，我们使用的是“options”API 构建组件。 为了将逻辑添加到Vue组件中，我们填充（options）属性，如data、methods、computed等。 这种方法最大的缺点是，它本身不是一个工作的JavaScript代码。 您需要确切地知道模板中可以访问哪些属性以及this关键字的行为。在底层，Vue编译器需要将此属性转换为工作代码。正因为如此，我们无法从自动建议或类型检查中获益。</p><p>Composition API希望将通过当前组件属性、可用的机制公开为JavaScript函数来解决这个问题。 Vue核心团队将组件Composition API描述为“一套附加的、基于函数的api，允许灵活地组合组件逻辑”。 使用Composition API编写的代码更易读，并且场景不复杂，这使得阅读和学习变得更容易。</p><p>让我们看到一个非常简单的组件示例，它使用新的组件Composition API来理解它是如何工作的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt&#x3D;&quot;Vue logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;msg&#125;&#125;年龄为&#123;&#123;age&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;add&quot;&gt; + &lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;App&#39;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg:&#39;王大合&#39;,</span><br><span class="line">      age:18</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">      this.age +&#x3D; 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h5 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h5><p>vue3.0将组件的逻辑都写在了函数内部,setup()会取代vue2.x的data()函数,返回一个对象,暴露给模板,而且只在初始化的时候调用一次,因为值可以被跟踪,所以我们通过vue3来改变编程习惯</p><p>首先引入ref</p><p>使用数据需要return</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123;ref&#125; from &#39;vue&#39;</span><br><span class="line"></span><br><span class="line">setup() &#123;</span><br><span class="line">   const msg &#x3D; ref(&#39;王大合&#39;)</span><br><span class="line">   const age &#x3D; ref(18)</span><br><span class="line">   function add() &#123;</span><br><span class="line">     age.value +&#x3D;1</span><br><span class="line">   &#125;</span><br><span class="line">   return &#123;msg,age,add&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><strong>computed</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt&#x3D;&quot;Vue logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;msg&#125;&#125;的年龄为&#123;&#123;age&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;double&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;add&quot;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;computed, ref&#125; from &#39;vue&#39;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line"> </span><br><span class="line">  name: &#39;App&#39;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const msg &#x3D; ref(&#39;王大合&#39;)</span><br><span class="line">    const age &#x3D; ref(18)</span><br><span class="line">    const double &#x3D; computed(() &#x3D;&gt;&#123;</span><br><span class="line">      return age.value * 2</span><br><span class="line">    &#125;)</span><br><span class="line">    function add() &#123;</span><br><span class="line">      age.value +&#x3D; 1</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;msg,age,add,double&#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h5><p>在 <code>setup</code> 函数里面， 我们适应了 Vue3.0 的第一个新接口 <code>reactive</code> 它主要是处理你的对象让它经过 <code>Proxy</code> 的加工变为一个响应式的对象，</p><h5 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h5><p>用于将响应式对象变成普通对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt&#x3D;&quot;Vue logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;msg&#125;&#125;的年龄为&#123;&#123;age&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;double&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;add&quot;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;computed, reactive,toRefs&#125; from &#39;vue&#39;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line"> </span><br><span class="line">  name: &#39;App&#39;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const state &#x3D; reactive(&#123;</span><br><span class="line">        msg:&#39;王大合&#39;,</span><br><span class="line">        age:18,</span><br><span class="line">        double : computed(() &#x3D;&gt;&#123;</span><br><span class="line">      return state.age * 2</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function add() &#123;</span><br><span class="line">      state.age +&#x3D; 1</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;...toRefs(state),add&#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="props-和-context"><a href="#props-和-context" class="headerlink" title="props 和 context"></a>props 和 context</h5><p>在 <code>Vue2.0</code> 中我们可以使用 <code>props</code> 属性值完成父子通信，在这里我们需要定义 <code>props</code> 属性去定义接受值的类型，然后我们可以利用 <code>setup</code> 的第一个参数获取 <code>props</code> 使用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line"> </span><br><span class="line">  name: &#39;App&#39;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    Content</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const state &#x3D; reactive(&#123;</span><br><span class="line">        msg:&#39;王大合&#39;,</span><br><span class="line">        age:18,</span><br><span class="line">        double : computed(() &#x3D;&gt;&#123;</span><br><span class="line">      return state.age * 2</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function add() &#123;</span><br><span class="line">      state.age +&#x3D; 1</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;...toRefs(state),add&#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们在 <code>App.vue</code> 里面就可以使用该头部组件，有了上面的 <code>props</code> 我们可以根据传进来的值，让这个头部组件呈现不同的状态。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt&#x3D;&quot;Vue logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;msg&#125;&#125;的年龄为&#123;&#123;age&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;double&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;Content :msg&#x3D;&#39;msg&#39; &#x2F;&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;add&quot;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure><p>这里我新建一个新的组件content,在app.vue中引入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123;data&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref&#125; from &#39;vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line"> name:&#39;content&#39;,</span><br><span class="line"> props:&#123;</span><br><span class="line">     msg:String</span><br><span class="line"> &#125;,</span><br><span class="line"> setup(props) &#123;</span><br><span class="line">     const data &#x3D; ref(props.msg)</span><br><span class="line">     return &#123;data&#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p><code>setup</code> 函数的第二个参数是一个上下文对象，这个上下文对象中包含了一些有用的属性，这些属性在 <code>Vue2.0</code> 中需要通过 <code>this</code> 才能访问到，在 <code>vue3.0</code> 中，访问他们变成以下形式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setup(props, ctx) &#123;</span><br><span class="line">  console.log(ctx) &#x2F;&#x2F; 在 setup() 函数中无法访问到 this</span><br><span class="line">  console.log(this) &#x2F;&#x2F; undefined</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体能访问到以下有用的属性：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- slot</span><br><span class="line">- attrs</span><br><span class="line">- emit</span><br></pre></td></tr></table></figure><p>父组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt&#x3D;&quot;Vue logo&quot; src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;msg&#125;&#125;的年龄为&#123;&#123;age&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;double&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;Content :msg&#x3D;&#39;msg&#39; @change&#x3D;&#39;showName&#39; &#x2F;&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;add&quot;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;computed, reactive,toRefs&#125; from &#39;vue&#39;</span><br><span class="line">import Content from &#39;.&#x2F;components&#x2F;content.vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line"> </span><br><span class="line">  name: &#39;App&#39;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    Content</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  setup() &#123;</span><br><span class="line">    const state &#x3D; reactive(&#123;</span><br><span class="line">        msg:&#39;王大合&#39;,</span><br><span class="line">        age:18,</span><br><span class="line">        double : computed(() &#x3D;&gt;&#123;</span><br><span class="line">          return state.age * 2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    function showName(params) &#123;</span><br><span class="line">        alert(params)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function add() &#123;</span><br><span class="line">      state.age +&#x3D; 1</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;...toRefs(state),add,showName&#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>子组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123;data&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;button @click&#x3D;&quot;changeName&quot;&gt;打个招呼!&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref&#125; from &#39;vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line"> name:&#39;content&#39;,</span><br><span class="line"> props:&#123;</span><br><span class="line">     msg:String</span><br><span class="line"> &#125;,</span><br><span class="line"> setup(props,context) &#123;</span><br><span class="line">     const data &#x3D; ref(props.msg)</span><br><span class="line">    function changeName() &#123;</span><br><span class="line">        context.emit(&#39;change&#39;,&#39;Hello,王大合!&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">     return &#123;data,changeName&#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h5 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h5><p>监听ref</p><p>不指定数据源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const a &#x3D; ref(18)</span><br><span class="line"></span><br><span class="line">watch(()&#x3D;&gt;&#123;</span><br><span class="line">    console.log(a.value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>指定数据源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const a &#x3D; ref(18)</span><br><span class="line"></span><br><span class="line"> watch(a,()&#x3D;&gt; &#123;</span><br><span class="line"></span><br><span class="line">  console.log(a.value)</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure><p>监听reactive</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const state &#x3D; reactive(&#123;</span><br><span class="line">        msg:&#39;王大合&#39;,</span><br><span class="line">        age:18,</span><br><span class="line">        double : computed(() &#x3D;&gt;&#123;</span><br><span class="line">          return state.age * 2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p>不指定数据源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">watch(()&#x3D;&gt;&#123;</span><br><span class="line">    console.log(state.age)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>指定数据源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">watch(()&#x3D;&gt;state.age,()&#x3D;&gt;&#123;</span><br><span class="line">    console.log(state.age)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>回调函数参数以及watche clean</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">watch(() &#x3D;&gt; state.age,(newVal,oldVal,clean)&#x3D;&gt; &#123;</span><br><span class="line">    console.log(state.msg + &quot;去年年纪:&quot;+oldVal +&quot;今年年纪:&quot; + newVal)</span><br><span class="line">    clean(</span><br><span class="line">      ()&#x3D;&gt;&#123;</span><br><span class="line">        console.log(&#39;clean&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h5 id="放弃webpack-使用vite安装vue3-0"><a href="#放弃webpack-使用vite安装vue3-0" class="headerlink" title="放弃webpack,使用vite安装vue3.0"></a>放弃webpack,使用vite安装vue3.0</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install -g create-vite-app</span><br><span class="line">create-vite-app vue3-vite</span><br><span class="line">cd vue3-vite</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;vue3-0入门到精通&quot;&gt;&lt;a href=&quot;#vue3-0入门到精通&quot; class=&quot;headerlink&quot; title=&quot;vue3.0入门到精通&quot;&gt;&lt;/a&gt;vue3.0入门到精通&lt;/h3&gt;&lt;h4 id=&quot;vue3-0-安装&quot;&gt;&lt;a href=&quot;#vue3-0-安
      
    
    </summary>
    
    
      <category term="vue" scheme="http://weimumu.top/categories/vue/"/>
    
    
  </entry>
  
  <entry>
    <title>【unicloud】小程序云开发免费教程-持续更新云开发小程序案例</title>
    <link href="http://weimumu.top/2020/ckfi3nyxf0008u0nl2qksbcfs/"/>
    <id>http://weimumu.top/2020/ckfi3nyxf0008u0nl2qksbcfs/</id>
    <published>2020-08-30T12:22:01.000Z</published>
    <updated>2020-09-01T01:44:07.939Z</updated>
    
    <content type="html"><![CDATA[<h4 id="留言板"><a href="#留言板" class="headerlink" title="留言板"></a>留言板</h4><p>留言板添加</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="https://player.bilibili.com/player.html?aid=668741066&bvid=BV1ya4y1h7VJ&cid=208055744&page=4 &high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><p>留言板查询和删除</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="https://player.bilibili.com/player.html?aid=668741066&bvid=BV1ya4y1h7VJ&cid=208055744&page=5 &high_quality=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><h4 id="uni-id-统一的登录模块"><a href="#uni-id-统一的登录模块" class="headerlink" title="uni-id 统一的登录模块"></a>uni-id 统一的登录模块</h4><ul><li>注册、登录、发送短信验证码、密码加密保存、修改密码、token管理（短信验证码功能需要HBuilderX 2.8.3+）</li><li>三方登录：App中的微信登录、微信小程序中的微信登录、支付宝小程序中的支付宝账户登录</li></ul><h5 id="微信小程序一键登录"><a href="#微信小程序一键登录" class="headerlink" title="微信小程序一键登录"></a>微信小程序一键登录</h5><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="https://player.bilibili.com/player.html?aid=668741066&bvid=BV1ya4y1h7VJ&cid=231106785&page=6 &high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><p>进入uni-id 插件市场链接</p><p> <a href="https://ext.dcloud.net.cn/plugin?id=2116">https://ext.dcloud.net.cn/plugin?id=2116</a></p><p>mainfest.json配置appId</p><p>配置uni-id config appId 和secert</p><p>前端实现</p><p>​    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;content&quot;&gt;</span><br><span class="line">        &lt;image class&#x3D;&quot;logo&quot; src&#x3D;&quot;&#x2F;static&#x2F;weixin.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;text-area&quot; &gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;primary&quot; size&#x3D;&quot;default&quot; open-type&#x3D;&quot;getUserInfo&quot; @getuserinfo&#x3D;&quot;loginByWeixin&quot;&gt;微信一键登录&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                title: &#39;微信登录&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLoad() &#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            getWeixinCode() &#123;</span><br><span class="line">                return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">                    uni.login(&#123;</span><br><span class="line">                        provider: &#39;weixin&#39;,</span><br><span class="line">                        success(res) &#123;</span><br><span class="line">                            console.log(&#39;----------------&#39;)</span><br><span class="line">                            console.log(res);</span><br><span class="line">                            resolve(res.code)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        fail(err) &#123;</span><br><span class="line">                            console.log(&#39;----------------&#39;)</span><br><span class="line">                            console.log(err);</span><br><span class="line">                            reject(new Error(&#39;微信登录失败&#39;))</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            loginByWeixin() &#123;</span><br><span class="line">                this.getWeixinCode().then((code) &#x3D;&gt; &#123;</span><br><span class="line">                    return uniCloud.callFunction(&#123;</span><br><span class="line">                        name: &#39;user-center&#39;,</span><br><span class="line">                        data: &#123;</span><br><span class="line">                            action: &#39;loginByWeixin&#39;,</span><br><span class="line">                            params: &#123;</span><br><span class="line">                                code,</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                        showCancel: false,</span><br><span class="line">                        content: JSON.stringify(res.result)</span><br><span class="line">                    &#125;)</span><br><span class="line">                    if (res.result.code &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        uni.setStorageSync(&#39;uni_id_token&#39;, res.result.token)</span><br><span class="line">                        uni.setStorageSync(&#39;uni_id_token_expired&#39;, res.result.tokenExpired)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).catch((e) &#x3D;&gt; &#123;</span><br><span class="line">                    console.error(e)</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                        showCancel: false,</span><br><span class="line">                        content: &#39;微信登录失败，请稍后再试&#39;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .content &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .logo &#123;</span><br><span class="line">        height: 200rpx;</span><br><span class="line">        width: 200rpx;</span><br><span class="line">        margin-top: 200rpx;</span><br><span class="line">        margin-left: auto;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">        margin-bottom: 50rpx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .text-area &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .title &#123;</span><br><span class="line">        font-size: 36rpx;</span><br><span class="line">        color: #8f8f94;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;留言板&quot;&gt;&lt;a href=&quot;#留言板&quot; class=&quot;headerlink&quot; title=&quot;留言板&quot;&gt;&lt;/a&gt;留言板&lt;/h4&gt;&lt;p&gt;留言板添加&lt;/p&gt;


&lt;div style=&quot;position: relative; width: 100%; height: 0
      
    
    </summary>
    
    
      <category term="unicloud" scheme="http://weimumu.top/categories/unicloud/"/>
    
    
  </entry>
  
  <entry>
    <title>hexo博客嵌入B站视频并且设置为1080p</title>
    <link href="http://weimumu.top/2020/ckfi3nyxe0006u0nlbk53fpg4/"/>
    <id>http://weimumu.top/2020/ckfi3nyxe0006u0nlbk53fpg4/</id>
    <published>2020-08-10T05:43:01.000Z</published>
    <updated>2020-08-11T00:43:04.934Z</updated>
    
    <content type="html"><![CDATA[<div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=711630848&bvid=BV1zD4y1U7za&cid=221376924&page=2&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><h3 id="第一步：获取-B站视频iframe链接"><a href="#第一步：获取-B站视频iframe链接" class="headerlink" title="第一步：获取 B站视频iframe链接"></a>第一步：获取 B站视频iframe链接</h3><h3 id="第二步：将视频包裹在-raw-的-div中"><a href="#第二步：将视频包裹在-raw-的-div中" class="headerlink" title="第二步：将视频包裹在 raw 的 div中"></a>第二步：将视频包裹在 raw 的 div中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;%  raw %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;%  endraw %&#125;</span><br></pre></td></tr></table></figure><p>这样就能显示，但是视频样式过小</p><h3 id="第三步：改变样式"><a href="#第三步：改变样式" class="headerlink" title="第三步：改变样式"></a>第三步：改变样式</h3><p>在raw中添加div;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style&#x3D;&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="第四步-：iframe样式设置"><a href="#第四步-：iframe样式设置" class="headerlink" title="第四步 ：iframe样式设置"></a>第四步 ：iframe样式设置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">style&#x3D;&quot;position: absolute; width: 100%; height: 100%; Left: 0; top: 0;&quot;</span><br></pre></td></tr></table></figure><h3 id="第五步：-默认视频是360P的清晰度，改变src视频路径改为1080P"><a href="#第五步：-默认视频是360P的清晰度，改变src视频路径改为1080P" class="headerlink" title="第五步： 默认视频是360P的清晰度，改变src视频路径改为1080P"></a>第五步： 默认视频是360P的清晰度，改变src视频路径改为1080P</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在网址那加上high_quality&#x3D;1参数，即1080p播放</span><br><span class="line">同上，也是在网址那加上danmaku&#x3D;0，即为关闭弹幕</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        

&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;
&lt;iframe src=&quot;//player.bilibili.com/player.html?aid=71163084
      
    
    </summary>
    
    
      <category term="Hexo" scheme="http://weimumu.top/categories/Hexo/"/>
    
    
  </entry>
  
  <entry>
    <title>【实战】uni-app+unicloud仿奈雪的茶</title>
    <link href="http://weimumu.top/2020/ckfi3nyy8000hu0nl42v8dneo/"/>
    <id>http://weimumu.top/2020/ckfi3nyy8000hu0nl42v8dneo/</id>
    <published>2020-08-07T23:38:39.000Z</published>
    <updated>2020-09-24T01:03:30.829Z</updated>
    
    <content type="html"><![CDATA[<h3 id="项目介绍以及基础配置"><a href="#项目介绍以及基础配置" class="headerlink" title="项目介绍以及基础配置"></a>项目介绍以及基础配置</h3><h4 id="uni-app介绍"><a href="#uni-app介绍" class="headerlink" title="uni-app介绍"></a>uni-app介绍</h4><p><code>uni-app</code> 是一个使用 <a href="https://vuejs.org/">Vue.js</a> 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、H5、以及各种小程序（微信/支付宝/百度/头条/QQ/钉钉/淘宝）、快应用等多个平台。</p><p><code>uni-app</code>在手，做啥都不愁。即使不跨端，<code>uni-app</code>也是更好的小程序开发框架（<a href="https://ask.dcloud.net.cn/article/35947">详见</a>）、更好的App跨平台框架、更方便的H5开发框架。不管领导安排什么样的项目，你都可以快速交付，不需要转换开发思维、不需要更改开发习惯。</p><h4 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h4><blockquote><p>如需看完整教学视频推荐 <a href="https://study.163.com/course/courseMain.htm?courseId=1210177243&share=2&shareId=480000001861437">网易云课堂购买</a></p></blockquote><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="https://player.bilibili.com/player.html?aid=925913445&bvid=BV1BT4y1E7M4&cid=200227222&page=2&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><h4 id="看完整视频付款方式："><a href="#看完整视频付款方式：" class="headerlink" title="看完整视频付款方式："></a>看完整视频付款方式：</h4><p><a href="https://study.163.com/course/courseMain.htm?courseId=1210177243&share=2&shareId=480000001861437">网易云课堂购买</a></p><h4 id="新建uni-app项目以及项目目录"><a href="#新建uni-app项目以及项目目录" class="headerlink" title="新建uni-app项目以及项目目录"></a>新建uni-app项目以及项目目录</h4><p>目录结构：<a href="https://uniapp.dcloud.io/frame">https://uniapp.dcloud.io/frame</a></p><p>项目目录详解</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌─pages               </span><br><span class="line">│  ├─index</span><br><span class="line">│  │  └─index.vue    </span><br><span class="line">│  └─login</span><br><span class="line">│     └─login.vue    </span><br><span class="line">├─static             </span><br><span class="line">├─main.js       </span><br><span class="line">├─App.vue          </span><br><span class="line">├─manifest.json  </span><br><span class="line">└─pages.json            </span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="配置pages-json"><a href="#配置pages-json" class="headerlink" title="配置pages.json"></a>配置pages.json</h4><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="https://player.bilibili.com/player.html?aid=925913445&bvid=BV1BT4y1E7M4&cid=200227222&page=4&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><h4 id="全局样式"><a href="#全局样式" class="headerlink" title="全局样式"></a>全局样式</h4><p>全局样式参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* 全局色彩 *&#x2F;</span><br><span class="line">$color-primary: #ADB838;</span><br><span class="line">$color-success: #4cd964;</span><br><span class="line">$color-warning: #FAB714;</span><br><span class="line">$color-error: #D12E32;</span><br><span class="line"></span><br><span class="line">&#x2F;* 文字基本颜色 *&#x2F;</span><br><span class="line">$text-color-base: #5A5B5C; &#x2F;&#x2F;基本色</span><br><span class="line">$text-color-assist: #919293; &#x2F;&#x2F;辅助色</span><br><span class="line">$text-color-black: #3B3C3E; &#x2F;&#x2F;黑</span><br><span class="line">$text-color-grey: #878889; &#x2F;&#x2F;灰</span><br><span class="line">$text-color-white: #ffffff; &#x2F;&#x2F;白</span><br><span class="line"></span><br><span class="line">&#x2F;* 背景颜色 *&#x2F;</span><br><span class="line">$bg-color: #F1F8FA;</span><br><span class="line">$bg-color-grey: #F5F5F5;</span><br><span class="line">$bg-color-primary: #E8EACF;</span><br><span class="line"></span><br><span class="line">&#x2F;* 边框颜色 *&#x2F;</span><br><span class="line">$border-color:#e2e2e2;</span><br><span class="line"></span><br><span class="line">&#x2F;* 尺寸变量 *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* 文字尺寸 *&#x2F;</span><br><span class="line">$font-size-sm:24rpx;</span><br><span class="line">$font-size-base:28rpx;</span><br><span class="line">$font-size-lg:32rpx;</span><br><span class="line"></span><br><span class="line">&#x2F;* 图片尺寸 *&#x2F;</span><br><span class="line">$img-size-sm:40rpx;</span><br><span class="line">$img-size-base:52rpx;</span><br><span class="line">$img-size-lg:80rpx;</span><br><span class="line"></span><br><span class="line">&#x2F;* Border Radius *&#x2F;</span><br><span class="line">$border-radius-sm: 4rpx;</span><br><span class="line">$border-radius-base: 6rpx;</span><br><span class="line">$border-radius-lg: 12rpx;</span><br><span class="line">$border-radius-circle: 50%;</span><br><span class="line"></span><br><span class="line">&#x2F;* 水平间距 *&#x2F;</span><br><span class="line">$spacing-row-sm: 10px;</span><br><span class="line">$spacing-row-base: 20rpx;</span><br><span class="line">$spacing-row-lg: 30rpx;</span><br><span class="line"></span><br><span class="line">&#x2F;* 垂直间距 *&#x2F;</span><br><span class="line">$spacing-col-sm: 8rpx;</span><br><span class="line">$spacing-col-base: 16rpx;</span><br><span class="line">$spacing-col-lg: 24rpx;</span><br><span class="line"></span><br><span class="line">&#x2F;* 透明度 *&#x2F;</span><br><span class="line">$opacity-disabled: 0.3; &#x2F;&#x2F; 组件禁用态的透明度</span><br><span class="line"></span><br><span class="line">&#x2F;* 文章场景相关 *&#x2F;</span><br><span class="line">$color-title: #2C405A; &#x2F;&#x2F; 文章标题颜色</span><br><span class="line">$font-size-title:40rpx;</span><br><span class="line">$color-subtitle: #555555; &#x2F;&#x2F; 二级标题颜色</span><br><span class="line">$font-size-subtitle:36rpx;</span><br><span class="line">$color-paragraph: #3F536E; &#x2F;&#x2F; 文章段落颜色</span><br><span class="line">$font-size-paragraph:30rpx;</span><br><span class="line"></span><br><span class="line">$box-shadow: 0 20rpx 20rpx -20rpx rgba($color: #333, $alpha: 0.1);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>app.scss定义全局基础样式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line">@import &#39;~@&#x2F;uni.scss&#39;;</span><br><span class="line"></span><br><span class="line">page,</span><br><span class="line">view,</span><br><span class="line">scroll-view,</span><br><span class="line">text,</span><br><span class="line">image,</span><br><span class="line">textarea,</span><br><span class="line">button,</span><br><span class="line">input &#123;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">page &#123;</span><br><span class="line">    background-color: #F1F8FA;</span><br><span class="line">    height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.container &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">button &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line"></span><br><span class="line">​    &amp;[type&#x3D;&#39;primary&#39;] &#123;</span><br><span class="line">​        background-color: $color-primary;</span><br><span class="line">​        color: #ffffff;</span><br><span class="line">​        font-size: $font-size-base;</span><br><span class="line">​        </span><br><span class="line">​        &amp;[disabled] &#123;</span><br><span class="line">​            background-color: #D1D78C;</span><br><span class="line">​        &#125;</span><br><span class="line">​        </span><br><span class="line">​        &amp;[plain] &#123;</span><br><span class="line">​            color: $color-primary;</span><br><span class="line">​            border: 1rpx solid $color-primary;</span><br><span class="line">​        &#125;</span><br><span class="line">​        &amp;.button-hover &#123;</span><br><span class="line">​            background-color: #d5da91;</span><br><span class="line">​        &#125;</span><br><span class="line">​        &amp;::after &#123;</span><br><span class="line">​            border: 0;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    &amp;[type&#x3D;&#39;default&#39;] &#123;</span><br><span class="line">​        &amp;[plain] &#123;</span><br><span class="line">​            color: $text-color-assist;</span><br><span class="line">​            border: 1rpx solid $text-color-assist;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bg-base &#123;</span><br><span class="line">    background-color: $bg-color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bg-white &#123;</span><br><span class="line">    background-color: #ffffff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bg-transparent &#123;</span><br><span class="line">  background-color: transparent !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bg-primary &#123;</span><br><span class="line">    background-color: $color-primary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bg-warning &#123;</span><br><span class="line">    background-color: $color-warning;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.d-flex &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.d-none &#123;</span><br><span class="line">    display: none !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.invisible &#123;</span><br><span class="line">  visibility: hidden !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.d-inline &#123;</span><br><span class="line">    display: inline !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.d-inline-block &#123;</span><br><span class="line">    display: inline-block !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.d-block &#123;</span><br><span class="line">    display: block !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.flex-column &#123;</span><br><span class="line">    -ms-flex-direction: column !important;</span><br><span class="line">    flex-direction: column !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.justify-content-start &#123;</span><br><span class="line">    justify-content: flex-start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.justify-content-end &#123;</span><br><span class="line">    justify-content: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.justify-content-between &#123;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.just-content-center &#123;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.justify-content-evenly &#123;</span><br><span class="line">    justify-content: space-evenly !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.just-content-around &#123;</span><br><span class="line">    justify-content: space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-start &#123;</span><br><span class="line">    align-items: flex-start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-end &#123;</span><br><span class="line">    align-items: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-center &#123;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-between &#123;</span><br><span class="line">    align-items: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-around &#123;</span><br><span class="line">    align-items: space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-stretch &#123;</span><br><span class="line">    align-items: stretch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-items-baseline &#123;</span><br><span class="line">    -ms-flex-align: baseline !important;</span><br><span class="line">    align-items: baseline !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.flex-fill &#123;</span><br><span class="line">    -ms-flex: 1 1 auto !important;</span><br><span class="line">    flex: 1 1 auto !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.flex-wrap &#123;</span><br><span class="line">    -ms-flex-wrap: wrap !important;</span><br><span class="line">    flex-wrap: wrap !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.flex-nowrap &#123;</span><br><span class="line">    -ms-flex-wrap: nowrap !important;</span><br><span class="line">    flex-wrap: nowrap !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.flex-shrink-0 &#123;</span><br><span class="line">    -ms-flex-negative: 0 !important;</span><br><span class="line">    flex-shrink: 0 !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-size-base &#123;</span><br><span class="line">    font-size: 28rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-size-sm &#123;</span><br><span class="line">    font-size: 24rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-size-medium &#123;</span><br><span class="line">    font-size: 26rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-size-lg &#123;</span><br><span class="line">    font-size: 32rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-size-extra-lg &#123;</span><br><span class="line">    font-size: 40rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-color-base &#123;</span><br><span class="line">    color: $text-color-base;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-color-assist &#123;</span><br><span class="line">    color: $text-color-assist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-color-primary &#123;</span><br><span class="line">    color: $color-primary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-color-danger &#123;</span><br><span class="line">    color: $color-error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-color-white &#123;</span><br><span class="line">    color: #ffffff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-color-warning &#123;</span><br><span class="line">    color: $color-warning;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-truncate &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    text-overflow: ellipsis;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-weight-bold &#123;</span><br><span class="line">    font-weight: 700 !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-weight-light &#123;</span><br><span class="line">    font-weight: 300 !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-weight-lighter &#123;</span><br><span class="line">    font-weight: lighter !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.font-weight-normal &#123;</span><br><span class="line">    font-weight: 400 !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.overflow-auto &#123;</span><br><span class="line">    overflow: auto !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.overflow-hidden &#123;</span><br><span class="line">    overflow: hidden !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.position-relative &#123;</span><br><span class="line">    position: relative !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.position-absolute &#123;</span><br><span class="line">    position: absolute !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.position-fixed &#123;</span><br><span class="line">    position: fixed !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.fixed-top &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    z-index: 1030;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.fixed-bottom &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    z-index: 1030;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.line-height-100 &#123;</span><br><span class="line">    line-height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.line-height-2 &#123;</span><br><span class="line">    line-height: 2rem !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.line-height-50 &#123;</span><br><span class="line">    line-height: 50rem !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-25 &#123;</span><br><span class="line">    width: 25% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-50 &#123;</span><br><span class="line">    width: 50% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-75 &#123;</span><br><span class="line">    width: 75% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-80 &#123;</span><br><span class="line">    width: 80% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-100 &#123;</span><br><span class="line">    width: 100% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.h-100 &#123;</span><br><span class="line">    height: 100% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-left &#123;</span><br><span class="line">    text-align: left !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-right &#123;</span><br><span class="line">    text-align: right !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.text-center &#123;</span><br><span class="line">    text-align: center !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.border-box &#123;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.rounded-circle &#123;</span><br><span class="line">    border-radius: 50% !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.rounded-pill &#123;</span><br><span class="line">    border-radius: 50rem !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.pre-line &#123;</span><br><span class="line">    white-space: pre-line;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-top &#123;</span><br><span class="line">    vertical-align: top !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-middle &#123;</span><br><span class="line">    vertical-align: middle !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-bottom &#123;</span><br><span class="line">    vertical-align: bottom !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-text-bottom &#123;</span><br><span class="line">    vertical-align: text-bottom !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.align-text-top &#123;</span><br><span class="line">    vertical-align: text-top !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-60 &#123;</span><br><span class="line">    width: 60%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.w-40 &#123;</span><br><span class="line">    width: 40%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mb-10 &#123;</span><br><span class="line">    margin-bottom: 10rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mb-20 &#123;</span><br><span class="line">    margin-bottom: 20rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mb-30 &#123;</span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mb-40 &#123;</span><br><span class="line">    margin-bottom: 40rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mb-50 &#123;</span><br><span class="line">    margin-bottom: 50rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mt-30 &#123;</span><br><span class="line">    margin-top: 30rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.ml-10 &#123;</span><br><span class="line">    margin-left: 10rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.ml-20 &#123;</span><br><span class="line">    margin-left: 20rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.ml-30 &#123;</span><br><span class="line">    margin-left: 30rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mr-10 &#123;</span><br><span class="line">    margin-right: 10rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mr-20 &#123;</span><br><span class="line">    margin-right: 20rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mr-30 &#123;</span><br><span class="line">    margin-right: 30rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mr-40 &#123;</span><br><span class="line">    margin-right: 40rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.pl-30 &#123;</span><br><span class="line">    padding-left: 30rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工具 -加载scss预编辑器插件</p><p>然后在App.vue 中 import app.scss</p><h4 id="uni-app使用iconfont"><a href="#uni-app使用iconfont" class="headerlink" title="uni-app使用iconfont"></a>uni-app使用iconfont</h4><p>1.iconfont网站选取需要的icon，放入购物车，然后导出</p><p>2.拷贝iconfont.css放到项目目录当中</p><p>3.复制UNIcoud(在iconfont官网)</p><h4 id="如何在uni-app中使用vuex"><a href="#如何在uni-app中使用vuex" class="headerlink" title="如何在uni-app中使用vuex"></a>如何在uni-app中使用vuex</h4><p>由于uni-app已经内置了vuex，所以只要正确引入就好了。</p><p>1、在项目的根目录下，<strong>创建一个名为store的文件夹</strong>然后在该文件夹下创建一个<strong>index.js</strong>的js文件<br> 2、在该js文件下定义公共的数据以及方法函数，并且把它导出</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;&#125;,</span><br><span class="line">    mutations: &#123;&#125;,</span><br><span class="line">    actions: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>3、在入口文件即：<strong>main.js</strong>挂载vuex</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="comment">//引入vuex</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="comment">//把vuex定义成全局组件</span></span><br><span class="line">Vue.prototype.$store = store</span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">App.mpType = <span class="string">&#x27;app&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    ...App,</span><br><span class="line"><span class="comment">//挂载</span></span><br><span class="line">    store</span><br><span class="line">&#125;)</span><br><span class="line">app.$mount()</span><br></pre></td></tr></table></figure><p>引入store中isLogin和orderType</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#39;vue&#39;</span><br><span class="line">import Vuex from &#39;vuex&#39;</span><br><span class="line">Vue.use(Vuex)</span><br><span class="line">const store &#x3D; new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        isLogin:false,</span><br><span class="line">        orderType: &#39;takein&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        SET_ORDERTYPE(state,type) &#123;</span><br><span class="line">            state.orderType &#x3D; type</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line">export default store</span><br></pre></td></tr></table></figure><p>项目中</p><p>第一步 script中引入</p><p>import {mapState} from ‘vuex’</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 在计算属性中引入</span><br><span class="line">...mapState([ &#x27;isLogin&#x27;, &#x27;orderType&#x27;]) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">takein() &#123;</span><br><span class="line">                this.$store.commit(&#x27;SET_ORDER_TYPE&#x27;, &#x27;takein&#x27;)</span><br><span class="line">                uni.switchTab(&#123;</span><br><span class="line">                    url: &#x27;/pages/menu/menu&#x27;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><h3 id="unicloud基础"><a href="#unicloud基础" class="headerlink" title="unicloud基础"></a>unicloud基础</h3><h4 id="UNiCloud云数据库"><a href="#UNiCloud云数据库" class="headerlink" title="UNiCloud云数据库"></a>UNiCloud云数据库</h4><p>​    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;userName&quot;:&quot;calvin&quot;,</span><br><span class="line">&quot;password&quot;:123456,</span><br><span class="line">&quot;gender&quot;: 1,</span><br><span class="line">&quot;avatarUrl&quot;:&quot;https:&#x2F;&#x2F;wx.qlogo.cn&#x2F;mmopen&#x2F;vi_32&#x2F;DYAIOgq83erykAZZqzQLTpO7EzXeqCaWreYwt8DuN0cgogux92HTlKR8gKiaqQNYf4kyBsqgmh99qNLrgaziaJbg&#x2F;132&quot;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>云函数中引入database即可操作数据库</p><p>const db = uniCloud.database();</p><p>即可使用数据库</p><h4 id="unicloud小案例-留言板"><a href="#unicloud小案例-留言板" class="headerlink" title="unicloud小案例-留言板"></a>unicloud小案例-留言板</h4><p>前端</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;content&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;input_box&quot;&gt;</span><br><span class="line">            &lt;textarea placeholder&#x3D;&quot;请输入您要留言的内容&quot; class&#x3D;&quot;textarea border&quot; v-model&#x3D;&quot;list.content&quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class="line">            &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;input_box border&quot; v-model&#x3D;&quot;list.name&quot; placeholder&#x3D;&quot;请输入用户名:&quot; &#x2F;&gt;</span><br><span class="line">            &lt;button @click&#x3D;&quot;Add&quot; class&#x3D;&quot;submit&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line"></span><br><span class="line">        &lt;view class&#x3D;&quot;list&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;item&quot; v-for&#x3D;&quot;(item, index) in listData&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;word&quot;&gt;</span><br><span class="line">                    &lt;text class&#x3D;&quot;user_name&quot;&gt;&#123;&#123; item.name &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;text class&#x3D;&quot;content&quot;&gt;&#123;&#123; item.content &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;text class&#x3D;&quot;delete&quot;  @click&#x3D;&quot;remove(item._id)&quot;&gt;删除&lt;&#x2F;text&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            list: &#123;</span><br><span class="line">                    name:&quot;&quot;,</span><br><span class="line">                    content: &quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">            listData:[</span><br><span class="line">                &#123;    </span><br><span class="line">                    _id:&quot;&quot;,</span><br><span class="line">                    name:&quot;&quot;,</span><br><span class="line">                    content: &quot;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    onLoad() &#123;</span><br><span class="line">        this.getData()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        Add() &#123;</span><br><span class="line">            let data &#x3D; this.list;</span><br><span class="line">            uniCloud.callFunction(&#123;</span><br><span class="line">                name:&#39;add&#39;,</span><br><span class="line">                data: data</span><br><span class="line">            &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                this.getData()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        getData() &#123;</span><br><span class="line">            uniCloud.callFunction(&#123;</span><br><span class="line">                name:&#39;get&#39;</span><br><span class="line">            &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                this.listData &#x3D; res.result.data</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        remove(id)&#123;</span><br><span class="line">            let _id &#x3D; id</span><br><span class="line">            uniCloud.callFunction(&#123;</span><br><span class="line">                name:&#39;remove&#39;,</span><br><span class="line">                data:&#123;</span><br><span class="line">                    _id</span><br><span class="line">                &#125;</span><br><span class="line">                 </span><br><span class="line">            &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                this.getData()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot;&gt;</span><br><span class="line">.border &#123;</span><br><span class="line">    border-style: solid;</span><br><span class="line">    border-width: 1px;</span><br><span class="line">    border-color: #eeeeee;</span><br><span class="line">&#125;</span><br><span class="line">.input &#123;</span><br><span class="line">    padding: 6rpx 8rpx;</span><br><span class="line">    height: 42px;</span><br><span class="line">    margin: 10rpx;</span><br><span class="line">&#125;</span><br><span class="line">.submit &#123;</span><br><span class="line">    width: 400upx;</span><br><span class="line">    margin-left: 175rpx;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.delete &#123;</span><br><span class="line">    background-color: #dddddd;</span><br><span class="line">    color: #ffffff;</span><br><span class="line">    width: 40rpx;</span><br><span class="line">    line-height: 50rpx;</span><br><span class="line">    height: 50rpx;</span><br><span class="line">    text-align: center;</span><br><span class="line">    width: 80rpx;</span><br><span class="line">    font-size: 30rpx;</span><br><span class="line">    border-radius: 6px;</span><br><span class="line">&#125;</span><br><span class="line">.list &#123;</span><br><span class="line">    width: 750rpx;</span><br><span class="line">&#125;</span><br><span class="line">.input_box &#123;</span><br><span class="line">    width: 750rpx;</span><br><span class="line">    background-color: #ffffff;</span><br><span class="line">    margin-bottom: 6px;</span><br><span class="line">&#125;</span><br><span class="line">.textarea &#123;</span><br><span class="line">    width: 730rpx;</span><br><span class="line">    padding: 10rpx;</span><br><span class="line">    margin: 10rpx;</span><br><span class="line">&#125;</span><br><span class="line">.item &#123;</span><br><span class="line">    @extend .border;</span><br><span class="line">    border-radius: 16px;</span><br><span class="line">    border-color: #eeeeee;</span><br><span class="line">    padding: 4px 8px;</span><br><span class="line">    margin: 5px;</span><br><span class="line">    flex-direction: row;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line">.logo &#123;</span><br><span class="line">    width: 100rpx;</span><br><span class="line">    height: 100rpx;</span><br><span class="line">    border-radius: 100px;</span><br><span class="line">&#125;</span><br><span class="line">.word &#123;</span><br><span class="line">    padding: 20rpx;</span><br><span class="line">    flex: 1;</span><br><span class="line">    justify-content: space-around;</span><br><span class="line">&#125;</span><br><span class="line">.user_name &#123;</span><br><span class="line">    font-size: 28upx;</span><br><span class="line">    color: #007aff;</span><br><span class="line">&#125;</span><br><span class="line">.content &#123;</span><br><span class="line">    font-size: 38upx;</span><br><span class="line">    color: #666666;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="云函数"><a href="#云函数" class="headerlink" title="云函数"></a>云函数</h4><p>添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    const collection &#x3D; db.collection(&#39;list&#39;)</span><br><span class="line">    const res &#x3D; await collection.add(event)</span><br><span class="line">    return res</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查找</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    const collection &#x3D; db.collection(&#39;list&#39;)</span><br><span class="line">    &#x2F;&#x2F;const res &#x3D; await collection.limit(10).where().get()</span><br><span class="line">    const res &#x3D; await collection.orderBy(&quot;_id&quot;, &quot;desc&quot;).get()</span><br><span class="line">    return res</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(event);</span><br><span class="line">    db.collection(&#39;list&#39;).where(&#123;</span><br><span class="line">        _id: event._id</span><br><span class="line">    &#125;).remove().then(function(res) &#123;</span><br><span class="line">        if (res.deleted &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">          return &#123;</span><br><span class="line">            status: 0,</span><br><span class="line">            msg: &#39;成功删除unicloud-test内第一条数据&#39;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          return &#123;</span><br><span class="line">            status: -2,</span><br><span class="line">            msg: &#39;删除数据失败&#39;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="点餐小程序首页开发"><a href="#点餐小程序首页开发" class="headerlink" title="点餐小程序首页开发"></a>点餐小程序首页开发</h3><h4 id="首先是bannar部分开发"><a href="#首先是bannar部分开发" class="headerlink" title="首先是bannar部分开发"></a><strong>首先是bannar部分开发</strong></h4><p>引入首图 <a href="https://img-shop.qmimg.cn/s23107/2020/04/26/3eb7808bf105262604.jpg">https://img-shop.qmimg.cn/s23107/2020/04/26/3eb7808bf105262604.jpg</a></p><h4 id="首页intro"><a href="#首页intro" class="headerlink" title="首页intro"></a>首页intro</h4><p>导言部分</p><p>您好，游客</p><p>一杯奶茶，一口软欧包，在奈雪遇见两种美好</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;intro&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;greet&quot;&gt;您好，&#123;&#123; isLogin ? member.nickname : &#39;游客&#39; &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;note&quot;&gt;一杯奶茶，一口软欧包，在奈雪遇见两种美好&lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>css样式变量</p><p>var(–status-bar-height)</p><h4 id="首页-entrance外卖和点餐入口"><a href="#首页-entrance外卖和点餐入口" class="headerlink" title="首页 entrance外卖和点餐入口"></a>首页 entrance外卖和点餐入口</h4><p><strong>样式</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">.entrance &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    margin-top: -80rpx;</span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">    border-radius: 10rpx;</span><br><span class="line">    background-color: #ffffff;</span><br><span class="line">    box-shadow: $box-shadow;</span><br><span class="line">    padding: 30rpx 0;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    .item &#123;</span><br><span class="line">        flex: 1;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        position: relative;</span><br><span class="line">        </span><br><span class="line">        &amp;:nth-child(1):after &#123;</span><br><span class="line">            content: &#39;&#39;;</span><br><span class="line">            position: absolute;</span><br><span class="line">            width: 1rpx;</span><br><span class="line">            background-color: $text-color-assist;</span><br><span class="line">            right: 0;</span><br><span class="line">            height: 100%;</span><br><span class="line">            transform: scaleX(0.5) scaleY(0.8);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .icon &#123;</span><br><span class="line">            width: 84rpx;</span><br><span class="line">            height: 84rpx;</span><br><span class="line">            margin: 20rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .title &#123;</span><br><span class="line">            font-size: 30rpx;</span><br><span class="line">            color: $text-color-base;</span><br><span class="line">            font-weight: 600;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>布局</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;entrance&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;item&quot; @tap&#x3D;&quot;takein&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;zq.png&quot; class&#x3D;&quot;icon&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;title&quot;&gt;自取&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;item&quot; @tap&#x3D;&quot;takeout&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;wm.png&quot; class&#x3D;&quot;icon&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;title&quot;&gt;外卖&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><h4 id="会员积分模块"><a href="#会员积分模块" class="headerlink" title="会员积分模块"></a>会员积分模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;info&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;integral_section&quot; @tap&#x3D;&quot;integrals&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;top&quot;&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;title&quot;&gt;我的积分&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;value&quot;&gt;&#123;&#123; isLogin ? userInfo.pointNum : 0 &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;bottom&quot;&gt;</span><br><span class="line">                        进入积分商城兑换奈雪券及周边好礼</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont iconarrow-right&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;qrcode_section&quot; @tap&#x3D;&quot;memberCode&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;qrcode.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;text&gt;会员码&lt;&#x2F;text&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>CSS样式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 用户积分</span><br><span class="line">    .info &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        border-radius: 10rpx;</span><br><span class="line">        background-color: #ffffff;</span><br><span class="line">        box-shadow: $box-shadow;</span><br><span class="line">        padding: 30rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        </span><br><span class="line">        .integral_section &#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            </span><br><span class="line">            .top &#123;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: center;</span><br><span class="line">                </span><br><span class="line">                .title &#123;</span><br><span class="line">                    color: $text-color-base;</span><br><span class="line">                    font-size: $font-size-base;</span><br><span class="line">                    margin-right: 10rpx;</span><br><span class="line">                &#125;</span><br><span class="line">                .value &#123;</span><br><span class="line">                    font-size: 44rpx;</span><br><span class="line">                    font-weight: bold;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .bottom &#123;</span><br><span class="line">                font-size: $font-size-sm;</span><br><span class="line">                color: $text-color-assist;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: center;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .qrcode_section &#123;</span><br><span class="line">            color: $color-primary;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            </span><br><span class="line">            image &#123;</span><br><span class="line">                width: 40rpx;</span><br><span class="line">                height: 40rpx;</span><br><span class="line">                margin-bottom: 10rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">memberCode() &#123;</span><br><span class="line">                if(!this.isLogin) &#123;</span><br><span class="line">                    uni.navigateTo(&#123;url: &#39;&#x2F;pages&#x2F;login&#x2F;login&#39;&#125;)</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &#39;&#x2F;pages&#x2F;mine&#x2F;member-code&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><h4 id="奈雪商城以及会员新闻"><a href="#奈雪商城以及会员新闻" class="headerlink" title="奈雪商城以及会员新闻"></a>奈雪商城以及会员新闻</h4><p>样式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;奈雪商城茶包</span><br><span class="line">    .navigators &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        margin-bottom: 20rpx;    </span><br><span class="line">        border-radius: 10rpx;</span><br><span class="line">        background-color: #ffffff;</span><br><span class="line">        box-shadow: $box-shadow;</span><br><span class="line">        padding: 20rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: stretch;</span><br><span class="line">        </span><br><span class="line">        .left &#123;</span><br><span class="line">            width: 340rpx;</span><br><span class="line">            margin-right: 20rpx;</span><br><span class="line">            display: flex;</span><br><span class="line">            padding: 20rpx;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            color: $text-color-base;</span><br><span class="line">            background-color: #F2F2E6;</span><br><span class="line">            </span><br><span class="line">            .grid &#123;</span><br><span class="line">                height: 50%;</span><br><span class="line">                display: flex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .right &#123;</span><br><span class="line">            width: 290rpx;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            </span><br><span class="line">            .tea-activity, .member-gifts &#123;</span><br><span class="line">                width: 100%;</span><br><span class="line">                display: flex;</span><br><span class="line">                padding: 20rpx;</span><br><span class="line">                font-size: $font-size-sm;</span><br><span class="line">                color: $text-color-base;</span><br><span class="line">                align-items: center;</span><br><span class="line">                position: relative;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .tea-activity &#123;</span><br><span class="line">                background-color: #FDF3F2;</span><br><span class="line">                margin-bottom: 20rpx;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .member-gifts &#123;</span><br><span class="line">                background-color: #FCF6D4;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .right-img &#123;</span><br><span class="line">                flex: 1;</span><br><span class="line">                position: relative;</span><br><span class="line">                margin-left: 20rpx;</span><br><span class="line">                margin-right: -20rpx;</span><br><span class="line">                margin-bottom: -20rpx;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: flex-end;</span><br><span class="line">                </span><br><span class="line">                image &#123;</span><br><span class="line">                    width: 100%;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .mark-img &#123;</span><br><span class="line">            width: 30rpx;</span><br><span class="line">            height: 30rpx;</span><br><span class="line">            margin-right: 10rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .yzclh-img &#123;</span><br><span class="line">            height: 122.96rpx;</span><br><span class="line">            width: 214.86rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .member-news &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        .header &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: space-between;</span><br><span class="line">            padding: 20rpx 0;</span><br><span class="line">            </span><br><span class="line">            .title &#123;</span><br><span class="line">                font-size: $font-size-lg;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .iconfont &#123;</span><br><span class="line">                font-size: 52rpx;</span><br><span class="line">                color: $text-color-assist;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .list &#123;</span><br><span class="line">            width: 100%;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            </span><br><span class="line">            .item &#123;</span><br><span class="line">                width: 100%;</span><br><span class="line">                height: 240rpx;</span><br><span class="line">                position: relative;</span><br><span class="line">                </span><br><span class="line">                image &#123;</span><br><span class="line">                    width: 100%;</span><br><span class="line">                    height: 100%;</span><br><span class="line">                    border-radius: 8rpx;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                .title &#123;</span><br><span class="line">                    position: relative;</span><br><span class="line">                    font-size: 32rpx;</span><br><span class="line">                    font-weight: 500;</span><br><span class="line">                    width: 100%;</span><br><span class="line">                    top: -70rpx;</span><br><span class="line">                    left: 16rpx;</span><br><span class="line">                    color: #ffffff;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>view文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 奈雪茶商城 --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;navigators&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;left&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;grid flex-column just-content-center&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;d-flex align-items-center&quot;&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;csc.png&quot; class&#x3D;&quot;mark-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;font-size-sm text-color-base&quot;&gt;奈雪的茶商城&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;text-color-assist&quot; style&#x3D;&quot;margin-left: 40rpx; font-size: 20rpx;&quot;&gt;优质茶礼盒，网红零食&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;grid justify-content-end align-items-end&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;yzclh.png&quot; class&#x3D;&quot;yzclh-img&quot; mode&#x3D;&quot;heightFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;right&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;tea-activity&quot; @tap&#x3D;&quot;invite&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;mcsb.png&quot; class&#x3D;&quot;mark-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view&gt;买茶送包&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;right-img&quot;&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;mcsb_bg.png&quot; mode&#x3D;&quot;widthFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;member-gifts&quot; @tap&#x3D;&quot;packages&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;hyjb.png&quot; class&#x3D;&quot;mark-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view&gt;会员劵包&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;right-img&quot;&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;hyjb_bg.png&quot; mode&#x3D;&quot;widthFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;member-news&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;header&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;title&quot;&gt;会员新鲜事&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont iconRightbutton&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;list&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;item&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;27&#x2F;0039bf41c9ebd50a2c.jpg&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;title&quot;&gt;&quot;梅&quot;你不行 | 霸气杨梅清爽回归&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><h3 id="微信小程序登录开发"><a href="#微信小程序登录开发" class="headerlink" title="微信小程序登录开发"></a>微信小程序登录开发</h3><h4 id="微信小程序登录原理"><a href="#微信小程序登录原理" class="headerlink" title="微信小程序登录原理"></a>微信小程序登录原理</h4><p><img src= "/img/loading.gif" data-lazy-src="https://res.wx.qq.com/wxdoc/dist/assets/img/api-login.2fcc9f35.jpg" alt="img"></p><p>步骤</p><p><em>第一步：小程序通过uni.login()获取code。</em></p><p><em>第二步：小程序通过uni.request()发送code到开发者服务器。</em></p><p><em>第三步：开发者服务器接收小程序发送的code，并携带appid、appsecret（这两个需要到微信小程序后台查看）、code发送到微信服务器。</em></p><p><em>第四步：微信服务器接收开发者服务器发送的appid、appsecret、code进行校验。校验通过后向开发者服务器发送session_key、openid。</em></p><p><em>第五步：开发者服务器自己生成一个key（自定义登录状态）与openid、session_key进行关联，并存到数据库中（mysql、redis、云数据库等）。</em></p><p><em>第六步：开发者服务器返回生成key（自定义登录状态）到小程序。</em></p><p><em>第七步：小程序存储key（自定义登录状态）到本地。</em></p><h4 id="unicloud登录微信小程序"><a href="#unicloud登录微信小程序" class="headerlink" title="unicloud登录微信小程序"></a>unicloud登录微信小程序</h4><p>首先是login.vue 登陆按钮，启动登陆方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">...mapMutations([&#39;Login&#39;]),</span><br><span class="line">        wxLogin(e) &#123;</span><br><span class="line">                const that &#x3D; this;</span><br><span class="line">                let userInfo &#x3D; e.detail.userInfo;</span><br><span class="line">                uni.showLoading(&#123;</span><br><span class="line">                    title: &#39;登录中...&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">                return new Promise((resolve, reject)&#x3D;&gt;&#123;</span><br><span class="line">                    uni.login(&#123;</span><br><span class="line">                        provider:&#39;weixin&#39;,</span><br><span class="line">                        success(login_res) &#123;</span><br><span class="line">                            if (login_res.code) &#123;</span><br><span class="line">                                resolve(login_res.code)</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                reject(new Error(&#39;微信登录失败&#39;))</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        fail(e) &#123;</span><br><span class="line">                            reject(new Error(&#39;微信登录失败&#39;))</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;).then((code)&#x3D;&gt;&#123;</span><br><span class="line">                    console.log(&quot;code:&quot;, code)</span><br><span class="line">                    return uniCloud.callFunction(&#123;</span><br><span class="line">                        name: &#39;member&#39;,</span><br><span class="line">                        data: &#123;</span><br><span class="line">                            code,</span><br><span class="line">                            userInfo</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                    uni.hideLoading()</span><br><span class="line">                    console.log(res);</span><br><span class="line">                    if (res.result.status !&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        return Promise.reject(new Error(res.result.msg))</span><br><span class="line">                    &#125;</span><br><span class="line">                    that.Login(res.result.data)</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                        content: &#39;登录成功&#39;,</span><br><span class="line">                        showCancel: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                    uni.hideLoading()</span><br><span class="line">                    uni.navigateBack()</span><br><span class="line">                </span><br><span class="line">                &#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">                    console.log(err);</span><br><span class="line">                    uni.hideLoading()</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                    content: &#39;出现错误，请稍后再试.&#39; + err.message,</span><br><span class="line">                    showCancel: false</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">                </span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><p>然后是unicloud新建云函数login</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const crypto &#x3D; require(&#39;crypto&#39;);</span><br><span class="line">const jwt &#x3D; require(&#39;jwt-simple&#39;);</span><br><span class="line">const db &#x3D; uniCloud.database();</span><br><span class="line">const loginConfig &#x3D;&#123;</span><br><span class="line">    appId:&#39;wx62e0151eaf62eff7&#39;,</span><br><span class="line">    appSecret: &#39;c45170b3aa8dbc5cd45ab12c319298f8&#39;</span><br><span class="line">&#125;;</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F;event为客户端上传的参数</span><br><span class="line">    let data &#x3D; &#123;</span><br><span class="line">        appid: loginConfig.appId,</span><br><span class="line">        secret: loginConfig.appSecret,</span><br><span class="line">        js_code: event.code,</span><br><span class="line">        grant_type: &#39;authorization_code&#39;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F;向微信服务器提交code并接收openId和session_key</span><br><span class="line">    const res &#x3D; await uniCloud.httpclient.request(&#39;https:&#x2F;&#x2F;api.weixin.qq.com&#x2F;sns&#x2F;jscode2session&#39;, &#123;</span><br><span class="line">      method: &#39;GET&#39;,</span><br><span class="line">      data,</span><br><span class="line">      dataType: &#39;json&#39;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    const success &#x3D; res.status &#x3D;&#x3D;&#x3D; 200 &amp;&amp; res.data &amp;&amp; res.data.openid;</span><br><span class="line">    </span><br><span class="line">    if (!success) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        status: -1,</span><br><span class="line">        msg: &#39;微信登录失败&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const openId &#x3D; res.data.openid</span><br><span class="line">    const tonkenExp &#x3D; 7200000;</span><br><span class="line">    &#x2F;&#x2F;当前时间</span><br><span class="line">    let time &#x3D; new Date().toUTCString();</span><br><span class="line">    let tokenSecret &#x3D; crypto.randomBytes(16).toString(&#39;hex&#39;),</span><br><span class="line">    token &#x3D; jwt.encode(openId, tokenSecret);</span><br><span class="line">     </span><br><span class="line">    let userInfo &#x3D; &#123;</span><br><span class="line">        openId : res.data.openid,</span><br><span class="line">        nickName : event.userInfo.nickName,</span><br><span class="line">        avatarUrl : event.userInfo.avatarUrl,</span><br><span class="line">        gender : event.userInfo.gender,</span><br><span class="line">        city : event.userInfo.city,</span><br><span class="line">        balance: &#39;&#39;,</span><br><span class="line">        couponNum: &#39;&#39;,</span><br><span class="line">        currentValue: &#39;&#39;,</span><br><span class="line">        giftBalance: &#39;&#39;,</span><br><span class="line">        level:&#39;&#39;,</span><br><span class="line">        pointNum:&#39;&#39;,</span><br><span class="line">        CreateTime: time,</span><br><span class="line">        lastLoginTime : time</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    let userUpdate &#x3D; &#123;</span><br><span class="line">        openId : res.data.openid,</span><br><span class="line">        nickName : event.userInfo.nickName,</span><br><span class="line">        avatarUrl : event.userInfo.avatarUrl,</span><br><span class="line">        gender : event.userInfo.gender,</span><br><span class="line">        city : event.userInfo.city,</span><br><span class="line">        lastLoginTime : time</span><br><span class="line">    &#125;</span><br><span class="line">    let userResult</span><br><span class="line">    </span><br><span class="line">    const userInDB &#x3D; await db.collection(&#39;users&#39;).where(&#123;</span><br><span class="line">      openId</span><br><span class="line">    &#125;).limit(1).get();</span><br><span class="line">    </span><br><span class="line">    if (userInDB.data &amp;&amp; userInDB.data.length &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">      userResult &#x3D; await db.collection(&#39;users&#39;).add(&#123;</span><br><span class="line">        ...userInfo,</span><br><span class="line">        tokenSecret,</span><br><span class="line">        exp:Date.now() + tonkenExp</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      userResult &#x3D; await db.collection(&#39;users&#39;).where(&#123;openId&#125;).update(&#123;</span><br><span class="line">          ...userUpdate,</span><br><span class="line">          tokenSecret,</span><br><span class="line">          exp:Date.now() + tonkenExp</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const fields &#x3D; &#123;</span><br><span class="line">        openId:1,</span><br><span class="line">        nickName : 1,</span><br><span class="line">        avatarUrl : 1,</span><br><span class="line">        balance: 1,</span><br><span class="line">        couponNum: 1,</span><br><span class="line">        currentValue: 1,</span><br><span class="line">        giftBalance: 1,</span><br><span class="line">        level:1,</span><br><span class="line">        pointNum:1,</span><br><span class="line">        gender:1</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    let ResultOK &#x3D; await db.collection(&#39;users&#39;).where(&#123;openId&#125;).field(fields).get();</span><br><span class="line">    let ResultData &#x3D; ResultOK.data[0];</span><br><span class="line">  &#x2F;&#x2F;返回数据给客户端</span><br><span class="line">    if (userResult.id || userResult.updated &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          &quot;status&quot;: 0,</span><br><span class="line">          &quot;data&quot;: ResultData,</span><br><span class="line">          &quot;token&quot;: token,</span><br><span class="line">          &quot;msg&quot;: &#39;登录成功&#39;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      return &#123;</span><br><span class="line">        &quot;status&quot;: -1,</span><br><span class="line">        &quot;msg&quot;: &#39;微信登录失败&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>首页</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;!-- 首页banner --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;banner&quot;&gt;</span><br><span class="line">            &lt;image src&#x3D;&quot;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;26&#x2F;3eb7808bf105262604.jpg&quot; class&#x3D;&quot;bg&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;intro&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;greet&quot;&gt;您好，&#123;&#123; isLogin ? userInfo.nickName : &#39;游客&#39; &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;note&quot;&gt;一杯奶茶，一口软欧包，在奈雪遇见两种美好&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- 首页content --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;content&quot;&gt;</span><br><span class="line">            &lt;!-- 点餐入口 --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;entrance&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;item&quot; @tap&#x3D;&quot;takein&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;images&#x2F;index&#x2F;zq.png&quot; class&#x3D;&quot;icon&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;title&quot;&gt;自取&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;item&quot; @tap&#x3D;&quot;takeout&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;images&#x2F;index&#x2F;wm.png&quot; class&#x3D;&quot;icon&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;title&quot;&gt;外卖&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- 会员积分 --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;info&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;integral_section&quot; @tap&#x3D;&quot;integrals&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;top&quot;&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;title&quot;&gt;我的积分&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;value&quot;&gt;&#123;&#123; isLogin ? userInfo.pointNum : 0 &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;bottom&quot;&gt;</span><br><span class="line">                        进入积分商城兑换奈雪券及周边好礼</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont iconarrow-right&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;qrcode_section&quot; @tap&#x3D;&quot;memberCode&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;qrcode.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;text&gt;会员码&lt;&#x2F;text&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- 奈雪茶商城 --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;navigators&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;left&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;grid flex-column just-content-center&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;d-flex align-items-center&quot;&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;csc.png&quot; class&#x3D;&quot;mark-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;font-size-sm text-color-base&quot;&gt;奈雪的茶商城&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;text-color-assist&quot; style&#x3D;&quot;margin-left: 40rpx; font-size: 20rpx;&quot;&gt;优质茶礼盒，网红零食&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;grid justify-content-end align-items-end&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;yzclh.png&quot; class&#x3D;&quot;yzclh-img&quot; mode&#x3D;&quot;heightFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;right&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;tea-activity&quot; @tap&#x3D;&quot;invite&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;mcsb.png&quot; class&#x3D;&quot;mark-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view&gt;买茶送包&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;right-img&quot;&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;mcsb_bg.png&quot; mode&#x3D;&quot;widthFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;member-gifts&quot; @tap&#x3D;&quot;packages&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;hyjb.png&quot; class&#x3D;&quot;mark-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view&gt;会员劵包&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;right-img&quot;&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;index&#x2F;hyjb_bg.png&quot; mode&#x3D;&quot;widthFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;member-news&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;header&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;title&quot;&gt;会员新鲜事&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont iconRightbutton&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;list&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;item&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;27&#x2F;0039bf41c9ebd50a2c.jpg&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;title&quot;&gt;&quot;梅&quot;你不行 | 霸气杨梅清爽回归&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123;mapState&#125; from &#39;vuex&#39;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                title: &#39;Hello&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLoad() &#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            ...mapState([&#39;isLogin&#39;,&#39;orderType&#39;,&#39;userInfo&#39;,&#39;chooseStore&#39;])</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            &#x2F;&#x2F; 点餐</span><br><span class="line">            takein() &#123;</span><br><span class="line">                if(!this.chooseStore) &#123;</span><br><span class="line">                    uni.navigateTo(&#123;</span><br><span class="line">                        url:&#39;..&#x2F;stores&#x2F;stores&#39;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">                &#123;</span><br><span class="line">                    this.$store.commit(&#39;SET_ORDERTYPE&#39;,&#39;takein&#39;)</span><br><span class="line">                uni.switchTab(&#123;</span><br><span class="line">                    url:&#39;..&#x2F;menu&#x2F;menu&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            takeout() &#123;</span><br><span class="line">                if(!this.isLogin) &#123;</span><br><span class="line">                    uni.navigateTo(&#123;url: &#39;&#x2F;pages&#x2F;login&#x2F;login&#39;&#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &quot;&#x2F;pages&#x2F;address&#x2F;address?is_choose&#x3D;true&quot;    </span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            memberCode() &#123;</span><br><span class="line">                uni.showLoading(&#123;</span><br><span class="line">                    title: &#39;加载中...&#39;</span><br><span class="line">                &#125;);</span><br><span class="line">                uniCloud.callFunction(&#123;</span><br><span class="line">                    name: &#39;validateToken&#39;,</span><br><span class="line">                    data: &#123;</span><br><span class="line">                        token: uni.getStorageSync(&#39;token&#39;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">                    console.log(res);</span><br><span class="line">                    uni.hideLoading()</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                        content: res.result.msg,</span><br><span class="line">                        showCancel: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">                    uni.hideLoading()</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                        content: &#39;请求云函数发生错误，&#39; + err.message,</span><br><span class="line">                        showCancel: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot;&gt;</span><br><span class="line">    .banner&#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        height: 600rpx;</span><br><span class="line">        width: 100%;</span><br><span class="line">        &#x2F;&#x2F;背景图片</span><br><span class="line">        .bg&#123;</span><br><span class="line">            height: 600rpx;</span><br><span class="line">            width: 100%;</span><br><span class="line">        &#125;</span><br><span class="line">        .intro &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            color: #FFFFFF;</span><br><span class="line">            top: calc(50rpx + var(--status-bar-height));</span><br><span class="line">            left: 40rpx;</span><br><span class="line">            .greet &#123;</span><br><span class="line">                font-size: $font-size-lg;</span><br><span class="line">                margin-bottom: 10rpx;</span><br><span class="line">            &#125;</span><br><span class="line">            .note &#123;</span><br><span class="line">                font-size: $font-size-sm;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .content &#123;</span><br><span class="line">        padding: 0 30rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .entrance &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        margin-top: -80rpx;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        border-radius: 10rpx;</span><br><span class="line">        background-color: #FFFFFF;</span><br><span class="line">        box-shadow: $box-shadow;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        padding: 30rpx 0;</span><br><span class="line">        </span><br><span class="line">        .item &#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex: 1;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            </span><br><span class="line">            &amp;:nth-child(1):after &#123;</span><br><span class="line">                        content: &#39;&#39;;</span><br><span class="line">                        position: absolute;</span><br><span class="line">                        width: 1rpx;</span><br><span class="line">                        background-color: $text-color-assist;</span><br><span class="line">                        right: 0;</span><br><span class="line">                        height: 100%;</span><br><span class="line">                        transform: scaleX(0.5) scaleY(0.8);</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    .icon &#123;</span><br><span class="line">                        width: 84rpx;</span><br><span class="line">                        height: 84rpx;</span><br><span class="line">                        margin: 20rpx;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    .title &#123;</span><br><span class="line">                        font-size: 30rpx;</span><br><span class="line">                        font-weight: 600;</span><br><span class="line">                        color: $text-color-base;</span><br><span class="line">                    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 用户积分</span><br><span class="line">    .info &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        border-radius: 10rpx;</span><br><span class="line">        background-color: #ffffff;</span><br><span class="line">        box-shadow: $box-shadow;</span><br><span class="line">        padding: 30rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        </span><br><span class="line">        .integral_section &#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            </span><br><span class="line">            .top &#123;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: center;</span><br><span class="line">                </span><br><span class="line">                .title &#123;</span><br><span class="line">                    color: $text-color-base;</span><br><span class="line">                    font-size: $font-size-base;</span><br><span class="line">                    margin-right: 10rpx;</span><br><span class="line">                &#125;</span><br><span class="line">                .value &#123;</span><br><span class="line">                    font-size: 44rpx;</span><br><span class="line">                    font-weight: bold;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .bottom &#123;</span><br><span class="line">                font-size: $font-size-sm;</span><br><span class="line">                color: $text-color-assist;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: center;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .qrcode_section &#123;</span><br><span class="line">            color: $color-primary;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            </span><br><span class="line">            image &#123;</span><br><span class="line">                width: 40rpx;</span><br><span class="line">                height: 40rpx;</span><br><span class="line">                margin-bottom: 10rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;奈雪商城茶包</span><br><span class="line">    .navigators &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        margin-bottom: 20rpx;    </span><br><span class="line">        border-radius: 10rpx;</span><br><span class="line">        background-color: #ffffff;</span><br><span class="line">        box-shadow: $box-shadow;</span><br><span class="line">        padding: 20rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: stretch;</span><br><span class="line">        </span><br><span class="line">        .left &#123;</span><br><span class="line">            width: 340rpx;</span><br><span class="line">            margin-right: 20rpx;</span><br><span class="line">            display: flex;</span><br><span class="line">            padding: 0 20rpx;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            color: $text-color-base;</span><br><span class="line">            background-color: #F2F2E6;</span><br><span class="line">            </span><br><span class="line">            .grid &#123;</span><br><span class="line">                height: 50%;</span><br><span class="line">                display: flex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .right &#123;</span><br><span class="line">            width: 290rpx;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            </span><br><span class="line">            .tea-activity, .member-gifts &#123;</span><br><span class="line">                width: 100%;</span><br><span class="line">                display: flex;</span><br><span class="line">                padding: 20rpx;</span><br><span class="line">                font-size: $font-size-sm;</span><br><span class="line">                color: $text-color-base;</span><br><span class="line">                align-items: center;</span><br><span class="line">                position: relative;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .tea-activity &#123;</span><br><span class="line">                background-color: #FDF3F2;</span><br><span class="line">                margin-bottom: 20rpx;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .member-gifts &#123;</span><br><span class="line">                background-color: #FCF6D4;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .right-img &#123;</span><br><span class="line">                flex: 1;</span><br><span class="line">                position: relative;</span><br><span class="line">                margin-left: 20rpx;</span><br><span class="line">                margin-right: -20rpx;</span><br><span class="line">                margin-bottom: -20rpx;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: flex-end;</span><br><span class="line">                </span><br><span class="line">                image &#123;</span><br><span class="line">                    width: 100%;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .mark-img &#123;</span><br><span class="line">            width: 30rpx;</span><br><span class="line">            height: 30rpx;</span><br><span class="line">            margin-right: 10rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .yzclh-img &#123;</span><br><span class="line">            height: 122.96rpx;</span><br><span class="line">            width: 214.86rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .member-news &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        .header &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: space-between;</span><br><span class="line">            padding: 20rpx 0;</span><br><span class="line">            </span><br><span class="line">            .title &#123;</span><br><span class="line">                font-size: $font-size-lg;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .iconfont &#123;</span><br><span class="line">                font-size: 52rpx;</span><br><span class="line">                color: $text-color-assist;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .list &#123;</span><br><span class="line">            width: 100%;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            </span><br><span class="line">            .item &#123;</span><br><span class="line">                width: 100%;</span><br><span class="line">                height: 240rpx;</span><br><span class="line">                position: relative;</span><br><span class="line">                </span><br><span class="line">                image &#123;</span><br><span class="line">                    width: 100%;</span><br><span class="line">                    height: 100%;</span><br><span class="line">                    border-radius: 8rpx;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                .title &#123;</span><br><span class="line">                    position: relative;</span><br><span class="line">                    font-size: 32rpx;</span><br><span class="line">                    font-weight: 500;</span><br><span class="line">                    width: 100%;</span><br><span class="line">                    top: -70rpx;</span><br><span class="line">                    left: 16rpx;</span><br><span class="line">                    color: #ffffff;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="登录页面login开发"><a href="#登录页面login开发" class="headerlink" title="登录页面login开发"></a>登录页面login开发</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;intro&quot;&gt;</span><br><span class="line">            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;logo.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;tips&quot;&gt;</span><br><span class="line">                一杯好茶，一口软欧包</span><br><span class="line">                &lt;br&gt;</span><br><span class="line">                在奈雪遇见两种美好</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;bottom&quot;&gt;</span><br><span class="line">            &lt;!-- #ifdef MP-WEIXIN --&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;primary&quot; size&#x3D;&quot;default&quot; class&#x3D;&quot;login-btn&quot; open-type&#x3D;&quot;getUserInfo&quot; lang&#x3D;&quot;zh_CN&quot; @getuserinfo&#x3D;&quot;wxLogin&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;wechat.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    微信一键登录</span><br><span class="line">                &lt;&#x2F;button&gt;</span><br><span class="line">            &lt;!-- #endif --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;d-flex flex-column justify-content-evenly align-items-center text-center&quot; style&#x3D;&quot;height: 30vh;&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;w-100 font-size-base text-color-assist&quot;&gt;新用户登录即加入会员，享会员权益&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;w-100 row d-flex just-content-around align-items-center font-size-sm text-color-assist&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;rhyl.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;入会有礼&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;jfdh.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;积分兑换&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;sjtq.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;升级特权&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;srtq.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;生日特权&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;nxbz.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;奈雪宝藏&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;font-size-base text-color-primary&quot;&gt;会员权益说明&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">    .intro &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 60vh;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: space-evenly;</span><br><span class="line">        font-size: $font-size-base;</span><br><span class="line">        color: $text-color-assist;</span><br><span class="line">        </span><br><span class="line">        image &#123;</span><br><span class="line">            width: 165rpx;</span><br><span class="line">            height: 165rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .tips &#123;</span><br><span class="line">            line-height: 72rpx;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .bottom &#123;</span><br><span class="line">        height: 40vh;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        padding: 0 40rpx;</span><br><span class="line">        </span><br><span class="line">        .login-btn &#123;</span><br><span class="line">            width: 100%;</span><br><span class="line">            border-radius: 50rem !important;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            padding: 10rpx 0;</span><br><span class="line">            </span><br><span class="line">            image &#123;</span><br><span class="line">                width: 36rpx;</span><br><span class="line">                height: 30rpx;</span><br><span class="line">                margin-right: 10rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .row &#123;</span><br><span class="line">            .grid &#123;</span><br><span class="line">                width: 20%;</span><br><span class="line">                image &#123;</span><br><span class="line">                    width: 60rpx;</span><br><span class="line">                    height: 60rpx;</span><br><span class="line">                    margin-bottom: 10rpx;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="登录页面login接口开发js和unicloud后端事件"><a href="#登录页面login接口开发js和unicloud后端事件" class="headerlink" title="登录页面login接口开发js和unicloud后端事件"></a>登录页面login接口开发js和unicloud后端事件</h4><p>uni-app端</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapState, mapMutations&#125; from &#39;vuex&#39;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        methods: &#123;</span><br><span class="line">            ...mapMutations([&#39;Login&#39;]),</span><br><span class="line">            wxLogin(e) &#123;</span><br><span class="line">                    const that &#x3D; this;</span><br><span class="line">                    let userInfo &#x3D; e.detail.userInfo;</span><br><span class="line">                    uni.showLoading(&#123;</span><br><span class="line">                        title: &#39;登录中...&#39;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    return new Promise((resolve, reject)&#x3D;&gt;&#123;</span><br><span class="line">                        uni.login(&#123;</span><br><span class="line">                            provider:&#39;weixin&#39;,</span><br><span class="line">                            success(login_res) &#123;</span><br><span class="line">                                if (login_res.code) &#123;</span><br><span class="line">                                    resolve(login_res.code)</span><br><span class="line">                                &#125; else &#123;</span><br><span class="line">                                    reject(new Error(&#39;微信登录失败&#39;))</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            fail(e) &#123;</span><br><span class="line">                                reject(new Error(&#39;微信登录失败&#39;))</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;).then((code)&#x3D;&gt;&#123;</span><br><span class="line">                        console.log(&quot;code:&quot;, code)</span><br><span class="line">                        return uniCloud.callFunction(&#123;</span><br><span class="line">                            name: &#39;login&#39;,</span><br><span class="line">                            data: &#123;</span><br><span class="line">                                code,</span><br><span class="line">                                userInfo</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        console.log(res);</span><br><span class="line">                        if (res.result.status !&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                            return Promise.reject(new Error(res.result.msg))</span><br><span class="line">                        &#125;</span><br><span class="line">                        console.log(res.result.data)</span><br><span class="line">                        that.Login(res.result.data)</span><br><span class="line">                        uni.setStorage(&#123;</span><br><span class="line">                            key:&#39;token&#39;,</span><br><span class="line">                            data:res.result.token</span><br><span class="line">                        &#125;)</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content: &#39;登录成功&#39;,</span><br><span class="line">                            showCancel: false</span><br><span class="line">                        &#125;)</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        uni.navigateBack()</span><br><span class="line">                    </span><br><span class="line">                    &#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">                        console.log(err);</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                        content: &#39;出现错误，请稍后再试.&#39; + err.message,</span><br><span class="line">                        showCancel: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                    </span><br><span class="line">               &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>vuex改变登录状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;登录</span><br><span class="line">        Login(state,res) &#123;</span><br><span class="line">            state.isLogin &#x3D; true</span><br><span class="line">            state.userInfo &#x3D; res</span><br><span class="line">            uni.setStorage(&#123;</span><br><span class="line">                    key: &#39;userinfo&#39;,</span><br><span class="line">                    data: res</span><br><span class="line">                  &#125;)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="unicloud后端部分"><a href="#unicloud后端部分" class="headerlink" title="unicloud后端部分"></a>unicloud后端部分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const crypto &#x3D; require(&#39;crypto&#39;);</span><br><span class="line">const jwt &#x3D; require(&#39;jwt-simple&#39;);</span><br><span class="line">const db &#x3D; uniCloud.database();</span><br><span class="line">const loginConfig &#x3D;&#123;</span><br><span class="line">    appId:&#39;wx62e0151eaf62eff7&#39;,</span><br><span class="line">    appSecret: &#39;&#39;</span><br><span class="line">&#125;;</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F;event为客户端上传的参数</span><br><span class="line">    let data &#x3D; &#123;</span><br><span class="line">        appid: loginConfig.appId,</span><br><span class="line">        secret: loginConfig.appSecret,</span><br><span class="line">        js_code: event.code,</span><br><span class="line">        grant_type: &#39;authorization_code&#39;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F;向微信服务器提交code并接收openId和session_key</span><br><span class="line">    const res &#x3D; await uniCloud.httpclient.request(&#39;https:&#x2F;&#x2F;api.weixin.qq.com&#x2F;sns&#x2F;jscode2session&#39;, &#123;</span><br><span class="line">      method: &#39;GET&#39;,</span><br><span class="line">      data,</span><br><span class="line">      dataType: &#39;json&#39;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    const success &#x3D; res.status &#x3D;&#x3D;&#x3D; 200 &amp;&amp; res.data &amp;&amp; res.data.openid;</span><br><span class="line">    </span><br><span class="line">    if (!success) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        status: -1,</span><br><span class="line">        msg: &#39;微信登录失败&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const openId &#x3D; res.data.openid</span><br><span class="line">    const tonkenExp &#x3D; 7200000;</span><br><span class="line">    &#x2F;&#x2F;当前时间</span><br><span class="line">    let time &#x3D; new Date().toUTCString();</span><br><span class="line">    let tokenSecret &#x3D; crypto.randomBytes(16).toString(&#39;hex&#39;),</span><br><span class="line">    token &#x3D; jwt.encode(openId, tokenSecret);</span><br><span class="line">     </span><br><span class="line">    let userInfo &#x3D; &#123;</span><br><span class="line">        openId : res.data.openid,</span><br><span class="line">        nickName : event.userInfo.nickName,</span><br><span class="line">        avatarUrl : event.userInfo.avatarUrl,</span><br><span class="line">        gender : event.userInfo.gender,</span><br><span class="line">        city : event.userInfo.city,</span><br><span class="line">        balance: &#39;&#39;,</span><br><span class="line">        couponNum: &#39;&#39;,</span><br><span class="line">        currentValue: &#39;&#39;,</span><br><span class="line">        giftBalance: &#39;&#39;,</span><br><span class="line">        level:&#39;&#39;,</span><br><span class="line">        pointNum:&#39;&#39;,</span><br><span class="line">        CreateTime: time,</span><br><span class="line">        lastLoginTime : time</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    let userUpdate &#x3D; &#123;</span><br><span class="line">        openId : res.data.openid,</span><br><span class="line">        nickName : event.userInfo.nickName,</span><br><span class="line">        avatarUrl : event.userInfo.avatarUrl,</span><br><span class="line">        gender : event.userInfo.gender,</span><br><span class="line">        city : event.userInfo.city,</span><br><span class="line">        lastLoginTime : time</span><br><span class="line">    &#125;</span><br><span class="line">    let userResult</span><br><span class="line">    </span><br><span class="line">    const userInDB &#x3D; await db.collection(&#39;users&#39;).where(&#123;</span><br><span class="line">      openId</span><br><span class="line">    &#125;).limit(1).get();</span><br><span class="line">    </span><br><span class="line">    if (userInDB.data &amp;&amp; userInDB.data.length &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">      userResult &#x3D; await db.collection(&#39;users&#39;).add(&#123;</span><br><span class="line">        ...userInfo,</span><br><span class="line">        tokenSecret,</span><br><span class="line">        exp:Date.now() + tonkenExp</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      userResult &#x3D; await db.collection(&#39;users&#39;).where(&#123;openId&#125;).update(&#123;</span><br><span class="line">          ...userUpdate,</span><br><span class="line">          tokenSecret,</span><br><span class="line">          exp:Date.now() + tonkenExp</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const fields &#x3D; &#123;</span><br><span class="line">        </span><br><span class="line">        nickName : 1,</span><br><span class="line">        avatarUrl : 1,</span><br><span class="line">        balance: 1,</span><br><span class="line">        couponNum: 1,</span><br><span class="line">        currentValue: 1,</span><br><span class="line">        giftBalance: 1,</span><br><span class="line">        level:1,</span><br><span class="line">        pointNum:1,</span><br><span class="line">        gender:1</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    let ResultOK &#x3D; await db.collection(&#39;users&#39;).where(&#123;openId&#125;).field(fields).get();</span><br><span class="line">    let ResultData &#x3D; ResultOK.data[0];</span><br><span class="line">  &#x2F;&#x2F;返回数据给客户端</span><br><span class="line">    if (userResult.id || userResult.updated &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          &quot;status&quot;: 0,</span><br><span class="line">          &quot;data&quot;: ResultData,</span><br><span class="line">          &quot;token&quot;: token,</span><br><span class="line">          &quot;msg&quot;: &#39;登录成功&#39;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      return &#123;</span><br><span class="line">        &quot;status&quot;: -1,</span><br><span class="line">        &quot;msg&quot;: &#39;微信登录失败&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="个人中心页面开发"><a href="#个人中心页面开发" class="headerlink" title="个人中心页面开发"></a>个人中心页面开发</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;position-relative&quot;&gt;</span><br><span class="line">            &lt;image src&#x3D;&quot;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s16&#x2F;images&#x2F;2020&#x2F;01&#x2F;20&#x2F;9a82219bedcae5c2.jpeg&quot; class&#x3D;&quot;bg&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">            &lt;button type&#x3D;&quot;default&quot; size&#x3D;&quot;mini&quot; class&#x3D;&quot;hym-btn&quot; @tap&#x3D;&quot;memberCode&quot;&gt;</span><br><span class="line">                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;hym.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                &lt;text&gt;会员码&lt;&#x2F;text&gt;</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;view style&#x3D;&quot;padding: 0 30rpx;&quot;&gt;</span><br><span class="line">            &lt;!-- user box begin --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;user-box&quot;&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;view class&#x3D;&quot;user-info&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;avatar&quot;&gt;</span><br><span class="line">                        &lt;image :src&#x3D;&quot;isLogin ? userInfo.avatarUrl : &#39;&#x2F;static&#x2F;images&#x2F;mine&#x2F;default.png&#39;&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;badge&quot; v-if&#x3D;&quot;isLogin&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;level.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view&gt;&#123;&#123; userInfo.level &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;d-flex flex-column flex-fill overflow-hidden&quot; style&#x3D;&quot;margin-top: 20rpx;&quot;&gt;</span><br><span class="line">                        &lt;view v-if&#x3D;&quot;isLogin&quot; class&#x3D;&quot;font-size-lg font-weight-bold d-flex justify-content-start align-items-center&quot;</span><br><span class="line">                            @tap&#x3D;&quot;userinfo&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;text-truncate&quot;&gt;&#123;&#123; userInfo.nickName &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;iconfont iconarrow-right line-height-100&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view v-else class&#x3D;&quot;font-size-lg font-weight-bold&quot; @tap&#x3D;&quot;login&quot;&gt;请点击授权登录&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm text-color-assist&quot;&gt;</span><br><span class="line">                            当前成长值&#123;&#123; isLogin ? userInfo.currentValue : 0 &#125;&#125;&#x2F;&#123;&#123; isLogin ? userInfo.currentValue + userInfo.needValue : 0 &#125;&#125;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;w-100&quot;&gt;</span><br><span class="line">                             &lt;progress percent&#x3D;&quot;0&quot; activeColor&#x3D;&quot;#ADB838&quot; height&#x3D;&quot;8rpx&quot; :percent&#x3D;&quot;growthValue&quot; border-radius&#x3D;&quot;8rpx&quot;&#x2F;&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;level-benefit d-flex flex-shrink-0 align-items-center justify-content-end text-color-white bg-warning font-size-sm&quot;&gt;</span><br><span class="line">                        &lt;view&gt;会员权益&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont iconarrow-right line-height-100&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;!-- user grid begin --&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;w-100 d-flex align-items-center just-content-center&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;user-grid&quot; @tap&#x3D;&quot;coupons&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;value font-size-extra-lg font-weight-bold text-color-base&quot;&gt;</span><br><span class="line">                            &#123;&#123;  isLogin ? userInfo.couponNum : &#39;***&#39; &#125;&#125;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm text-color-assist&quot;&gt;奈雪券&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;user-grid&quot; @tap&#x3D;&quot;integrals&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;value font-size-extra-lg font-weight-bold text-color-base&quot;&gt;</span><br><span class="line">                            &#123;&#123;  isLogin ? userInfo.pointNum : &#39;***&#39; &#125;&#125;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm text-color-assist&quot;&gt;积分商城&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;user-grid&quot; @tap&#x3D;&quot;balance&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;value font-size-extra-lg font-weight-bold text-color-base&quot;&gt;</span><br><span class="line">                            &#123;&#123;  isLogin ? userInfo.balance : &#39;***&#39; &#125;&#125;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm text-color-assist&quot;&gt;余额&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;user-grid&quot; @tap&#x3D;&quot;giftCards&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;value font-size-extra-lg font-weight-bold text-color-base&quot;&gt;</span><br><span class="line">                            &#123;&#123;  isLogin ? userInfo.giftBalance : &#39;***&#39; &#125;&#125;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm text-color-assist&quot;&gt;礼品卡&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;!-- user grid end --&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- user box end --&gt;</span><br><span class="line">            &lt;!-- level benefit box begin --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;level-benefit-box&quot; v-if&#x3D;&quot;!isLogin&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;d-flex align-items-center justify-content-between font-size-base&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;text-color-base&quot;&gt;新用户加入会员，享会员权益&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;text-color-primary&quot; @tap&#x3D;&quot;login&quot;&gt;立即加入&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;rhyl.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;入会有礼&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;jfdh.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;积分兑换&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;sjtq.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;升级特权&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;srtq.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;生日特权&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;nxbz.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view&gt;奈雪宝藏&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- level benefit box end --&gt;</span><br><span class="line">            &lt;!-- banner begin --&gt;</span><br><span class="line">            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;banner.png&quot; class&#x3D;&quot;banner&quot; mode&#x3D;&quot;widthFix&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">            &lt;!-- bennaer end --&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- service box begin --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;service-box&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;font-size-lg text-color-base font-weight-bold&quot; style&#x3D;&quot;margin-bottom: 20rpx;&quot;&gt;我的服务&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot; @tap&#x3D;&quot;attendance&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;jfqd.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;积分签到&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;stxy.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;送她心愿&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;image :src&#x3D;&quot;newIcon&quot; class&#x3D;&quot;new-badage&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;nxsc.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;奈雪商城&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;lxkf.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;联系客服&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot; @tap&#x3D;&quot;orders&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;wddd.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;我的订单&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot; @tap&#x3D;&quot;userinfo&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;wdzl.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;我的资料&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot; @tap&#x3D;&quot;addresses&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;shdz.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;收货地址&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;grid&quot; @tap&#x3D;&quot;services&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;mine&#x2F;gdfw.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;更多服务&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- service box end --&gt;</span><br><span class="line">        &lt;!-- tips begin --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;d-flex just-content-center align-items-center text-color-assist&quot; style&#x3D;&quot;padding: 30rpx 0; font-size: 22rpx;&quot;&gt;</span><br><span class="line">            会员卡适用于奈雪的茶和奈雪酒屋指定范围</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- tisps end --&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><h4 id="个人中心CSS样式"><a href="#个人中心CSS样式" class="headerlink" title="个人中心CSS样式"></a><strong>个人中心CSS样式</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">    height: auto;</span><br><span class="line">    min-height: 100%;</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">.bg &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: calc(410 &#x2F; 594 * 750rpx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.hym-btn &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 40rpx;</span><br><span class="line">    right: 40rpx;</span><br><span class="line">    color: $color-primary;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    border-radius: 50rem;</span><br><span class="line">    font-size: $font-size-sm;</span><br><span class="line">    box-shadow: 0 0 20rpx rgba(66,66,66,0.1);</span><br><span class="line">    &amp;::after &#123;</span><br><span class="line">        border: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    image &#123;</span><br><span class="line">        width: 30rpx;</span><br><span class="line">        height: 30rpx;</span><br><span class="line">        margin-right: 10rpx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-box &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    border-radius: 8rpx; </span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">    margin-top: -115rpx;</span><br><span class="line">    box-shadow: $box-shadow;</span><br><span class="line">    display:flex;</span><br><span class="line">    dis-di:column;</span><br><span class="line">    backgroud-color:#ffffff;</span><br><span class="line">&#125;</span><br><span class="line">.user-info &#123;</span><br><span class="line">    display:flex;</span><br><span class="line">    align-item:center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.avatar &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    margin-top: -35rpx;</span><br><span class="line">    margin-left: 35rpx;</span><br><span class="line">    margin-right: 35rpx;</span><br><span class="line">    width: 160rpx;</span><br><span class="line">    height: 160rpx;</span><br><span class="line">    border-radius: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    background-color: #FFFFFF;</span><br><span class="line">    box-shadow: 0 0 20rpx rgba($color: #000000, $alpha: 0.2);</span><br><span class="line">    </span><br><span class="line">    image &#123;</span><br><span class="line">        width: 140rpx;</span><br><span class="line">        height: 140rpx;</span><br><span class="line">        border-radius: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .badge &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        right: -10rpx;</span><br><span class="line">        bottom: -10rpx;</span><br><span class="line">        background-color: #FFFFFF;</span><br><span class="line">        border-radius: 50rem;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        color: $color-warning;</span><br><span class="line">        font-size: 24rpx;</span><br><span class="line">        padding: 8rpx 16rpx;</span><br><span class="line">        box-shadow: 0 0 20rpx rgba($color: #000000, $alpha: 0.2);</span><br><span class="line">        </span><br><span class="line">        image &#123;</span><br><span class="line">            width: 30rpx;</span><br><span class="line">            height: 30rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.level-benefit &#123;</span><br><span class="line">    margin-left: 35rpx;</span><br><span class="line">    padding: 10rpx 0 10rpx 30rpx;</span><br><span class="line">    border-radius: 50rem 0 0 50rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-grid &#123;</span><br><span class="line">    width: 25%;</span><br><span class="line">    padding: 30rpx;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    </span><br><span class="line">    .value &#123;</span><br><span class="line">        margin-bottom: 20rpx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.level-benefit-box &#123;</span><br><span class="line">    border-radius: 8rpx; </span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">    box-shadow: 0 10rpx 8rpx rgba($color: #878889, $alpha: 0.1);</span><br><span class="line">    width: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    padding: 30rpx;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    background-color: #FFFFFF;</span><br><span class="line">    </span><br><span class="line">    .row &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        padding: 30rpx 0 20rpx;</span><br><span class="line">        justify-content: space-around;</span><br><span class="line">        align-items: center;</span><br><span class="line">        </span><br><span class="line">        .grid &#123;</span><br><span class="line">            width: 20%;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            color: $text-color-assist;</span><br><span class="line">            align-items: center;</span><br><span class="line"></span><br><span class="line">            image &#123;</span><br><span class="line">                width: 80rpx;</span><br><span class="line">                height: 80rpx;</span><br><span class="line">                margin-bottom: 10rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.banner &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    border-radius: 8rpx;</span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.service-box &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    background-color: #FFFFFF;</span><br><span class="line">    padding: 32rpx 30rpx 10rpx;</span><br><span class="line">    box-shadow: $box-shadow;</span><br><span class="line">    </span><br><span class="line">    .row &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-wrap: wrap;</span><br><span class="line">        color: $text-color-assist;</span><br><span class="line">        font-size: $font-size-sm;</span><br><span class="line">        padding-bottom: -40rpx;</span><br><span class="line">        </span><br><span class="line">        .grid &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            margin-bottom: 40rpx;</span><br><span class="line">            width: 25%;</span><br><span class="line">            position: relative;</span><br><span class="line">            </span><br><span class="line">            .image &#123;</span><br><span class="line">                image &#123;</span><br><span class="line">                    width: 80rpx;</span><br><span class="line">                    height: 80rpx;</span><br><span class="line">                    margin-bottom: 20rpx;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .new-badage &#123;</span><br><span class="line">                width: 40rpx;</span><br><span class="line">                height: 40rpx;</span><br><span class="line">                position: absolute;</span><br><span class="line">                top: 0;</span><br><span class="line">                right: 30rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="我的地址模块开发"><a href="#我的地址模块开发" class="headerlink" title="我的地址模块开发"></a>我的地址模块开发</h3><h4 id="validateToken验证"><a href="#validateToken验证" class="headerlink" title="validateToken验证"></a>validateToken验证</h4><p>jwt编码解码模块流程实现</p><p>生成token存在weichat</p><p>storage当中</p><p>提取storage缓存的token向服务器提交验证登录用户的鉴权</p><p>然后再返回用户个人数据</p><p><strong>【unicloud】端新建云函数vadidateToken</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;引入库包</span><br><span class="line">const jwt &#x3D; require(&#39;jwt-simple&#39;)</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br></pre></td></tr></table></figure><h4 id="token"><a href="#token" class="headerlink" title="token"></a>token</h4><p>整个token 分为三部分：头部（header)、载荷（payload, )、签证（signature)，上方截图中的token字符串是由此三部分经过base64加密得到的</p><p>解码token，得到openId</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const token &#x3D; event.token</span><br><span class="line">    const userFromToken &#x3D; JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString())</span><br></pre></td></tr></table></figure><p><strong>验证数据库有无此openId用户</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const userInDB &#x3D; await db.collection(&#39;users&#39;).where(&#123;openId:userFromToken&#125;).get()</span><br><span class="line">    if (userInDB.data.length !&#x3D;&#x3D; 1) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        status: -1,</span><br><span class="line">        errCode: &#39;TOKEN_INVALID&#39;,</span><br><span class="line">        msg: &#39;查无此人&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>解码token</strong></p><p>并且通过验证exp时间判断token是否过期</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const userInfoDB &#x3D; userInDB.data[0]</span><br><span class="line">    let userInfoDecode</span><br><span class="line">    </span><br><span class="line">    userInfoDecode &#x3D; jwt.decode(token, userInfoDB.tokenSecret)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    if (userInfoDB.exp &gt; Date.now() &amp;&amp; userInfoDecode &#x3D;&#x3D; userFromToken ) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        status: 0,</span><br><span class="line">        openId: userInfoDecode,</span><br><span class="line">        msg: &#39;token验证成功&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>如果时间超过token下发时限则判断为失效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (userInfoDB.exp &lt; Date.now()) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        status: -3,</span><br><span class="line">        errCode: &#39;TOKEN_EXPIRED&#39;,</span><br><span class="line">        msg: &#39;token已失效&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="地址列表查询"><a href="#地址列表查询" class="headerlink" title="地址列表查询"></a>地址列表查询</h4><p>首页外卖入口添加address链接</p><p>地址首先样式拷贝</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">.main &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        padding: 30rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        </span><br><span class="line">        .address-wrapper &#123;</span><br><span class="line">            margin-bottom: 30rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .address &#123;</span><br><span class="line">            width: 100%;</span><br><span class="line">            padding: 40rpx 30rpx;</span><br><span class="line">            background-color: #FFFFFF;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: space-between;</span><br><span class="line">            align-items: center;</span><br><span class="line">            margin-bottom: 10rpx;</span><br><span class="line">            </span><br><span class="line">            .right &#123;</span><br><span class="line">                flex: 1;</span><br><span class="line">                overflow: hidden;</span><br><span class="line">                display: flex;</span><br><span class="line">                flex-direction: column;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .edit-icon &#123;</span><br><span class="line">                width: 50rpx;</span><br><span class="line">                height: 50rpx;</span><br><span class="line">                flex-shrink: 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .address-button &#123;</span><br><span class="line">            height: 100rpx;</span><br><span class="line">            position: fixed;</span><br><span class="line">            bottom: 0;</span><br><span class="line">            left: 0;</span><br><span class="line">            right: 0;</span><br><span class="line">            padding: 10rpx 0;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            </span><br><span class="line">            button &#123;</span><br><span class="line">                height: 80rpx;</span><br><span class="line">                width: 80%;</span><br><span class="line">                border-radius: 50rem !important;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: center;</span><br><span class="line">                justify-content: center;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>首先创建一个数组addressList</p><p>如果地址列表不存在则显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;view v-if&#x3D;&quot;!addressList.length&quot; style&#x3D;&quot;color: #878889;&quot;&gt;</span><br><span class="line">                &lt;view&gt;暂无地址信息&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view&gt;请点击底部按钮添加地址信息&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>用户地址如果存在</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;main&quot;&gt;</span><br><span class="line">            &lt;view v-if&#x3D;&quot;!addressList.length&quot; style&#x3D;&quot;color: #878889;&quot;&gt;</span><br><span class="line">                &lt;view&gt;暂无地址信息&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view&gt;请点击底部按钮添加地址信息&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;template v-else&gt;</span><br><span class="line">                &lt;uni-swipe-action&gt;</span><br><span class="line">                    &lt;uni-swipe-action-item class&#x3D;&quot;address-wrapper&quot; :options&#x3D;&quot;swipeOption&quot; @click&#x3D;&quot;handleSwipeClick(address._id)&quot; v-for&#x3D;&quot;(address, index) in addressList&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;address&quot; @tap&#x3D;&quot;chooseAddress(address)&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;left flex-fill overflow-hidden mr-20&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;font-size-lg font-weight-bold text-truncate&quot; style&#x3D;&quot;margin-bottom: 10rpx;&quot;&gt;&#123;&#123; address.street &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;font-size-sm text-color-assist&quot;&gt;</span><br><span class="line">                                    &#123;&#123; address.accept_name &#125;&#125; &#123;&#123; !address.gender ? &#39;先生&#39; : &#39;女士&#39; &#125;&#125; &#123;&#123; address.mobile &#125;&#125;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;edit.png&quot; class&#x3D;&quot;edit-icon&quot; @tap&#x3D;&quot;edit(address._id)&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;uni-swipe-action-item&gt;</span><br><span class="line">                &lt;&#x2F;uni-swipe-action&gt;</span><br><span class="line">            &lt;&#x2F;template&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;address-button&quot;&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;primary&quot;  size&#x3D;&quot;default&quot; @tap&#x3D;&quot;add&quot;&gt;新增地址&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>在script中添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        addressList:[],</span><br><span class="line">        swipeOption: [</span><br><span class="line">            &#123;</span><br><span class="line">                text: &#39;删除&#39;,</span><br><span class="line">                style: &#123;</span><br><span class="line">                    backgroundColor: &#39;#D12E32&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>计算属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onLoad() &#123;</span><br><span class="line">            this.getAddress()</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><p>方法函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">getAddress() &#123;</span><br><span class="line">                uni.showLoading(&#123;</span><br><span class="line">                    title:&#39;数据加载中...&#39;</span><br><span class="line">                &#125;);</span><br><span class="line">                return uniCloud.callFunction(&#123;</span><br><span class="line">                    name:&#39;validateToken&#39;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        token:uni.getStorageSync(&#39;token&#39;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                    if(res.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        return uniCloud.callFunction(&#123;</span><br><span class="line">                            name:&#39;getAddress&#39;,</span><br><span class="line">                            </span><br><span class="line">                            data:&#123;</span><br><span class="line">                                openId:res.result.openId</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content: res.result.msg,</span><br><span class="line">                            showCancel: false</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then((resData) &#x3D;&gt;&#123;</span><br><span class="line">                    this.addressList &#x3D; resData.result.data</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>【unicloud】新建getAddress云函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const openId &#x3D; event.openId</span><br><span class="line">        const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;openId&#125;).get()</span><br><span class="line">        const resData &#x3D; res.data</span><br><span class="line">        return &#123;</span><br><span class="line">            status:0,</span><br><span class="line">            data:resData</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="地址列表删除"><a href="#地址列表删除" class="headerlink" title="地址列表删除"></a><strong>地址列表删除</strong></h4><p>uni-app端函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 删除地址</span><br><span class="line">            handleClickOption(id) &#123;</span><br><span class="line">                uni.showModal(&#123;</span><br><span class="line">                    title: &#39;提示&#39;,</span><br><span class="line">                    content: &#39;确定要删除？&#39;,</span><br><span class="line">                    success: res &#x3D;&gt; &#123;</span><br><span class="line">                        if(res.confirm) &#123;</span><br><span class="line">                            return uniCloud.callFunction(&#123;</span><br><span class="line">                                name:&#39;deleteAddress&#39;,</span><br><span class="line">                                data:&#123;id:id&#125;</span><br><span class="line">                            &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                                console.log(res)</span><br><span class="line">                                if(res.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                                    uni.showToast(&#123;title: &#39;删除成功！&#39;, icon: &#39;success&#39;&#125;)</span><br><span class="line">                                    this.getAddress()</span><br><span class="line">                                &#125;</span><br><span class="line">                                uni.showModal(&#123;</span><br><span class="line">                                    content: res.result.msg,</span><br><span class="line">                                    showCancel: false</span><br><span class="line">                                &#125;)</span><br><span class="line">                            &#125;)</span><br><span class="line">                            </span><br><span class="line">                            </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>【unicloud云函数】deleteAddress</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">  const _id &#x3D; event.id</span><br><span class="line">  const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;_id&#125;).remove()</span><br><span class="line"> </span><br><span class="line">  if(res.requestId)&#123;</span><br><span class="line">      return &#123;</span><br><span class="line">          status:0,</span><br><span class="line">          msg:&#39;删除成功&#39;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">        return &#123;</span><br><span class="line">            status:-1,</span><br><span class="line">            msg:&#39;删除失败&#39;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="用户新增地址"><a href="#用户新增地址" class="headerlink" title="用户新增地址"></a><strong>用户新增地址</strong></h4><p>地址列表添加button,新增地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;address-button&quot;&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;primary&quot;  size&#x3D;&quot;default&quot; @tap&#x3D;&quot;add&quot;&gt;新增地址&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>跳转到add.vue,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 添加地址</span><br><span class="line">            add() &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url:&#39;&#x2F;pages&#x2F;address&#x2F;add&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>新增地址页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;form-box&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;form&quot;&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;form-input&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;label&quot;&gt;收货人&lt;&#x2F;view&gt;</span><br><span class="line">                         &lt;input class&#x3D;&quot;input&quot; placeholder&#x3D;&quot;请输入收货人&quot; v-model&#x3D;&quot;form.accept_name&quot; placeholder-class&#x3D;&quot;text-color-assist&quot;&#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;form-input&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;label&quot;&gt;性别&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;radio-group&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;radio&quot; :class&#x3D;&quot;&#123;&#39;checked&#39;: !form.gender&#125;&quot; style&#x3D;&quot;margin-right: 10rpx;&quot; @tap&#x3D;&quot;form.gender&#x3D;0&quot;&gt;先生&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;radio&quot; :class&#x3D;&quot;&#123;&#39;checked&#39;: form.gender&#125;&quot; @tap&#x3D;&quot;form.gender&#x3D;1&quot;&gt;女士&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;form-input&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;label&quot;&gt;联系方式&lt;&#x2F;view&gt;</span><br><span class="line">                         &lt;input class&#x3D;&quot;input&quot; placeholder&#x3D;&quot;请输入收货人联系方式&quot; v-model&#x3D;&quot;form.mobile&quot; placeholder-class&#x3D;&quot;text-color-assist&quot;&#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;form-input&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;label&quot;&gt;所在区域&lt;&#x2F;view&gt;</span><br><span class="line">                         &lt;input class&#x3D;&quot;input&quot; placeholder&#x3D;&quot;请输入所在区域&quot; v-model&#x3D;&quot;form.area&quot; placeholder-class&#x3D;&quot;text-color-assist&quot;&#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;form-input&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;label&quot;&gt;收货地址&lt;&#x2F;view&gt;</span><br><span class="line">                         &lt;input class&#x3D;&quot;input&quot; placeholder&#x3D;&quot;请输入收货人详细地址&quot; v-model&#x3D;&quot;form.street&quot; placeholder-class&#x3D;&quot;text-color-assist&quot;&#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;btn-section&quot;&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;primary&quot; size&#x3D;&quot;default&quot; @tap&#x3D;&quot;save&quot;&gt;保存&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import listCell from &#39;@&#x2F;components&#x2F;list-cell&#x2F;list-cell&#39;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line">            listCell</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                form: &#123;</span><br><span class="line">                    accept_name: &#39;&#39;,</span><br><span class="line">                    gender: 0,</span><br><span class="line">                    mobile: &#39;&#39;,</span><br><span class="line">                    area:&#39;&#39;,</span><br><span class="line">                    street: &#39;&#39;,</span><br><span class="line">                    openId:&#39;&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    </span><br><span class="line">        methods: &#123;</span><br><span class="line">            save() &#123;</span><br><span class="line">                let data &#x3D; this.form</span><br><span class="line">                return uniCloud.callFunction(&#123;</span><br><span class="line">                    name:&#39;validateToken&#39;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        token:uni.getStorageSync(&#39;token&#39;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                    if(res.result.status &#x3D;&#x3D;&#x3D; 0)&#123;</span><br><span class="line">                        this.form.openId &#x3D; res.result.openId</span><br><span class="line">                        return uniCloud.callFunction(&#123;</span><br><span class="line">                            name:&#39;addAddress&#39;,</span><br><span class="line">                            data:&#123;</span><br><span class="line">                                data</span><br><span class="line">                                </span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                            if(res.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                                uni.showToast(&#123;</span><br><span class="line">                                    title:&#39;添加成功&#39;</span><br><span class="line">                                &#125;)</span><br><span class="line">                                uni.navigateBack(&#123;</span><br><span class="line">                                    </span><br><span class="line">                                &#125;)</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                uni.showModal(&#123;</span><br><span class="line">                                    content:res.result.msg,</span><br><span class="line">                                    showCancel:false</span><br><span class="line">                                &#125;)</span><br><span class="line">                            &#125;</span><br><span class="line">                            </span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">    .form-box &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;</span><br><span class="line">        padding: 30rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        color: $text-color-base;</span><br><span class="line">        </span><br><span class="line">        .form-input &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            width: 100%;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .label &#123;</span><br><span class="line">            width: 200rpx;</span><br><span class="line">            font-size: $font-size-lg;</span><br><span class="line">            color: $text-color-base;</span><br><span class="line">            font-weight: 500;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .input &#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .radio-group &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: flex-start;</span><br><span class="line">            </span><br><span class="line">            .radio &#123;</span><br><span class="line">                padding: 10rpx 30rpx;</span><br><span class="line">                border-radius: 6rpx;</span><br><span class="line">                border: 2rpx solid $text-color-assist;</span><br><span class="line">                color: $text-color-assist;</span><br><span class="line">                font-size: $font-size-base;</span><br><span class="line">                </span><br><span class="line">                &amp;.checked &#123;</span><br><span class="line">                    background-color: $color-primary;</span><br><span class="line">                    color: $text-color-white;</span><br><span class="line">                    border: 2rpx solid $color-primary;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .btn-section &#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            </span><br><span class="line">            button &#123;</span><br><span class="line">                font-size: $font-size-base;</span><br><span class="line">                height: 90rpx;</span><br><span class="line">                border-radius: 50rem !important;</span><br><span class="line">                width: 85%;</span><br><span class="line">                display: flex;</span><br><span class="line">                align-items: center;</span><br><span class="line">                justify-content: center;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在pages.json中注册add.vue</p><p><strong>【unicloud】写addAddress接口</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">  const data &#x3D; event.data</span><br><span class="line">  const street &#x3D; event.data.street</span><br><span class="line">  const addressDB &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;street&#125;).get()</span><br><span class="line">  if(addressDB.data.length &#x3D;&#x3D;&#x3D;0)&#123;</span><br><span class="line">      const res &#x3D; await db.collection(&#39;addresses&#39;).add(data)</span><br><span class="line">      return &#123;</span><br><span class="line">          status:0,</span><br><span class="line">          msg:&#39;添加成功&#39;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">        status:-1,</span><br><span class="line">        msg:&#39;地址已存在&#39;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="修改用户地址"><a href="#修改用户地址" class="headerlink" title="修改用户地址"></a>修改用户地址</h4><h5 id="1-address-vue页面edit-触发事件"><a href="#1-address-vue页面edit-触发事件" class="headerlink" title="1.address.vue页面edit 触发事件"></a>1.address.vue页面edit 触发事件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">引入 import &#123;mapState,mapMutations&#125; from &#39;vuex&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">computed:&#123;</span><br><span class="line">            ...mapState([&#39;choseAddress&#39;])</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br></pre></td></tr></table></figure><p>在methds当中引入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...mapMutations([&#39;SET_ADDRESS&#39;]),</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">edit(address) &#123;</span><br><span class="line">                </span><br><span class="line">                this.SET_ADDRESS(address)</span><br><span class="line">            </span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url:&#39;&#x2F;pages&#x2F;address&#x2F;edit&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><h5 id="2-edit-vue界面"><a href="#2-edit-vue界面" class="headerlink" title="2.edit.vue界面"></a>2.edit.vue界面</h5><p>template和css样式我照add.vue </p><p>js这边 choseAddress</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                form: &#123;</span><br><span class="line">                    _id:&#39;&#39;,</span><br><span class="line">                    accept_name: &#39;&#39;,</span><br><span class="line">                    gender: &#39;&#39;,</span><br><span class="line">                    mobile: &#39;&#39;,</span><br><span class="line">                    street: &#39;&#39;,</span><br><span class="line">                    area: &#39;&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">            ...mapState([&#39;choseAddress&#39;])</span><br><span class="line">        &#125;,</span><br><span class="line">        onLoad() &#123;</span><br><span class="line">            this.form &#x3D; this.choseAddress</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            editSave()&#123;</span><br><span class="line">                let data &#x3D; this.form</span><br><span class="line">                console.log(data)</span><br><span class="line">                return uniCloud.callFunction(&#123;</span><br><span class="line">                    name:&#39;editAddress&#39;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        data</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then(res &#x3D;&gt;&#123;</span><br><span class="line">                    if(res.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        uni.showToast(&#123;</span><br><span class="line">                            title:&#39;修改成功&#39;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>3.【unicloud】端editAddress函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">  let _id &#x3D; event.data._id</span><br><span class="line">  let fields &#x3D; &#123;</span><br><span class="line">      accept_name: event.data.accept_name,</span><br><span class="line">      gender: event.data.gender,</span><br><span class="line">      mobile: event.data.mobile,</span><br><span class="line">      area:event.data.area,</span><br><span class="line">      street: event.data.street</span><br><span class="line">  &#125;</span><br><span class="line">  const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;_id&#125;).update(&#123;...fields&#125;)</span><br><span class="line">    if(res.updated &#x3D;&#x3D;&#x3D; 1)&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            status:0,</span><br><span class="line">            msg:&#39;数据修改成功&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if(res.updated &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            status:-1,</span><br><span class="line">            msg:&#39;地址未改变&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="云函数合并"><a href="#云函数合并" class="headerlink" title="云函数合并"></a>云函数合并</h4><p>之前我们address模块更删改查共分了4个云函数</p><p>如果合并在一起，看起来会更加美观优雅</p><p>【unicloud】后端部分用address函数整合get\add\edit\delete</p><p>uni-app前端 unicloud.callfuction函数data中添加action</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">  if(event.action &#x3D;&#x3D; &#39;getList&#39;) &#123;</span><br><span class="line">      const openId &#x3D; event.openId</span><br><span class="line">      const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;openId&#125;).get()</span><br><span class="line">      const resData &#x3D; res.data</span><br><span class="line">      return &#123;</span><br><span class="line">          status:0,</span><br><span class="line">          data:resData</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; else if(event.action &#x3D;&#x3D; &#39;deleteAddress&#39;) &#123;</span><br><span class="line">      const _id &#x3D; event.id</span><br><span class="line">      const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;_id&#125;).remove()</span><br><span class="line">       </span><br><span class="line">      if(res.requestId)&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                status:0,</span><br><span class="line">                msg:&#39;删除成功&#39;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">              return &#123;</span><br><span class="line">                  status:-1,</span><br><span class="line">                  msg:&#39;删除失败&#39;</span><br><span class="line">              &#125;</span><br><span class="line">  &#125; else if(event.action &#x3D;&#x3D; &#39;addAddress&#39;) &#123;</span><br><span class="line">      const data &#x3D; event.data</span><br><span class="line">      const street &#x3D; event.data.street</span><br><span class="line">      const addressDB &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;street&#125;).get()</span><br><span class="line">      if(addressDB.data.length &#x3D;&#x3D;&#x3D;0)&#123;</span><br><span class="line">            const res &#x3D; await db.collection(&#39;addresses&#39;).add(data)</span><br><span class="line">            return &#123;</span><br><span class="line">                status:0,</span><br><span class="line">                msg:&#39;添加成功&#39;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">          return &#123;</span><br><span class="line">              status:-1,</span><br><span class="line">              msg:&#39;地址已存在&#39;</span><br><span class="line">          &#125;</span><br><span class="line">  &#125; else if(event.action &#x3D;&#x3D; &#39;editAddress&#39;) &#123;</span><br><span class="line">      let _id &#x3D; event.data._id</span><br><span class="line">      let fields &#x3D; &#123;</span><br><span class="line">            accept_name: event.data.accept_name,</span><br><span class="line">            gender: event.data.gender,</span><br><span class="line">            mobile: event.data.mobile,</span><br><span class="line">            area:event.data.area,</span><br><span class="line">            street: event.data.street</span><br><span class="line">      &#125;</span><br><span class="line">      const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;_id&#125;).update(&#123;...fields&#125;)</span><br><span class="line">          if(res.updated &#x3D;&#x3D;&#x3D; 1)&#123;</span><br><span class="line">              return &#123;</span><br><span class="line">                  status:0,</span><br><span class="line">                  msg:&#39;数据修改成功&#39;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; else if(res.updated &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">              return &#123;</span><br><span class="line">                  status:-1,</span><br><span class="line">                  msg:&#39;地址未改变&#39;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="门店选择模块开发"><a href="#门店选择模块开发" class="headerlink" title="门店选择模块开发"></a>门店选择模块开发</h3><p>​    uni-app的map 组件</p><p>目前uni-app支持的小程序</p><table><thead><tr><th align="center">App</th><th align="center">H5</th><th align="center">微信小程序</th><th align="center">支付宝小程序</th><th align="center">百度小程序</th><th align="center">字节跳动小程序</th><th align="center">QQ小程序</th><th align="center">快应用</th><th align="center">360小程序</th></tr></thead><tbody><tr><td align="center">√</td><td align="center">√</td><td align="center">√</td><td align="center">√</td><td align="center">√</td><td align="center">1.63+</td><td align="center">1.9.0+</td><td align="center">√</td><td align="center">x</td></tr></tbody></table><p><strong>门店选择模块</strong></p><ul><li>定位附近门店</li><li>计算最近门店距离</li><li>展示门店信息列表</li></ul><h4 id="首先我们了解下小程序map组件"><a href="#首先我们了解下小程序map组件" class="headerlink" title="首先我们了解下小程序map组件"></a>首先我们了解下小程序map组件</h4><p>uni-app map组件官网</p><p><a href="https://uniapp.dcloud.io/component/map?id=map">https://uniapp.dcloud.io/component/map?id=map</a></p><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th><th align="left">平台差异说明</th></tr></thead><tbody><tr><td align="left">longitude</td><td align="left">Number</td><td align="left"></td><td align="left">中心经度</td><td align="left"></td></tr><tr><td align="left">latitude</td><td align="left">Number</td><td align="left"></td><td align="left">中心纬度</td><td align="left"></td></tr><tr><td align="left">scale</td><td align="left">Number</td><td align="left">16</td><td align="left">缩放级别，取值范围为5-18</td><td align="left"></td></tr><tr><td align="left">markers</td><td align="left">Array</td><td align="left"></td><td align="left">标记点</td><td align="left"></td></tr><tr><td align="left">polyline</td><td align="left">Array</td><td align="left"></td><td align="left">路线</td><td align="left"></td></tr><tr><td align="left">circles</td><td align="left">Array</td><td align="left"></td><td align="left">圆</td><td align="left"></td></tr><tr><td align="left">controls</td><td align="left">Array</td><td align="left"></td><td align="left">控件</td><td align="left"></td></tr><tr><td align="left">include-points</td><td align="left">Array</td><td align="left"></td><td align="left">缩放视野以包含所有给定的坐标点</td><td align="left">App-nvue 2.1.5+、微信小程序、H5、百度小程序、支付宝小程序</td></tr><tr><td align="left">enable-3D</td><td align="left">Boolean</td><td align="left">false</td><td align="left">是否显示3D楼块</td><td align="left">App-nvue 2.1.5+、微信小程序2.3.0</td></tr><tr><td align="left">show-compass</td><td align="left">Boolean</td><td align="left">false</td><td align="left">是否显示指南针</td><td align="left">App-nvue 2.1.5+、微信小程序2.3.0</td></tr><tr><td align="left">enable-overlooking</td><td align="left">Boolean</td><td align="left">false</td><td align="left">是否开启俯视</td><td align="left">App-nvue 2.1.5+、微信小程序2.3.0</td></tr><tr><td align="left">enable-satellite</td><td align="left">Boolean</td><td align="left">false</td><td align="left">是否开启卫星图</td><td align="left">App-nvue 2.1.5+、微信小程序2.7.0</td></tr><tr><td align="left">enable-traffic</td><td align="left">Boolean</td><td align="left">false</td><td align="left">是否开启实时路况</td><td align="left">App-nvue 2.1.5+、微信小程序2.7.0</td></tr><tr><td align="left">show-location</td><td align="left">Boolean</td><td align="left"></td><td align="left">显示带有方向的当前定位点</td><td align="left">微信小程序、H5、百度小程序、支付宝小程序</td></tr><tr><td align="left">polygons</td><td align="left">Array.<code>&lt;polygon&gt;</code></td><td align="left"></td><td align="left">多边形</td><td align="left">App-nvue 2.1.5+、微信小程序、百度小程序、支付宝小程序</td></tr><tr><td align="left">@markertap</td><td align="left">EventHandle</td><td align="left"></td><td align="left">点击标记点时触发，e.detail = {markerId}</td><td align="left">App-nvue 2.3.3+, App平台需要指定 marker 对象属性 id</td></tr><tr><td align="left">@labeltap</td><td align="left">EventHandle</td><td align="left"></td><td align="left">点击label时触发，e.detail = {markerId}</td><td align="left">微信小程序2.9.0</td></tr><tr><td align="left">@callouttap</td><td align="left">EventHandle</td><td align="left"></td><td align="left">点击标记点对应的气泡时触发，e.detail = {markerId}</td><td align="left"></td></tr><tr><td align="left">@controltap</td><td align="left">EventHandle</td><td align="left"></td><td align="left">点击控件时触发，e.detail = {controlId}</td><td align="left"></td></tr><tr><td align="left">@regionchange</td><td align="left">EventHandle</td><td align="left"></td><td align="left">视野发生变化时触发</td><td align="left">微信小程序、H5、百度小程序、支付宝小程序</td></tr><tr><td align="left">@tap</td><td align="left">EventHandle</td><td align="left"></td><td align="left">点击地图时触发; App-nuve、微信小程序2.9支持返回经纬度</td><td align="left"></td></tr><tr><td align="left">@updated</td><td align="left">EventHandle</td><td align="left"></td><td align="left">在地图渲染更新完成时触发</td><td align="left">微信小程序、H5、百度小程序</td></tr></tbody></table><h4 id="小程序获取用户位置"><a href="#小程序获取用户位置" class="headerlink" title="小程序获取用户位置"></a>小程序获取用户位置</h4><p><strong>uni.getLocation</strong></p><p>获取当前的地理位置、速度。 在微信小程序中，当用户离开应用后，此接口无法调用，除非申请后台持续定位权限；当用户点击“显示在聊天顶部”时，此接口可继续调用。</p><p>成功：latitude, longitude</p><h4 id="uni-app前端小程序页面开发"><a href="#uni-app前端小程序页面开发" class="headerlink" title="uni-app前端小程序页面开发"></a>uni-app前端小程序页面开发</h4><p>index首页页面，如果未有选择门店，则进入门店选择页面</p><p>takein() {<br>                if(!this.chooseStore) {<br>                    uni.navigateTo({<br>                        url:’../stores/stores’<br>                    })<br>                }<br>                {<br>                    this.$store.commit(‘SET_ORDERTYPE’,’takein’)<br>                uni.switchTab({<br>                    url:’../menu/menu’<br>                })<br>                }</p><p>首先是页面结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;!-- 门店地图标记 --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;page-body&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;page-section&quot;&gt;</span><br><span class="line">                &lt;map id&#x3D;&quot;myMap&quot; style&#x3D;&quot;width: 100%; height: 400rpx;&quot; :latitude&#x3D;&quot;latitude&quot; :longitude&#x3D;&quot;longitude&quot;</span><br><span class="line">                :markers&#x3D;&quot;markers&quot;  &gt;</span><br><span class="line">                &lt;&#x2F;map&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;content&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;store&quot; v-for&#x3D;&quot;(store,index) in storeData&quot; :key&#x3D;&quot;index&quot; @tap&#x3D;&quot;tapStore&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;store-left&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;store-title&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;store-name&quot;&gt;&#123;&#123;store.name&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;store-status&quot;&gt;营业中&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;store-content&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;store-distance&quot;&gt;距离您&#123;&#123;store.distance&#125;&#125;km&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;store-text&quot;&gt;&#123;&#123;store.street&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;store-text&quot;&gt;营业时间：10：00-22:30&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;store-rigth&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;look&quot;&gt;</span><br><span class="line">                        去看看</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;icon&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;round&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;images&#x2F;store&#x2F;store-tel.png&quot; &gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;round&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;images&#x2F;store&#x2F;store-nav.png&quot; &gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>css样式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">.content&#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">    .page-body &#123;</span><br><span class="line">        text-align: center;</span><br><span class="line">        height: 400rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    .page-section&#123;</span><br><span class="line">        z-index: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .store &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-wrap: wrap;</span><br><span class="line">        padding:20rpx 30rpx;</span><br><span class="line">        background-color: #FFFFFF;</span><br><span class="line">        margin: 10rpx 20rpx 10rpx 20rpx;</span><br><span class="line">        box-shadow: $box-shadow;</span><br><span class="line">    &#125;</span><br><span class="line">    .store-left &#123;</span><br><span class="line">        width: 70%;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        .store-title &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-wrap: nowrap;</span><br><span class="line">            .store-name &#123;</span><br><span class="line">                margin-right: 30rpx;</span><br><span class="line">                color: $text-color-black;</span><br><span class="line">                font-size: $font-size-lg;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                white-space: nowrap;</span><br><span class="line">                overflow: hidden;</span><br><span class="line">                text-overflow: ellipsis;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .store-status &#123;</span><br><span class="line">                display: flex;</span><br><span class="line">                flex-wrap: nowrap;</span><br><span class="line">                white-space: nowrap;</span><br><span class="line">                padding: 0 5rpx;</span><br><span class="line">                color: $color-primary;</span><br><span class="line">                border: 1rpx solid $color-primary;</span><br><span class="line">                font-size: $font-size-sm;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .store-content &#123;</span><br><span class="line">            margin-top: 60rpx;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">            .store-text &#123;</span><br><span class="line">                color: $text-color-assist;</span><br><span class="line">                white-space: nowrap;</span><br><span class="line">                overflow: hidden;</span><br><span class="line">                text-overflow: ellipsis;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .store-rigth &#123;</span><br><span class="line">        width: 30%;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: flex-end;</span><br><span class="line">        .look &#123;</span><br><span class="line">            font-size: $font-size-sm;</span><br><span class="line">            color: $color-primary;</span><br><span class="line">        &#125;</span><br><span class="line">        .icon &#123;</span><br><span class="line">            margin-top: 60rpx;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-wrap: nowrap;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: flex-end;</span><br><span class="line">            .round &#123;</span><br><span class="line">                </span><br><span class="line">                border-radius: 50%;</span><br><span class="line">                width: 60rpx;</span><br><span class="line">                height: 60rpx;</span><br><span class="line">                background-color: #cad43f;</span><br><span class="line">                margin: 10rpx;</span><br><span class="line">                image &#123;</span><br><span class="line">                    display: block;</span><br><span class="line">                    width: 40rpx;</span><br><span class="line">                    height: 40rpx;</span><br><span class="line">                    border-radius: 50%;</span><br><span class="line">                    margin: 10rpx ;</span><br><span class="line">                    align-items: center;</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>接收门店数据</p><h4 id="计算用户位置到门店距离并且排序显示最近的门店在markers标注上"><a href="#计算用户位置到门店距离并且排序显示最近的门店在markers标注上" class="headerlink" title="计算用户位置到门店距离并且排序显示最近的门店在markers标注上"></a>计算用户位置到门店距离并且排序显示最近的门店在markers标注上</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 两点间距离</span><br><span class="line">            distance(la1, lo1, la2, lo2) &#123;</span><br><span class="line">                var La1 &#x3D; la1 * Math.PI &#x2F; 180.0;</span><br><span class="line">                var La2 &#x3D; la2 * Math.PI &#x2F; 180.0;</span><br><span class="line">                var La3 &#x3D; La1 - La2;</span><br><span class="line">                var Lb3 &#x3D; lo1 * Math.PI &#x2F; 180.0 - lo2 * Math.PI &#x2F; 180.0;</span><br><span class="line">                var s &#x3D; 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(La3 &#x2F; 2), 2) + Math.cos(La1) * Math.cos(La2) * Math.pow(Math.sin(Lb3 &#x2F; 2), 2)));</span><br><span class="line">                s &#x3D; s * 6378.137;&#x2F;&#x2F;地球半径</span><br><span class="line">                s &#x3D; Math.round(s * 10000) &#x2F; 10000;</span><br><span class="line">                s &#x3D; s.toFixed(1);</span><br><span class="line">                return s</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>地球是一个近乎标准的椭球体，它的赤道半径为6378.140千米</p><p>它的半径就是地球的平均半径，记为R。如果以0度经线为基准，</p><p>那么根据地球表面任意两点的经纬度就可以计算出这两点间的地表距离</p><p>获取数据并且排序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">getStoreData()&#123;</span><br><span class="line">            return new Promise((resolve,reject) &#x3D;&gt;&#123;</span><br><span class="line">                &#x2F;&#x2F; 获取用户定位经纬度</span><br><span class="line">                uni.getLocation(&#123;</span><br><span class="line">                    type: &#39;gcj02&#39;,</span><br><span class="line">                    success:(localRes)&#x3D;&gt;&#123;</span><br><span class="line">                        if(localRes.latitude)&#123;</span><br><span class="line">                            resolve(localRes)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;).then(local &#x3D;&gt;&#123;</span><br><span class="line">                    let la1 &#x3D; local.latitude</span><br><span class="line">                    let lo1 &#x3D; local.longitude</span><br><span class="line">                    return uniCloud.callFunction(&#123;</span><br><span class="line">                        name:&#39;stores&#39;,</span><br><span class="line">                        </span><br><span class="line">                    &#125;).then(res &#x3D;&gt;&#123;</span><br><span class="line">                        let temp &#x3D; []</span><br><span class="line">                        let l &#x3D; res.result.length</span><br><span class="line">                        if(l &gt;&#x3D; 1)&#123;</span><br><span class="line">                            for( let i &#x3D; 0;i &lt; l; i++ ) &#123;</span><br><span class="line">                                let element &#x3D;  res.result[i];</span><br><span class="line">                                let d &#x3D; this.distance(element.latitude,element.longitude,la1,lo1)</span><br><span class="line">                                element.distance &#x3D; d</span><br><span class="line">                                temp.push(element)</span><br><span class="line">                            &#125;;</span><br><span class="line">                                this.storeData &#x3D; temp.sort(function(a,b)&#123;</span><br><span class="line">                                    return a.distance - b.distance</span><br><span class="line">                                &#125;)</span><br><span class="line">                                </span><br><span class="line">                                return this.storeData</span><br><span class="line">                                </span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;).then(resMap &#x3D;&gt; &#123;</span><br><span class="line">                    this.latitude &#x3D; resMap[0].latitude</span><br><span class="line">                    this.longitude &#x3D; resMap[0].longitude</span><br><span class="line">                    let map &#x3D;[]</span><br><span class="line">                    let len &#x3D;resMap.length</span><br><span class="line">                    if(len &gt;&#x3D; 1)&#123;</span><br><span class="line">                        for(let i&#x3D;0; i&lt;len; i++) &#123;</span><br><span class="line">                            let maps &#x3D; &#123;&#125;</span><br><span class="line">                            maps.id &#x3D; i</span><br><span class="line">                            maps.latitude &#x3D; resMap[i].latitude</span><br><span class="line">                            maps.longitude &#x3D; resMap[i].longitude</span><br><span class="line">                            maps.iconPath &#x3D;&#39;&#x2F;static&#x2F;images&#x2F;logo.png&#39;</span><br><span class="line">                            maps.width &#x3D; 30</span><br><span class="line">                            maps.height &#x3D; 30</span><br><span class="line">                            maps.callout &#x3D; &#123;&#39;content&#39;:resMap[i].name,&#39;display&#39;:&#39;ALWAYS&#39;&#125;</span><br><span class="line">                            map.push(maps)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                        this.markers &#x3D; map</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">                </span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><p>在cloudfunctions中创建</p><p>stores云函数，返回门店信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line"></span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  const res &#x3D; await db.collection(&#39;stores&#39;).get()</span><br><span class="line">    return res.data</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="点餐菜单开发"><a href="#点餐菜单开发" class="headerlink" title="点餐菜单开发"></a>点餐菜单开发</h3><h4 id="导航模块开发"><a href="#导航模块开发" class="headerlink" title="导航模块开发"></a>导航模块开发</h4><p>自取和外卖切换到点餐菜单</p><p>自取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 点击后跳转点餐</span><br><span class="line">            tapStore(store)&#123;</span><br><span class="line">                this.SET_ORDERTYPE(&#39;takein&#39;)</span><br><span class="line">                            this.SET_STORE(store)</span><br><span class="line">                            uni.switchTab(&#123;</span><br><span class="line">                                url:&#39;..&#x2F;menu&#x2F;menu&#39;</span><br><span class="line">                            &#125;)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>外卖：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 点击跳转到点餐界面</span><br><span class="line">            tapAddress(address)&#123;</span><br><span class="line">            this.SET_ADDRESS(address)</span><br><span class="line">                    this.SET_ORDERTYPE(&#39;takeout&#39;)</span><br><span class="line">                    uni.switchTab(&#123;</span><br><span class="line">                        url:&#39;..&#x2F;menu&#x2F;menu&#39;</span><br><span class="line">                    &#125;)</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>menu界面nav</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;nav&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;header&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;left&quot; v-if&#x3D;&quot;orderType &#x3D;&#x3D; &#39;takein&#39;&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;store-name&quot;&gt;</span><br><span class="line">                            &lt;text&gt;&#123;&#123; choseStore.name &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;iconfont icon-arrow-right&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;store-location&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&#39;&#x2F;static&#x2F;images&#x2F;order&#x2F;location.png&#39; style&#x3D;&quot;width: 30rpx; height: 30rpx;&quot; class&#x3D;&quot;mr-10&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;text&gt;距离您 &#123;&#123; choseStore.distance &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;left overflow-hidden&quot; v-else&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;d-flex align-items-center overflow-hidden&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&#39;&#x2F;static&#x2F;images&#x2F;order&#x2F;location.png&#39; style&#x3D;&quot;width: 30rpx; height: 30rpx;&quot; class&#x3D;&quot;mr-10&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-size-extra-lg text-color-base font-weight-bold text-truncate&quot;&gt;</span><br><span class="line">                                &#123;&#123; choseAddress.street &#125;&#125;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm text-color-assist overflow-hidden text-truncate&quot;&gt;</span><br><span class="line">                            由&lt;text class&#x3D;&quot;text-color-base&quot; style&#x3D;&quot;margin: 0 10rpx&quot;&gt;&#123;&#123; choseAddress.store_name &#125;&#125;配送&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;right&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;dinein&quot; :class&#x3D;&quot;&#123;active: orderType &#x3D;&#x3D; &#39;takein&#39;&#125;&quot; @tap&#x3D;&quot;SET_ORDERTYPE(&#39;takein&#39;)&quot;&gt;</span><br><span class="line">                            &lt;text&gt;自取&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;takeout&quot; :class&#x3D;&quot;&#123;active: orderType &#x3D;&#x3D; &#39;takeout&#39;&#125;&quot; @tap&#x3D;&quot;takout&quot;&gt;</span><br><span class="line">                            &lt;text&gt;外卖&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;coupon&quot;&gt;</span><br><span class="line">                    &lt;text class&#x3D;&quot;title&quot;&gt;&quot;霸气mini卡&quot;超级购券活动，赶紧去购买&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;iconfont iconarrow-right&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>切换自取和外卖按钮</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">tapTakein()&#123;</span><br><span class="line">            </span><br><span class="line">            if(this.choseStore) &#123;</span><br><span class="line">                this.SET_ORDERTYPE(&#39;takein&#39;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url:&#39;..&#x2F;stores&#x2F;stores&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        tapTakeOut()&#123;</span><br><span class="line">            if(!this.isLogin)&#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url:&#39;..&#x2F;login&#x2F;login&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            uni.navigateTo(&#123;</span><br><span class="line">                url:&#39;..&#x2F;address&#x2F;address&#39;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        tapStore() &#123;</span><br><span class="line">            uni.navigateTo(&#123;</span><br><span class="line">                url:&#39;..&#x2F;stores&#x2F;stores&#39;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="加载菜单goods数据"><a href="#加载菜单goods数据" class="headerlink" title="加载菜单goods数据"></a>加载菜单goods数据</h4><p>unicloud部分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    const res &#x3D; await db.collection(&#39;category&#39;).aggregate().lookup(&#123;</span><br><span class="line">        from:&#39;goods&#39;,</span><br><span class="line">        localField:&#39;goods_type&#39;,</span><br><span class="line">        foreignField:&#39;goods_type&#39;,</span><br><span class="line">        as:&#39;goods_list&#39;</span><br><span class="line">    &#125;).end()</span><br><span class="line">    return res</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="菜单页面骨架"><a href="#菜单页面骨架" class="headerlink" title="菜单页面骨架"></a>菜单页面骨架</h4><p>先将骨架搭建好,获取好数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 点餐菜单 --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;content&quot;&gt;</span><br><span class="line">                &lt;!-- left category --&gt;</span><br><span class="line">                &lt;scroll-view scroll-y&#x3D;&quot;true&quot; class&#x3D;&quot;menus&quot; &gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;menu&quot; v-for&#x3D;&quot;(item, index) in goods&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                            &lt;text&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;scroll-view&gt;</span><br><span class="line">                &lt;!-- right goods --&gt;</span><br><span class="line">                &lt;scroll-view scroll-y&#x3D;&quot;true&quot; class&#x3D;&quot;goods&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">                        &lt;swiper class&#x3D;&quot;ads&quot; id&#x3D;&quot;ads&quot; autoplay :interval&#x3D;&quot;3000&quot; indicator-dots&gt;</span><br><span class="line">                            &lt;swiper-item v-for&#x3D;&quot;(item, index) in ads&quot; :key&#x3D;&#39;index&#39;&gt;</span><br><span class="line">                                &lt;image :src&#x3D;&quot;item.image&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;swiper-item&gt;</span><br><span class="line">                        &lt;&#x2F;swiper&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;list&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;category&quot; v-for&#x3D;&quot;(item, index) in goods&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;title&quot;&gt;</span><br><span class="line">                                    &lt;text&gt;&#123;&#123; item.name &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                                    &lt;image :src&#x3D;&quot;item.icon&quot; class&#x3D;&quot;icon&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;items&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;good&quot; v-for&#x3D;&quot;(good, key) in item.goods_list&quot; :key&#x3D;&quot;key&quot;&gt;</span><br><span class="line">                                        &lt;image :src&#x3D;&quot;good.images&quot; class&#x3D;&quot;image&quot; &gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;right&quot;&gt;</span><br><span class="line">                                            &lt;text class&#x3D;&quot;name&quot;&gt;&#123;&#123; good.name &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                                            &lt;text class&#x3D;&quot;tips&quot;&gt;&#123;&#123; good.content &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                                            &lt;view class&#x3D;&quot;price_and_action&quot;&gt;</span><br><span class="line">                                                &lt;text class&#x3D;&quot;price&quot;&gt;￥&#123;&#123; good.price &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                                            &lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;scroll-view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>广告数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ads: [</span><br><span class="line">                &#123;image: &#39;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;27&#x2F;4ebdb582a5185358c4.jpg?imageView2&#x2F;2&#x2F;w&#x2F;600&#x2F;h&#x2F;600&#39;&#125;,</span><br><span class="line">                &#123;image: &#39;https:&#x2F;&#x2F;images.qmai.cn&#x2F;s23107&#x2F;2020&#x2F;05&#x2F;08&#x2F;c25de6ef72d2890630.png?imageView2&#x2F;2&#x2F;w&#x2F;600&#x2F;h&#x2F;600&#39;&#125;,</span><br><span class="line">                &#123;image: &#39;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;10&#x2F;add546c1b1561f880d.jpg?imageView2&#x2F;2&#x2F;w&#x2F;600&#x2F;h&#x2F;600&#39;&#125;,</span><br><span class="line">                &#123;image: &#39;https:&#x2F;&#x2F;images.qmai.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;30&#x2F;b3af19e0de8ed42f61.jpg?imageView2&#x2F;2&#x2F;w&#x2F;600&#x2F;h&#x2F;600&#39;&#125;,</span><br><span class="line">                &#123;image: &#39;https:&#x2F;&#x2F;img-shop.qmimg.cn&#x2F;s23107&#x2F;2020&#x2F;04&#x2F;17&#x2F;8aeb78516d63864420.jpg?imageView2&#x2F;2&#x2F;w&#x2F;600&#x2F;h&#x2F;600&#39;&#125;</span><br><span class="line">            ],</span><br></pre></td></tr></table></figure><h4 id="菜单scroll-view左右滑动计算方法"><a href="#菜单scroll-view左右滑动计算方法" class="headerlink" title="菜单scroll-view左右滑动计算方法"></a>菜单scroll-view左右滑动计算方法</h4><p>:scroll-into-view</p><p>值应为某子元素id（id不能以数字开头）。设置哪个方向可滚动，则在哪个方向滚动到该元素</p><p>scroll-with-animation</p><p>在设置滚动条位置时使用动画过渡</p><p>scroll-top</p><p>设置竖向滚动条位置</p><p>@scroll</p><p>滚动时触发，event.detail = {scrollLeft, scrollTop, scrollHeight, scrollWidth, deltaX, deltaY}</p><p><em>目标 :  想让左侧category跟随右侧上下滑动,并且可以点击切换</em></p><p>left部分</p><p>scroll-view中设置 :scroll-into-view</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:scroll-into-view&#x3D;&quot;menuScrollIntoView&quot;</span><br></pre></td></tr></table></figure><p>设置下menu</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:id&#x3D;&quot;&#96;menu-$&#123;item._id&#125;&#96;&quot; :class&#x3D;&quot;&#123;&#39;current&#39;: item._id &#x3D;&#x3D;&#x3D; currentCateId&#125;&quot; @tap&#x3D;&quot;handleMenuTap(item._id)&quot;</span><br></pre></td></tr></table></figure><p>默认设置currentCateId为奈雪早餐的_id</p><p>currentCateId:”60bc303c5f269b8700014fc46ba448cd”,</p><p>right部分</p><p>scroll-top设置scroll-view的滚动条位置 handleGoodsScroll控制左边category list的滑动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scroll-with-animation scroll-y :scroll-top&#x3D;&quot;cateScrollTop&quot; @scroll&#x3D;&quot;handleGoodsScroll&quot;</span><br></pre></td></tr></table></figure><p>并且goods添加id选择器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:id&#x3D;&quot;&#96;cate-$&#123;item._id&#125;&#96;&quot;</span><br></pre></td></tr></table></figure><p>data-return中设置四个属性控制滑动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">currentCateId:&quot;60bc303c5f269b8700014fc46ba448cd&quot;,</span><br><span class="line">            menuScrollIntoView: &#39;&#39;,</span><br><span class="line">            sizeCalcState:false,</span><br><span class="line">            cateScrollTop: 0,</span><br></pre></td></tr></table></figure><p>methods中添加function</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">handleMenuTap(id) &#123;    &#x2F;&#x2F;点击菜单项事件</span><br><span class="line">            if(!this.sizeCalcState) &#123;</span><br><span class="line">                this.calcSize()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            this.currentCateId &#x3D; id</span><br><span class="line">            this.$nextTick(() &#x3D;&gt; this.cateScrollTop &#x3D; this.goods.find(item &#x3D;&gt; item._id &#x3D;&#x3D; id).top)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F;商品滚动</span><br><span class="line">        handleGoodsScroll(&#123;detail&#125;) &#123;    &#x2F;&#x2F;商品列表滚动事件</span><br><span class="line">            if(!this.sizeCalcState) &#123;</span><br><span class="line">                this.calcSize()</span><br><span class="line">            &#125;</span><br><span class="line">            const &#123;scrollTop&#125; &#x3D; detail</span><br><span class="line">            let tabs &#x3D; this.goods.filter(item&#x3D;&gt; item.top &lt;&#x3D; scrollTop).reverse()</span><br><span class="line">            if(tabs.length &gt; 0)&#123;</span><br><span class="line">                this.currentCateId &#x3D; tabs[0]._id</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        calcSize() &#123;</span><br><span class="line">            let h &#x3D; 10</span><br><span class="line">             &#x2F;&#x2F;计算右侧广告banner高度等信息</span><br><span class="line">            let view &#x3D; uni.createSelectorQuery().select(&#39;#ads&#39;)</span><br><span class="line">            view.fields(&#123;</span><br><span class="line">                size: true</span><br><span class="line">            &#125;, data &#x3D;&gt; &#123;</span><br><span class="line">                h +&#x3D; Math.floor(data.height) &#x2F;&#x2F;给h赋值广告栏高度</span><br><span class="line">            &#125;).exec()</span><br><span class="line">            </span><br><span class="line">            this.goods.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">                 &#x2F;&#x2F;计算右侧栏每个tab的高度等信息</span><br><span class="line">                let view &#x3D; uni.createSelectorQuery().select(&#96;#cate-$&#123;item._id&#125;&#96;)</span><br><span class="line">                view.fields(&#123;</span><br><span class="line">                    size: true &#x2F;&#x2F; 是否返回节点尺寸</span><br><span class="line">                &#125;, data &#x3D;&gt; &#123; &#x2F;&#x2F; data是方法的回调函数，参数是指定的相关节点信息</span><br><span class="line">                    item.top &#x3D; h &#x2F;&#x2F; 顶部高度</span><br><span class="line">                    h +&#x3D; data.height</span><br><span class="line">                    item.bottom &#x3D; h &#x2F;&#x2F;底部高度</span><br><span class="line">                &#125;).exec()</span><br><span class="line">            &#125;)</span><br><span class="line">            this.sizeCalcState &#x3D; true</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><h4 id="计算商品添加购物车数量"><a href="#计算商品添加购物车数量" class="headerlink" title="计算商品添加购物车数量"></a>计算商品添加购物车数量</h4><p>在data中添加cart:[]数组</p><p>按钮部分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 选规格 --&gt;</span><br><span class="line">                                                &lt;view class&#x3D;&quot;btn-group&quot; v-if&#x3D;&quot;good.property&quot;&gt;</span><br><span class="line">                                                    &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;btn property_btn&quot; hover-class&#x3D;&quot;none&quot; size&#x3D;&quot;mini&quot; </span><br><span class="line">                                                    @tap&#x3D;&quot;showGoodDetailModal(item, good)&quot;&gt;</span><br><span class="line">                                                        选规格</span><br><span class="line">                                                    &lt;&#x2F;button&gt;</span><br><span class="line">                                                      &lt;view class&#x3D;&quot;dot&quot; v-show&#x3D;&quot;goodCartNum(good._id)&quot;&gt;&#123;&#123; goodCartNum(good._id) &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                                &lt;&#x2F;view&gt;</span><br><span class="line">                                                &lt;!-- 购物车加减 --&gt;</span><br><span class="line">                                                &lt;view class&#x3D;&quot;btn-group&quot; v-else&gt;</span><br><span class="line">                                                    &lt;button type&#x3D;&quot;default&quot; v-show&#x3D;&quot;goodCartNum(good._id)&quot; plain class&#x3D;&quot;btn reduce_btn&quot;</span><br><span class="line">                                                    size&#x3D;&quot;mini&quot; hover-class&#x3D;&quot;none&quot; @tap&#x3D;&quot;handleReduceFromCart(item, good)&quot;&gt;</span><br><span class="line">                                                      &lt;view class&#x3D;&quot;iconfont icon-sami-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                                    &lt;&#x2F;button&gt;</span><br><span class="line">                                                    &lt;view class&#x3D;&quot;number&quot; v-show&#x3D;&quot;goodCartNum(good._id)&quot;&gt;&#123;&#123; goodCartNum(good._id) &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                                    &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;btn add_btn&quot; size&#x3D;&quot;min&quot; hover-class&#x3D;&quot;none&quot;</span><br><span class="line">                                                    @tap&#x3D;&quot;handleAddToCart(item,good,1)&quot;&gt;</span><br><span class="line">                                                      &lt;view class&#x3D;&quot;iconfont icon-add-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                                    &lt;&#x2F;button&gt;</span><br><span class="line">                                                &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>计算单个饮品添加数量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">goodCartNum() &#123;    &#x2F;&#x2F;计算单个饮品添加到购物车的数量</span><br><span class="line">            return (id) &#x3D;&gt; this.cart.reduce((acc, cur) &#x3D;&gt; &#123;</span><br><span class="line">                    if(cur.id &#x3D;&#x3D;&#x3D; id) &#123;</span><br><span class="line">                        return acc +&#x3D; cur.number</span><br><span class="line">                    &#125;</span><br><span class="line">                    return acc</span><br><span class="line">                &#125;, 0)</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><p>首先写最简单的添加事件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 点击添加购物车</span><br><span class="line">        handleAddToCart(cate,good,num) &#123;    &#x2F;&#x2F;添加到购物车</span><br><span class="line">            </span><br><span class="line">             const index &#x3D; this.cart.findIndex(item &#x3D;&gt; item.id &#x3D;&#x3D;&#x3D; good._id)</span><br><span class="line">             if(index &gt; -1) &#123;</span><br><span class="line">                 this.cart[index].number +&#x3D; num</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 this.cart.push(&#123;</span><br><span class="line">                     id: good._id,</span><br><span class="line">                    cate_id:cate._id,</span><br><span class="line">                     name: good.name,</span><br><span class="line">                     price: good.price,</span><br><span class="line">                     number: num,</span><br><span class="line">                     image: good.images,</span><br><span class="line">                    props_text: good.props_text</span><br><span class="line">                 &#125;)</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><h4 id="类别总数和购物车价格计算"><a href="#类别总数和购物车价格计算" class="headerlink" title="类别总数和购物车价格计算"></a>类别总数和购物车价格计算</h4><p>类别数量计算</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;dot&quot; v-show&#x3D;&quot;menuCartNum(item._id)&quot;&gt;&#123;&#123; menuCartNum(item._id) &#125;&#125;&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>计算左侧分类汇总数量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">menuCartNum() &#123; &#x2F;&#x2F;计算左侧分类汇总数量</span><br><span class="line">            return (id) &#x3D;&gt; this.cart.reduce((acc, cur) &#x3D;&gt; &#123;</span><br><span class="line">                    if(cur.cate_id &#x3D;&#x3D;&#x3D; id) &#123;</span><br><span class="line">                        return acc +&#x3D; cur.number</span><br><span class="line">                    &#125;</span><br><span class="line">                    return acc</span><br><span class="line">            &#125;, 0)</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><p>购物车</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 购物车栏 begin --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;cart-box&quot; v-if&#x3D;&quot;cart.length &gt; 0&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;mark&quot;&gt;</span><br><span class="line">                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;menu&#x2F;cart.png&quot; class&#x3D;&quot;cart-img&quot; @tap&#x3D;&quot;openCartPopup&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;tag&quot;&gt;&#123;&#123; getCartGoodsNumber &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;price&quot;&gt;￥&#123;&#123; getCartGoodsPrice &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;pay-btn&quot; @tap&#x3D;&quot;toPay&quot; :disabled&#x3D;&quot;disabledPay&quot;&gt;</span><br><span class="line">                &#123;&#123; disabledPay ? &#96;差$&#123;spread&#125;元起送&#96; : &#39;去结算&#39; &#125;&#125;</span><br><span class="line">            &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- 购物车栏 end --&gt;</span><br></pre></td></tr></table></figure><p>购物车计算属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">getCartGoodsNumber() &#123; &#x2F;&#x2F;计算购物车总数</span><br><span class="line">    return this.cart.reduce((acc, cur) &#x3D;&gt; acc + cur.number, 0)</span><br><span class="line">&#125;,</span><br><span class="line">getCartGoodsPrice() &#123;    &#x2F;&#x2F;计算购物车总价</span><br><span class="line">    return this.cart.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0)</span><br><span class="line">&#125;,</span><br><span class="line">disabledPay() &#123; &#x2F;&#x2F;是否达到起送价</span><br><span class="line">    return this.orderType &#x3D;&#x3D; &#39;takeout&#39; &amp;&amp; (this.getCartGoodsPrice &lt; 38) ? true : false</span><br><span class="line">&#125;,</span><br><span class="line">spread() &#123; &#x2F;&#x2F;差多少元起送</span><br><span class="line">    if(this.orderType !&#x3D; &#39;takeout&#39;) return</span><br><span class="line">    return parseFloat((38 - this.getCartGoodsPrice).toFixed(2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>减少购物车数量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">handleReduceFromCart(item, good) &#123; &#x2F;&#x2F;减少购物车数量</span><br><span class="line">            const index &#x3D; this.cart.findIndex(item &#x3D;&gt; item.id &#x3D;&#x3D;&#x3D; good._id)</span><br><span class="line">            this.cart[index].number -&#x3D; 1</span><br><span class="line">            if(this.cart[index].number &lt;&#x3D; 0) &#123;</span><br><span class="line">                this.cart.splice(index, 1)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><h4 id="选规格模态框"><a href="#选规格模态框" class="headerlink" title="选规格模态框"></a>选规格模态框</h4><p>模态框组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view @touchmove.stop.prevent&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;modal-box&quot; :style&#x3D;&quot;&#123;width:width,padding:padding,borderRadius:radius&#125;&quot; :class&#x3D;&quot;[(fadein || show)?&#39;modal-normal&#39;:&#39;modal-scale&#39;,show?&#39;modal-show&#39;:&#39;&#39;]&quot;&gt;</span><br><span class="line">            &lt;view v-if&#x3D;&quot;custom&quot;&gt;</span><br><span class="line">                &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view v-else&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;modal-title&quot; v-if&#x3D;&quot;title&quot;&gt;&#123;&#123;title&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;modal-content&quot; :class&#x3D;&quot;[title?&#39;&#39;:&#39;mtop&#39;]&quot; :style&#x3D;&quot;&#123;color:color,fontSize:size+&#39;rpx&#39;&#125;&quot;&gt;</span><br><span class="line">                    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;modalBtn-box&quot; :class&#x3D;&quot;[button.length!&#x3D;2?&#39;flex-column&#39;:&#39;&#39;]&quot;&gt;</span><br><span class="line">                    &lt;block v-for&#x3D;&quot;(item,index) in button&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                        &lt;button class&#x3D;&quot;modal-btn&quot; </span><br><span class="line">                                :class&#x3D;&quot;[</span><br><span class="line">                                        &#39;&#39;+(item.type || &#39;primary&#39;)+(item.plain?&#39;-outline&#39;:&#39;&#39;),</span><br><span class="line">                                        button.length!&#x3D;2?&#39;btn-width&#39;:&#39;&#39;,</span><br><span class="line">                                        button.length&gt;2?&#39;mbtm&#39;:&#39;&#39;,</span><br><span class="line">                                        shape&#x3D;&#x3D;&#39;circle&#39;?&#39;circle-btn&#39;:&#39;&#39;,</span><br><span class="line">                                        &#39;btn-&#39; + (item.size || &#39;default&#39;),                                        </span><br><span class="line">                                    ]&quot;</span><br><span class="line">                                :hover-class&#x3D;&quot;&#39;&#39;+(item.plain?&#39;outline&#39;:(item.type || &#39;primary&#39;))+&#39;-hover&#39;&quot; :data-index&#x3D;&quot;index&quot; @tap&#x3D;&quot;handleClick&quot;&gt;&#123;&#123;item.text || &quot;确定&quot;&#125;&#125;&lt;&#x2F;button&gt;</span><br><span class="line">                    &lt;&#x2F;block&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;modal-mask&quot; :class&#x3D;&quot;[show?&#39;mask-show&#39;:&#39;&#39;]&quot; @tap&#x3D;&quot;handleClickCancel&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;Modal&quot;,</span><br><span class="line">        props: &#123;</span><br><span class="line">            &#x2F;&#x2F;是否显示</span><br><span class="line">            show: &#123;</span><br><span class="line">                type: Boolean,</span><br><span class="line">                default: false</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;自定义modal体</span><br><span class="line">            custom: &#123;</span><br><span class="line">                type: Boolean,</span><br><span class="line">                default: false</span><br><span class="line">            &#125;,</span><br><span class="line">            width: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;84%&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            padding: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;40rpx&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            radius: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;24rpx&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;标题</span><br><span class="line">            title: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;内容</span><br><span class="line">            content: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;内容字体颜色</span><br><span class="line">            color: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;#999&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;内容字体大小 rpx</span><br><span class="line">            size: &#123;</span><br><span class="line">                type: Number,</span><br><span class="line">                default: 28</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;形状 circle, square</span><br><span class="line">            shape: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &#39;square&#39;</span><br><span class="line">            &#125;,</span><br><span class="line">            button: &#123;</span><br><span class="line">                type: Array,</span><br><span class="line">                default: function() &#123;</span><br><span class="line">                    return [&#123;</span><br><span class="line">                        text: &quot;取消&quot;,</span><br><span class="line">                        type: &quot;red&quot;,</span><br><span class="line">                        plain: true &#x2F;&#x2F;是否空心</span><br><span class="line">                    &#125;, &#123;</span><br><span class="line">                        text: &quot;确定&quot;,</span><br><span class="line">                        type: &quot;red&quot;,</span><br><span class="line">                        plain: false</span><br><span class="line">                    &#125;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;点击遮罩 是否可关闭</span><br><span class="line">            maskClosable: &#123;</span><br><span class="line">                type: Boolean,</span><br><span class="line">                default: true</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F;淡入效果，自定义弹框插入input输入框时传true</span><br><span class="line">            fadein: &#123;</span><br><span class="line">                type: Boolean,</span><br><span class="line">                default: false</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line"></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleClick(e) &#123;</span><br><span class="line">                if (!this.show) return;</span><br><span class="line">                const dataset &#x3D; e.currentTarget.dataset;</span><br><span class="line">                this.$emit(&#39;click&#39;, &#123;</span><br><span class="line">                    index: Number(dataset.index)</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            handleClickCancel() &#123;</span><br><span class="line">                if (!this.maskClosable) return;</span><br><span class="line">                this.$emit(&#39;cancel&#39;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot;&gt;</span><br><span class="line">    .modal-box &#123;</span><br><span class="line">        position: fixed;</span><br><span class="line">        left: 50%;</span><br><span class="line">        top: 50%;</span><br><span class="line">        margin: auto;</span><br><span class="line">        background: #fff;</span><br><span class="line">        z-index: 9999998;</span><br><span class="line">        transition: all 0.3s ease-in-out;</span><br><span class="line">        opacity: 0;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        visibility: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-scale &#123;</span><br><span class="line">        transform: translate(-50%, -50%) scale(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-normal &#123;</span><br><span class="line">        transform: translate(-50%, -50%) scale(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-show &#123;</span><br><span class="line">        opacity: 1;</span><br><span class="line">        visibility: visible;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-mask &#123;</span><br><span class="line">        position: fixed;</span><br><span class="line">        top: 0;</span><br><span class="line">        left: 0;</span><br><span class="line">        right: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        background: rgba(0, 0, 0, 0.6);</span><br><span class="line">        z-index: 9999996;</span><br><span class="line">        transition: all 0.3s ease-in-out;</span><br><span class="line">        opacity: 0;</span><br><span class="line">        visibility: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .mask-show &#123;</span><br><span class="line">        visibility: visible;</span><br><span class="line">        opacity: 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-title &#123;</span><br><span class="line">        text-align: center;</span><br><span class="line">        font-size: 34rpx;</span><br><span class="line">        color: #333;</span><br><span class="line">        padding-top: 20rpx;</span><br><span class="line">        font-weight: bold;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-content &#123;</span><br><span class="line">        color: #999;</span><br><span class="line">        font-size: 28rpx;</span><br><span class="line">        padding-top: 20rpx;</span><br><span class="line">        padding-bottom: 60rpx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .mtop &#123;</span><br><span class="line">        margin-top: 30rpx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .mbtm &#123;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modalBtn-box &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: space-between</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .flex-column &#123;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-btn &#123;</span><br><span class="line">        width: 46%;</span><br><span class="line">        height: 68rpx;</span><br><span class="line">        line-height: 68rpx;</span><br><span class="line">        position: relative;</span><br><span class="line">        border-radius: 60rpx;</span><br><span class="line">        font-size: 28rpx;</span><br><span class="line">        overflow: visible;</span><br><span class="line">        margin-left: 0;</span><br><span class="line">        margin-right: 0;</span><br><span class="line">        </span><br><span class="line">        &amp;.btn-default &#123;</span><br><span class="line">            font-size: 28rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &amp;.btn-lg &#123;</span><br><span class="line">            font-size: 32rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &amp;.btn-sm &#123;</span><br><span class="line">            font-size: 24rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .modal-btn::after &#123;</span><br><span class="line">        content: &quot;&quot;;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: 200%;</span><br><span class="line">        height: 200%;</span><br><span class="line">        -webkit-transform-origin: 0 0;</span><br><span class="line">        transform-origin: 0 0;</span><br><span class="line">        -webkit-transform: scale(0.5, 0.5);</span><br><span class="line">        transform: scale(0.5, 0.5);</span><br><span class="line">        left: 0;</span><br><span class="line">        top: 0;</span><br><span class="line">        border-radius: 60rpx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .btn-width &#123;</span><br><span class="line">        width: 80% !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .primary &#123;</span><br><span class="line">        background: #97AF13;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .primary-hover &#123;</span><br><span class="line">        background: #97AF13;</span><br><span class="line">        color: #e5e5e5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .primary-outline &#123;</span><br><span class="line">        color: #97AF13;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .primary-outline::after &#123;</span><br><span class="line">        border: 1px solid #97AF13;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .danger &#123;</span><br><span class="line">        background: #ed3f14;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .danger-hover &#123;</span><br><span class="line">        background: #d53912;</span><br><span class="line">        color: #e5e5e5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .danger-outline &#123;</span><br><span class="line">        color: #ed3f14;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .danger-outline::after &#123;</span><br><span class="line">        border: 1px solid #ed3f14;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .red &#123;</span><br><span class="line">        background: #e41f19;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .red-hover &#123;</span><br><span class="line">        background: #c51a15;</span><br><span class="line">        color: #e5e5e5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .red-outline &#123;</span><br><span class="line">        color: #e41f19;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .red-outline::after &#123;</span><br><span class="line">        border: 1px solid #e41f19;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .warning &#123;</span><br><span class="line">        background: #ff7900;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .warning-hover &#123;</span><br><span class="line">        background: #e56d00;</span><br><span class="line">        color: #e5e5e5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .warning-outline &#123;</span><br><span class="line">        color: #ff7900;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .warning-outline::after &#123;</span><br><span class="line">        border: 1px solid #ff7900;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .green &#123;</span><br><span class="line">        background: #19be6b;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .green-hover &#123;</span><br><span class="line">        background: #16ab60;</span><br><span class="line">        color: #e5e5e5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .green-outline &#123;</span><br><span class="line">        color: #19be6b;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .green-outline::after &#123;</span><br><span class="line">        border: 1px solid #19be6b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .white &#123;</span><br><span class="line">        background: #fff;</span><br><span class="line">        color: #333;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .white-hover &#123;</span><br><span class="line">        background: #f7f7f9;</span><br><span class="line">        color: #666;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .white-outline &#123;</span><br><span class="line">        color: #333;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .white-outline::after &#123;</span><br><span class="line">        border: 1px solid #333;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .gray &#123;</span><br><span class="line">        background: #ededed;</span><br><span class="line">        color: #999;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .gray-hover &#123;</span><br><span class="line">        background: #d5d5d5;</span><br><span class="line">        color: #898989;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .gray-outline &#123;</span><br><span class="line">        color: #999;</span><br><span class="line">        background: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .gray-outline::after &#123;</span><br><span class="line">        border: 1px solid #999;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .outline-hover &#123;</span><br><span class="line">        opacity: 0.6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .circle-btn &#123;</span><br><span class="line">        border-radius: 40rpx !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .circle-btn::after &#123;</span><br><span class="line">        border-radius: 80rpx !important;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>uni-app前端部署</p><p>添加组件modal</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import modal from &#39;@&#x2F;components&#x2F;modal&#x2F;modal&#39;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goodDetailModalVisible: false, &#x2F;&#x2F;是否饮品详情模态框</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;modal代码</span><br><span class="line">&lt;modal :show&#x3D;&quot;goodDetailModalVisible&quot; class&#x3D;&quot;good-detail-modal&quot; color&#x3D;&quot;#5A5B5C&quot; </span><br><span class="line">                width&#x3D;&quot;90%&quot; custom padding&#x3D;&quot;0rpx&quot; radius&#x3D;&quot;12rpx&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;cover&quot;&gt;</span><br><span class="line">                &lt;image v-if&#x3D;&quot;good.images&quot; :src&#x3D;&quot;good.images&quot; class&#x3D;&quot;image&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;btn-group&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;menu&#x2F;share-good.png&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;menu&#x2F;close.png&quot; @tap&#x3D;&quot;closeGoodDetailModal&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;scroll-view class&#x3D;&quot;detail&quot; scroll-y&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;basic&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;name&quot;&gt;&#123;&#123; good.name &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;tips&quot;&gt;&#123;&#123; good.content &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;properties&quot; v-if&#x3D;&quot;good.property&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;property&quot; v-for&#x3D;&quot;(item, index) in good.property&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;title&quot;&gt;</span><br><span class="line">                                &lt;text class&#x3D;&quot;name&quot;&gt;&#123;&#123; item.name &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;desc&quot; v-if&#x3D;&quot;item.desc&quot;&gt;(&#123;&#123; item.desc &#125;&#125;)&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;values&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;value&quot; v-for&#x3D;&quot;(value, key) in item.values&quot; :key&#x3D;&quot;key&quot; </span><br><span class="line">                                :class&#x3D;&quot;&#123;&#39;default&#39;: value.is_default&#125;&quot; </span><br><span class="line">                                @tap&#x3D;&quot;changePropertyDefault(index, key)&quot;&gt;</span><br><span class="line">                                    &#123;&#123; value.value &#125;&#125;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;scroll-view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;action&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;left&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;price&quot;&gt;￥&#123;&#123; good.price &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;props&quot; v-if&#x3D;&quot;getGoodSelectedProps(good)&quot;&gt;</span><br><span class="line">                        &#123;&#123; getGoodSelectedProps(good) &#125;&#125;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;btn-group&quot;&gt;</span><br><span class="line">                    &lt;button type&#x3D;&quot;default&quot; plain class&#x3D;&quot;btn&quot; size&#x3D;&quot;mini&quot; hover-class&#x3D;&quot;none&quot; </span><br><span class="line">                        @tap&#x3D;&quot;handlePropertyReduce&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont icon-sami-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;button&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;number&quot;&gt;&#123;&#123; good.number &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;btn&quot; size&#x3D;&quot;min&quot; hover-class&#x3D;&quot;none&quot; </span><br><span class="line">                        @tap&#x3D;&quot;handlePropertyAdd&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;iconfont icon-add-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;button&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;add-to-cart-btn&quot; @tap&#x3D;&quot;handleAddToCartInModal&quot;&gt;</span><br><span class="line">                &lt;view&gt;加入购物车&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;modal&gt;</span><br></pre></td></tr></table></figure><p>模态框函数</p><p>data中添加good category</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">good: &#123;&#125;, &#x2F;&#x2F;当前饮品</span><br><span class="line">category: &#123;&#125;, &#x2F;&#x2F;当前饮品所在分类</span><br></pre></td></tr></table></figure><p>关闭\改变属性值\计算当前饮品所选属性\商品+-1\添加购物车</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">showGoodDetailModal(item, good) &#123; &#x2F;&#x2F;展示模态框</span><br><span class="line">    this.good &#x3D; JSON.parse(JSON.stringify(&#123;...good, number: 1&#125;))</span><br><span class="line">    this.category &#x3D; JSON.parse(JSON.stringify(item))</span><br><span class="line">    this.goodDetailModalVisible &#x3D; true</span><br><span class="line">&#125;,       </span><br><span class="line">     closeGoodDetailModal() &#123; &#x2F;&#x2F;关闭饮品详情模态框</span><br><span class="line">                  this.goodDetailModalVisible &#x3D; false</span><br><span class="line">                  this.category &#x3D; &#123;&#125;</span><br><span class="line">                  this.good &#x3D; &#123;&#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              changePropertyDefault(index, key) &#123; &#x2F;&#x2F;改变默认属性值</span><br><span class="line">                  this.good.property[index].values.forEach(value &#x3D;&gt; this.$set(value, &#39;is_default&#39;, 0))</span><br><span class="line">                  this.good.property[index].values[key].is_default &#x3D; 1</span><br><span class="line">                  this.good.number &#x3D; 1</span><br><span class="line">              &#125;,</span><br><span class="line">getGoodSelectedProps(good, type &#x3D; &#39;text&#39;) &#123;    &#x2F;&#x2F;计算当前饮品所选属性</span><br><span class="line">    if(good.property) &#123;</span><br><span class="line">        let props &#x3D; []</span><br><span class="line">        good.property.forEach((&#123;values&#125;) &#x3D;&gt; &#123;</span><br><span class="line">            values.forEach(value &#x3D;&gt; &#123;</span><br><span class="line">                if(value.is_default) &#123;</span><br><span class="line">                    props.push(type &#x3D;&#x3D;&#x3D; &#39;text&#39; ? value.value : value.id)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        return type &#x3D;&#x3D;&#x3D; &#39;text&#39; ? props.join(&#39;，&#39;) : props</span><br><span class="line">    &#125;</span><br><span class="line">    return &#39;&#39;</span><br><span class="line">&#125;,</span><br><span class="line">handlePropertyAdd() &#123; &#x2F;&#x2F;模态框添加1</span><br><span class="line">    this.good.number +&#x3D; 1</span><br><span class="line">&#125;,</span><br><span class="line">handlePropertyReduce() &#123; &#x2F;&#x2F;模态框减少1</span><br><span class="line">    if(this.good.number &#x3D;&#x3D;&#x3D; 1) return</span><br><span class="line">    this.good.number -&#x3D; 1</span><br><span class="line">&#125;,</span><br><span class="line">handleAddToCartInModal() &#123; &#x2F;&#x2F;添加进购物车</span><br><span class="line">    const product &#x3D; Object.assign(&#123;&#125;, this.good, &#123;props_text: this.getGoodSelectedProps(this.good), props: this.getGoodSelectedProps(this.good, &#39;id&#39;)&#125;)</span><br><span class="line">    this.handleAddToCart(this.category, product, this.good.number)</span><br><span class="line">    this.closeGoodDetailModal()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="购物车详情弹出层"><a href="#购物车详情弹出层" class="headerlink" title="购物车详情弹出层"></a>购物车详情弹出层</h4><p>popup-layer组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view&gt;</span><br><span class="line">        &lt;view v-show&#x3D;&quot;ifshow&quot; @tap&#x3D;&quot;ableClose&quot; @touchmove.stop.prevent class&#x3D;&quot;popup-layer&quot; &gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;popup-content&quot; @tap.stop&#x3D;&quot;stopEvent&quot; :style&#x3D;&quot;_location&quot;&gt;</span><br><span class="line">            &lt;slot name&#x3D;&quot;content&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#39;popup-layer&#39;,</span><br><span class="line">        model: &#123;</span><br><span class="line">            prop: &quot;showPop&quot;,</span><br><span class="line">            event: &quot;change&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        props: &#123;</span><br><span class="line">            showPop:&#123;</span><br><span class="line">                type:Boolean,</span><br><span class="line">                default:false,</span><br><span class="line">            &#125;,</span><br><span class="line">            direction: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &#39;top&#39;, &#x2F;&#x2F; 方向  top，bottom，left，right </span><br><span class="line">            &#125;,</span><br><span class="line">            autoClose: &#123;</span><br><span class="line">                type: Boolean,</span><br><span class="line">                default: true,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                ifshow: false, &#x2F;&#x2F; 是否展示,</span><br><span class="line">                &#x2F;&#x2F;#ifdef H5</span><br><span class="line">                translateValue: -150, &#x2F;&#x2F; 位移距离</span><br><span class="line">                &#x2F;&#x2F;#endif</span><br><span class="line">                &#x2F;&#x2F;#ifndef H5</span><br><span class="line">                translateValue: -100, &#x2F;&#x2F; 位移距离</span><br><span class="line">                &#x2F;&#x2F;#endif</span><br><span class="line">                timer: null,</span><br><span class="line">                iftoggle: false,</span><br><span class="line"></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            _translate() &#123;</span><br><span class="line">                const transformObj &#x3D; &#123;</span><br><span class="line">                    &#39;top&#39;: &#96;transform:translateY($&#123;-this.translateValue&#125;%)&#96;,</span><br><span class="line">                    &#39;bottom&#39;: &#96;transform:translateY($&#123;this.translateValue&#125;%)&#96;,</span><br><span class="line">                    &#39;left&#39;: &#96;transform:translateX($&#123;-this.translateValue&#125;%)&#96;,</span><br><span class="line">                    &#39;right&#39;: &#96;transform:translateX($&#123;this.translateValue&#125;%)&#96;</span><br><span class="line">                &#125;;</span><br><span class="line">                return transformObj[this.direction]</span><br><span class="line">            &#125;,</span><br><span class="line">            _location() &#123;</span><br><span class="line">                const positionValue &#x3D; &#123;</span><br><span class="line">                    &#x2F;&#x2F;#ifndef H5</span><br><span class="line">                    &#39;top&#39;: &#39;bottom:0px;width:100%;&#39;,</span><br><span class="line">                    &#x2F;&#x2F;#endif</span><br><span class="line">                     &#x2F;&#x2F;#ifdef H5</span><br><span class="line">                    &#39;top&#39;: &#39;bottom:50px;width:100%;&#39;,</span><br><span class="line">                     &#x2F;&#x2F;#endif</span><br><span class="line">                    &#39;bottom&#39;: &#39;top:0px;width:100%;&#39;,</span><br><span class="line">                    &#39;left&#39;: &#39;right:0px;height:100%;&#39;,</span><br><span class="line">                    &#39;right&#39;: &#39;left:0px;height:100%;&#39;,</span><br><span class="line">                &#125;;</span><br><span class="line">                return positionValue[this.direction] + this._translate;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        mounted()&#123;</span><br><span class="line">            if(this.showPop)&#123;</span><br><span class="line">                &#x2F;&#x2F; console.log(222);</span><br><span class="line">                this.show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        watch:&#123;</span><br><span class="line">            showPop(value)&#123;</span><br><span class="line">                console.log(value)</span><br><span class="line">                if(value)&#123;</span><br><span class="line">                    this.show();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    this.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            stopMove(event)&#123;</span><br><span class="line">                console.log(11);</span><br><span class="line">                console.log(event);</span><br><span class="line">                return;</span><br><span class="line">            &#125;,</span><br><span class="line">            show(events) &#123;</span><br><span class="line">                this.ifshow &#x3D; true;</span><br><span class="line">                let _open &#x3D; setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">                    this.translateValue &#x3D; 0;</span><br><span class="line">                    _open &#x3D; null;</span><br><span class="line">                &#125;, 100)</span><br><span class="line">                let _toggle &#x3D; setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">                    this.iftoggle &#x3D; true;</span><br><span class="line">                    _toggle &#x3D; null;</span><br><span class="line">                &#125;, 300);</span><br><span class="line">            &#125;,</span><br><span class="line">            close() &#123;</span><br><span class="line">                if (this.timer !&#x3D;&#x3D; null || !this.iftoggle) &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                this.translateValue &#x3D; -100;</span><br><span class="line">                &#x2F;&#x2F;#ifdef H5</span><br><span class="line">                this.translateValue &#x3D; -150</span><br><span class="line">                &#x2F;&#x2F;#endif</span><br><span class="line">                this.timer &#x3D; setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">                    this.ifshow &#x3D; false;</span><br><span class="line">                    this.timer &#x3D; null;</span><br><span class="line">                    this.iftoggle &#x3D; false;</span><br><span class="line">                    this.$emit(&#39;closeCallBack&#39;, null);</span><br><span class="line">                    this.$emit(&#39;change&#39;,false)</span><br><span class="line">                &#125;, 300);</span><br><span class="line">            &#125;,</span><br><span class="line">            ableClose() &#123;</span><br><span class="line">                if (this.autoClose) &#123;</span><br><span class="line">                    this.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            stopEvent(event) &#123;&#125;,</span><br><span class="line">            doSome()&#123;</span><br><span class="line">                console.log(111222111111111);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot;&gt;</span><br><span class="line">    .popup-layer &#123;</span><br><span class="line">        position: fixed;</span><br><span class="line">        z-index: 9990;</span><br><span class="line">        background: rgba(0, 0, 0, .3);</span><br><span class="line">        height: 100%;</span><br><span class="line">        width: 100%;</span><br><span class="line">        top: 0px;</span><br><span class="line">        left: 0px;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .popup-content &#123;</span><br><span class="line">        position: fixed;</span><br><span class="line">        z-index: 9991;</span><br><span class="line">        background: #FFFFFF;</span><br><span class="line">        transition: all .3s ease;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        &#x2F;&#x2F; border:1px solid red;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>插入组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import popupLayer from &#39;@&#x2F;components&#x2F;popup-layer&#x2F;popup-layer&#39;</span><br></pre></td></tr></table></figure><p>控制组件显示属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cartPopupVisible: false,</span><br></pre></td></tr></table></figure><p>menu菜单引入pupup-layer</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 购物车详情popup --&gt;</span><br><span class="line">        &lt;popup-layer direction&#x3D;&quot;top&quot; :show-pop&#x3D;&quot;cartPopupVisible&quot; class&#x3D;&quot;cart-popup&quot;&gt;</span><br><span class="line">            &lt;template slot&#x3D;&quot;content&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;top&quot;&gt;</span><br><span class="line">                    &lt;text @tap&#x3D;&quot;handleCartClear&quot;&gt;清空&lt;&#x2F;text&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;scroll-view class&#x3D;&quot;cart-list&quot; scroll-y&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;item&quot; v-for&#x3D;&quot;(item, index) in cart&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;left&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;name&quot;&gt;&#123;&#123; item.name &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;props&quot;&gt;&#123;&#123; item.props_text &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;center&quot;&gt;</span><br><span class="line">                                &lt;text&gt;￥&#123;&#123; item.price &#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;right&quot;&gt;</span><br><span class="line">                                &lt;button type&#x3D;&quot;default&quot; plain size&#x3D;&quot;mini&quot; class&#x3D;&quot;btn&quot; hover-class&#x3D;&quot;none&quot;</span><br><span class="line">                                    @tap&#x3D;&quot;handleCartItemReduce(index)&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;iconfont icon-sami-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;button&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;number&quot;&gt;&#123;&#123; item.number &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;btn&quot; size&#x3D;&quot;min&quot; hover-class&#x3D;&quot;none&quot;</span><br><span class="line">                                    @tap&#x3D;&quot;handleCartItemAdd(index)&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;iconfont icon-add-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;button&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;item&quot; v-if&#x3D;&quot;orderType &#x3D;&#x3D; &#39;takeout&#39;&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;left&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;name&quot;&gt;配送费&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;center&quot;&gt;</span><br><span class="line">                                &lt;text&gt;￥3&lt;&#x2F;text&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;right invisible&quot;&gt;</span><br><span class="line">                                &lt;button type&#x3D;&quot;default&quot; plain size&#x3D;&quot;mini&quot; class&#x3D;&quot;btn&quot; hover-class&#x3D;&quot;none&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;iconfont icon-sami-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;button&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;number&quot;&gt;1&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;btn&quot; size&#x3D;&quot;min&quot; hover-class&#x3D;&quot;none&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;iconfont icon-add-select&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;button&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;scroll-view&gt;</span><br><span class="line">            &lt;&#x2F;template&gt;</span><br><span class="line">        &lt;&#x2F;popup-layer&gt;</span><br><span class="line">        &lt;!-- 购物车详情popup --&gt;</span><br></pre></td></tr></table></figure><p>popup-layer事务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">    openCartPopup() &#123;    &#x2F;&#x2F;打开&#x2F;关闭购物车列表popup</span><br><span class="line">        this.cartPopupVisible &#x3D; !this.cartPopupVisible</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCartClear() &#123;    &#x2F;&#x2F;清空购物车</span><br><span class="line">        uni.showModal(&#123;</span><br><span class="line">            title: &#39;提示&#39;,</span><br><span class="line">            content: &#39;确定清空购物车么&#39;,</span><br><span class="line">            success: (&#123;confirm&#125;) &#x3D;&gt;  &#123;</span><br><span class="line">                if(confirm) &#123;</span><br><span class="line">                    this.cartPopupVisible &#x3D; false</span><br><span class="line">                    this.cart &#x3D; []</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCartItemAdd(index) &#123;  &#x2F;&#x2F;添加购物车已有数量</span><br><span class="line">        this.cart[index].number +&#x3D; 1</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCartItemReduce(index) &#123; &#x2F;&#x2F;减少购物车已有数量</span><br><span class="line">        if(this.cart[index].number &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">            this.cart.splice(index, 1)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            this.cart[index].number -&#x3D; 1</span><br><span class="line">        &#125;</span><br><span class="line">        if(!this.cart.length) &#123;</span><br><span class="line">            this.cartPopupVisible &#x3D; false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    toPay() &#123;</span><br><span class="line">        if(!this.isLogin) &#123;</span><br><span class="line">            uni.navigateTo(&#123;url: &#39;&#x2F;pages&#x2F;login&#x2F;login&#39;&#125;)</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        uni.showLoading(&#123;title: &#39;加载中&#39;&#125;)</span><br><span class="line">        uni.setStorageSync(&#39;cart&#39;, JSON.parse(JSON.stringify(this.cart)))</span><br><span class="line">        </span><br><span class="line">        uni.navigateTo(&#123;</span><br><span class="line">            url: &#39;&#x2F;pages&#x2F;pay&#x2F;pay&#39;</span><br><span class="line">        &#125;)</span><br><span class="line">        uni.hideLoading()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="订单模块开发"><a href="#订单模块开发" class="headerlink" title="订单模块开发"></a>订单模块开发</h3><h4 id="使用unipay微信支付流程"><a href="#使用unipay微信支付流程" class="headerlink" title="使用unipay微信支付流程"></a>使用unipay微信支付流程</h4><p>首先了解下微信支付的原理,</p><p>商户系统和微信支付系统主要交互：</p><p><img src= "/img/loading.gif" data-lazy-src="https://pay.weixin.qq.com/wiki/doc/api/img/wxa-7-2.jpg"></p><p>1、小程序内调用登录接口，获取到用户的openid,api参见公共api【<a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html">小程序登录API</a>】</p><p>2、商户server调用支付统一下单，api参见公共api【<a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=9_1&index=1">统一下单API</a>】</p><p>3、商户server调用再次签名，api参见公共api【<a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_7&index=3">再次签名</a>】</p><p>4、商户server接收支付通知，api参见公共api【<a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=9_7">支付结果通知API</a>】</p><p>5、商户server查询支付结果，api参见公共api【<a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=9_2">查询订单API</a>】</p><p>unipay</p><p>项目支付流程</p><p><img src= "/img/loading.gif" data-lazy-src="https://img.cdn.aliyun.dcloud.net.cn/uni-app/uniCloud/uni-pay-flow-chart.jpg" alt="image"></p><p>微信小程序支付流程</p><p><a href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com</a></p><p><img src= "/img/loading.gif" data-lazy-src="https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_11_2.png"></p><p>申请开通后,选择关联商户号或者新建商户号</p><p><img src= "/img/loading.gif" data-lazy-src="https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_11_3.png"></p><p>需要参数</p><table><thead><tr><th>参数</th></tr></thead><tbody><tr><td>secret       //小程序开发者密钥</td></tr><tr><td>mch_id        //获取商户号</td></tr><tr><td>appid      //小程序开发者appid</td></tr><tr><td>mch_key      //自设置密钥 32位 大小写数组组成,不能有特殊符号</td></tr></tbody></table><p>微信支付平台<a href="https://pay.weixin.qq.com/">https://pay.weixin.qq.com/</a></p><p>获取商户号</p><p><img src= "/img/loading.gif" data-lazy-src="https://5b0988e595225.cdn.sohucs.com/images/20180418/6c823ae29e224815bd4f2c4a7f173054.jpeg"></p><p>设置和获取key</p><p><img src= "/img/loading.gif" data-lazy-src="https://5b0988e595225.cdn.sohucs.com/images/20180418/637174ac8df54f7fb66e80c6faf454b7.png"></p><p><img src= "/img/loading.gif" data-lazy-src="https://5b0988e595225.cdn.sohucs.com/images/20180418/123f384696dc42af83b57f9fc5e7491d.jpeg"></p><h4 id="购物车结算"><a href="#购物车结算" class="headerlink" title="购物车结算"></a>购物车结算</h4><p>menu跳转到pay页面,并且生成订单</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">toPay() &#123;</span><br><span class="line">            if(!this.isLogin) &#123;</span><br><span class="line">                uni.navigateTo(&#123;url: &#39;&#x2F;pages&#x2F;login&#x2F;login&#39;&#125;)</span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            uni.showLoading(&#123;title: &#39;加载中&#39;&#125;)</span><br><span class="line">            return uniCloud.callFunction(&#123;</span><br><span class="line">                name:&#39;validateToken&#39;,</span><br><span class="line">                data:&#123;</span><br><span class="line">                    token:uni.getStorageSync(&#39;token&#39;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                    if(res.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        if(this.orderType &#x3D;&#x3D; &#39;takein&#39;) &#123;</span><br><span class="line">                            let data &#x3D; &#123;</span><br><span class="line">                                openId:res.result.openId,</span><br><span class="line">                                goodsInOrder:this.cart,</span><br><span class="line">                                chooseStore:this.choseStore.name</span><br><span class="line">                            &#125;;</span><br><span class="line">                            return uniCloud.callFunction(&#123;</span><br><span class="line">                                name:&#39;order&#39;,</span><br><span class="line">                                data:&#123;</span><br><span class="line">                                    data:data,</span><br><span class="line">                                    action:&#39;addTakein&#39;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125; else if (this.orderType &#x3D;&#x3D; &#39;takeout&#39;) &#123;</span><br><span class="line">                            let data &#x3D; &#123;</span><br><span class="line">                                openId:res.result.openId,</span><br><span class="line">                                goodsInOrder:this.cart,</span><br><span class="line">                                order_address:this.choseAddress._id,</span><br><span class="line">                                chooseStore:this.choseAddress.storeName</span><br><span class="line">                            &#125;</span><br><span class="line">                            return uniCloud.callFunction(&#123;</span><br><span class="line">                                name:&#39;order&#39;,</span><br><span class="line">                                </span><br><span class="line">                                data:&#123;</span><br><span class="line">                                    data:data,</span><br><span class="line">                                    action:&#39;addTakeout&#39;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content: res.result.msg,</span><br><span class="line">                            showCancel: false</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then(resData &#x3D;&gt; &#123;</span><br><span class="line">                    uni.navigateTo(&#123;</span><br><span class="line">                        url: &#39;&#x2F;pages&#x2F;pay&#x2F;pay?order_id&#x3D;&#39; + resData.result.order_id</span><br><span class="line">                    &#125;)</span><br><span class="line">                    uni.hideLoading()</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br></pre></td></tr></table></figure><p>更新</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tapTakein() &#123;</span><br><span class="line">            if (Object.keys(this.choseStore).length !&#x3D; 0) &#123;</span><br><span class="line">                this.SET_ORDERTYPE(&#39;takein&#39;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &#39;..&#x2F;stores&#x2F;stores&#39;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><p>加载menu</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">init() &#123;</span><br><span class="line">            if(Object.keys(this.choseStore).length &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url:&#39;..&#x2F;stores&#x2F;stores&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">                    </span><br><span class="line">            &#125; </span><br><span class="line">                return uniCloud</span><br><span class="line">                    .callFunction(&#123;</span><br><span class="line">                        name: &#39;goods&#39;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .then(res &#x3D;&gt; &#123;</span><br><span class="line">                        this.goods &#x3D; res.result.data;</span><br><span class="line">                    &#125;)</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><h4 id="unicloud创建云函数order"><a href="#unicloud创建云函数order" class="headerlink" title="unicloud创建云函数order"></a>unicloud创建云函数order</h4><p>首先安装crypto用来生成订单</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init --save</span><br><span class="line">npm install crypto</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">const crypto &#x3D; require(&#39;crypto&#39;)</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">if(event.action &#x3D;&#x3D; &#39;addTakein&#39;) &#123;</span><br><span class="line">        &#x2F;&#x2F;获取用户openId和goodsInOrder</span><br><span class="line">        const &#123;</span><br><span class="line">            goodsInOrder,</span><br><span class="line">            openId</span><br><span class="line">        &#125; &#x3D; event.data</span><br><span class="line">        &#x2F;&#x2F; 关联用户openId</span><br><span class="line">        const uid &#x3D; openId</span><br><span class="line">        &#x2F;&#x2F; 生成订单Id</span><br><span class="line">        const order_id &#x3D; parseInt(Date.now() &#x2F; 1000) + crypto</span><br><span class="line">            .createHash(&#39;md5&#39;)</span><br><span class="line">            .update(uid, &#39;utf-8&#39;)</span><br><span class="line">            .digest(&#39;hex&#39;).substring(0, 8);</span><br><span class="line">        &#x2F;&#x2F; 计算总金额</span><br><span class="line">        const totalFee &#x3D; goodsInOrder.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0)</span><br><span class="line">        </span><br><span class="line">        const chooseStore &#x3D; event.data.chooseStore</span><br><span class="line">        const orderResult &#x3D; await db.collection(&#39;orders&#39;).add(&#123;</span><br><span class="line">            uid,</span><br><span class="line">            order_type:0, &#x2F;&#x2F; 0 - 堂食订单</span><br><span class="line">            order_id,</span><br><span class="line">            goodsInOrder,</span><br><span class="line">            totalFee,</span><br><span class="line">            chooseStore,</span><br><span class="line">            status: 1 &#x2F;&#x2F; 1 - 未支付，2 - 已支付</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        if (!orderResult.id) &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                code: -3,</span><br><span class="line">                msg: &#39;创建订单失败，请稍后再试&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return &#123;</span><br><span class="line">            order_id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if (event.action &#x3D;&#x3D; &#39;addTakeout&#39;) &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;获取用户openId和goodsInOrder</span><br><span class="line">        const &#123;</span><br><span class="line">            goodsInOrder,</span><br><span class="line">            openId</span><br><span class="line">        &#125; &#x3D; event.data</span><br><span class="line">        &#x2F;&#x2F; 关联用户openId</span><br><span class="line">        const uid &#x3D; openId</span><br><span class="line">        &#x2F;&#x2F; 生成订单Id</span><br><span class="line">        const order_id &#x3D; parseInt(Date.now() &#x2F; 1000) + crypto</span><br><span class="line">            .createHash(&#39;md5&#39;)</span><br><span class="line">            .update(uid, &#39;utf-8&#39;)</span><br><span class="line">            .digest(&#39;hex&#39;).substring(0, 8);</span><br><span class="line">        &#x2F;&#x2F; 计算总金额</span><br><span class="line">        const totalFee &#x3D; goodsInOrder.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0) + 3</span><br><span class="line">        const order_address &#x3D; event.data.order_address</span><br><span class="line">        </span><br><span class="line">        const orderResult &#x3D; await db.collection(&#39;orders&#39;).add(&#123;</span><br><span class="line">            uid,</span><br><span class="line">            order_type:1, &#x2F;&#x2F; 1- 外卖订单</span><br><span class="line">            order_id,</span><br><span class="line">            goodsInOrder,</span><br><span class="line">            totalFee,</span><br><span class="line">            order_address,</span><br><span class="line">            status: 1 &#x2F;&#x2F; 1 - 未支付，2 - 已支付</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        if (!orderResult.id) &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                code: -3,</span><br><span class="line">                msg: &#39;创建订单失败，请稍后再试&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return &#123;</span><br><span class="line">            order_id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><h4 id="pay支付页面"><a href="#pay支付页面" class="headerlink" title="pay支付页面"></a>pay支付页面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">    .container &#123;</span><br><span class="line">        padding: 30rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .arrow &#123;</span><br><span class="line">        width: 50rpx; </span><br><span class="line">        height: 50rpx;</span><br><span class="line">        position: relative;</span><br><span class="line">        margin-right: -10rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .location &#123;</span><br><span class="line">        .store-name &#123;</span><br><span class="line">            font-size: $font-size-lg;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .iconfont &#123;</span><br><span class="line">            font-size: 50rpx;</span><br><span class="line">            line-height: 100%;</span><br><span class="line">            color: $color-primary;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .section-1 &#123;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        .contact &#123;</span><br><span class="line">            .contact-tip &#123;</span><br><span class="line">                margin-left: 10rpx;</span><br><span class="line">                border: 2rpx solid $color-primary;</span><br><span class="line">                padding: 6rpx 10rpx;</span><br><span class="line">                color: $color-primary;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .section-2 &#123;</span><br><span class="line">        .name-and-props &#123;</span><br><span class="line">            width: 65%;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .payment &#123;</span><br><span class="line">        margin-bottom: 30rpx;</span><br><span class="line">        </span><br><span class="line">        .disabled &#123;</span><br><span class="line">            color: $text-color-grey;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .payment-icon &#123;</span><br><span class="line">            font-size: 44rpx; </span><br><span class="line">            margin-right: 10rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .checkbox &#123;</span><br><span class="line">            font-size: 36rpx;</span><br><span class="line">            margin-left: 10rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .checked &#123;</span><br><span class="line">            color: $color-primary;</span><br><span class="line">        &#125;</span><br><span class="line">        .image &#123;</span><br><span class="line">            width: 40rpx;</span><br><span class="line">            height: 40rpx;</span><br><span class="line">            margin: 10rpx 20rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .pay-box &#123;</span><br><span class="line">        box-shadow: 0 0 20rpx rgba(0, 0, 0, .1);</span><br><span class="line">        height: 100rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .modal-content &#123;</span><br><span class="line">        .change-address-btn &#123;</span><br><span class="line">            line-height: 2;</span><br><span class="line">            padding: 0 1em;</span><br><span class="line">        &#125;</span><br><span class="line">        .pay_btn &#123;</span><br><span class="line">            width: 100%;</span><br><span class="line">            border-radius: 50rem !important;</span><br><span class="line">            line-height: 3;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>view部分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;container position-relative&quot;&gt;</span><br><span class="line">        &lt;view style&#x3D;&quot;margin-bottom: 130rpx;&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;section-1&quot;&gt;</span><br><span class="line">                &lt;template v-if&#x3D;&quot;orderType &#x3D;&#x3D; &#39;takein&#39;&quot;&gt;</span><br><span class="line">                    &lt;list-cell class&#x3D;&quot;location&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;flex-fill d-flex justify-content-between align-items-center&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;store-name flex-fill&quot;&gt;</span><br><span class="line">                                &#123;&#123; choseStore.name &#125;&#125;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;navigator-1.png&quot; class&#x3D;&quot;arrow&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;&#x2F;template&gt;</span><br><span class="line">                &lt;template v-else&gt;</span><br><span class="line">                    &lt;list-cell @click&#x3D;&quot;chooseAddress&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;d-flex align-items-center justify-content-between mb-10&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;font-size-extra-lg text-color-base&quot;&gt;&#123;&#123; choseAddress.street &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;navigator-1.png&quot; class&#x3D;&quot;arrow&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;d-flex text-color-assist font-size-sm align-items-center&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;mr-10&quot;&gt;&#123;&#123; choseAddress.accept_name &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;mr-10&quot;&gt;&#123;&#123; !choseAddress.gender ? &#39;先生&#39; : &#39;女士&#39; &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view&gt;&#123;&#123; choseAddress.mobile &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;&#x2F;template&gt;</span><br><span class="line">                &lt;template v-if&#x3D;&quot;orderType &#x3D;&#x3D; &#39;takein&#39;&quot;&gt;</span><br><span class="line">                    &lt;list-cell arrow class&#x3D;&quot;meal-time&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;flex-fill d-flex justify-content-between align-items-center&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;title&quot;&gt;取餐时间&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;time&quot;&gt;立即用餐&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;list-cell&gt;</span><br><span class="line">                    </span><br><span class="line">                &lt;&#x2F;template&gt;</span><br><span class="line">                &lt;template v-else&gt;</span><br><span class="line">                    &lt;list-cell&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;d-flex align-items-center font-size-base text-color-base&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;flex-fill&quot;&gt;预计送达时间&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;mr-10&quot;&gt;&#123;&#123; costTime &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;navigator-1.png&quot; class&#x3D;&quot;arrow&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-size-base text-color-primary&quot;&gt;</span><br><span class="line">                                特殊时期减少接触，请修改下方订单备注</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;&#x2F;template&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- 购物车列表 begin --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;section-2&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;cart d-flex flex-column&quot;&gt;</span><br><span class="line">                    &lt;list-cell last v-for&#x3D;&quot;(item, index) in cart&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;d-flex align-items-center mb-10&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;name-and-props overflow-hidden&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;text-color-base font-size-lg&quot;&gt;</span><br><span class="line">                                        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;d-flex flex-fill justify-content-between align-items-center text-color-base font-size-lg&quot;&gt;</span><br><span class="line">                                    &lt;view&gt;x&#123;&#123; item.number &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view&gt;￥&#123;&#123; item.price &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;text-truncate font-size-base text-color-assist&quot; v-if&#x3D;&quot;item.props_text&quot;&gt;</span><br><span class="line">                                &#123;&#123; item.props_text &#125;&#125;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;list-cell&gt;</span><br><span class="line">                    &lt;template v-if&#x3D;&quot;orderType &#x3D;&#x3D; &#39;takeout&#39;&quot;&gt;</span><br><span class="line">                        </span><br><span class="line">                        &lt;list-cell last &gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;w-100 d-flex font-size-base align-items-center justify-content-between&quot;&gt;</span><br><span class="line">                                &lt;view&gt;配送费&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view&gt;￥3&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;list-cell&gt;</span><br><span class="line">                    &lt;&#x2F;template&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;list-cell arrow @click&#x3D;&quot;goToPackages&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;flex-fill d-flex justify-content-between align-items-center&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;text-color-base&quot;&gt;奈雪券&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;text-color-primary&quot;&gt;超值购买优惠券大礼包&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;list-cell arrow&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;flex-fill d-flex justify-content-between align-items-center&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;text-color-base&quot;&gt;礼品卡&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;text-color-primary&quot;&gt;请选择&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;list-cell last&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;flex-fill d-flex justify-content-end align-items-center&quot;&gt;</span><br><span class="line">                        &lt;view&gt;总计￥&#123;&#123; total &#125;&#125;,实付&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-extra-lg font-weight-bold&quot;&gt;￥&#123;&#123; totalFee &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- 购物车列表 end --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;d-flex align-items-center justify-content-start font-size-sm text-color-warning&quot; </span><br><span class="line">                style&#x3D;&quot;padding: 20rpx 0;&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;iconfont iconhelp line-height-100&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view&gt;优惠券不与满赠、满减活动共享&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- 支付方式 begin --&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;payment&quot;&gt;</span><br><span class="line">                &lt;list-cell last :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;text&gt;支付方式&lt;&#x2F;text&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;radio-group &gt;</span><br><span class="line">                    &lt;label class&#x3D;&quot;d-flex align-items-center justify-content-between w-100 bg-white&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;images&#x2F;pay&#x2F;payment.png&quot;  class&#x3D;&quot;image&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;flex-fill&quot;&gt;余额支付（余额￥0）&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-size-sm&quot;&gt;余额不足&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;radio value&#x3D;&quot;default&quot; color&#x3D;&quot;#ADB838&quot; disabled&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;label&gt;</span><br><span class="line">                    &lt;label class&#x3D;&quot;d-flex align-items-center justify-content-between w-100 bg-white&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;static&#x2F;images&#x2F;pay&#x2F;weichat-pay.png&quot; class&#x3D;&quot;image&quot; &gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;flex-fill&quot;&gt;微信支付&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;radio value&#x3D;&quot;weichat&quot; checked&#x3D;&quot;true&quot; color&#x3D;&quot;#ADB838&quot; &#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;label&gt;</span><br><span class="line">                &lt;&#x2F;radio-group&gt;</span><br><span class="line">                </span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- 支付方式 end --&gt;</span><br><span class="line">            &lt;list-cell arrow last @click&#x3D;&quot;goToRemark&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;d-flex flex-fill align-items-center justify-content-between overflow-hidden&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;flex-shrink-0 mr-20&quot;&gt;备注&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;text-color-primary flex-fill text-truncate text-right&quot;&gt;&#123;&#123; form.remark || &#39;点击填写备注&#39; &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;list-cell&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- 付款栏 begin --&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;w-100 pay-box position-fixed fixed-bottom d-flex align-items-center justify-content-between bg-white&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;font-size-sm&quot; style&#x3D;&quot;margin-left: 20rpx;&quot;&gt;合计：&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;font-size-lg flex-fill&quot;&gt;￥&#123;&#123; totalFee &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;bg-primary h-100 d-flex align-items-center just-content-center text-color-white font-size-base&quot;</span><br><span class="line">                style&#x3D;&quot;padding: 0 60rpx;&quot; @tap&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">                付款</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;!-- 付款栏 end --&gt;</span><br><span class="line">        &lt;modal :show&#x3D;&quot;ensureAddressModalVisible&quot; custom :mask-closable&#x3D;&quot;false&quot; :radius&#x3D;&quot;0&quot; width&#x3D;&quot;90%&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;modal-content&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;d-flex justify-content-end&quot;&gt;</span><br><span class="line">                    &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;pay&#x2F;close.png&quot; style&#x3D;&quot;width: 40rpx; height: 40rpx;&quot; @tap&#x3D;&quot;ensureAddressModalVisible&#x3D;false&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;d-flex just-content-center align-items-center&quot; style&#x3D;&quot;margin-bottom: 40px;&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;font-size-extra-lg text-color-base&quot;&gt;请再次确认下单地址&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;d-flex font-size-base text-color-base font-weight-bold align-items-center justify-content-between mb-20&quot;&gt;</span><br><span class="line">                    &lt;view&gt;&#123;&#123; choseAddress.accept_name &#125;&#125; &#123;&#123; choseAddress.gender ? &#39;女士&#39; : &#39;先生&#39; &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view&gt;&#123;&#123; choseAddress.mobile &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;d-flex font-size-sm text-color-assist align-items-center justify-content-between mb-40&quot;&gt;</span><br><span class="line">                    &lt;view&gt;&#123;&#123; choseAddress.street  &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;button type&#x3D;&quot;primary&quot; size&#x3D;&quot;mini&quot; plain class&#x3D;&quot;change-address-btn&quot; @tap&#x3D;&quot;chooseAddress&quot;&gt;修改地址&lt;&#x2F;button&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;pay_btn&quot; @tap&#x3D;&quot;pay&quot;&gt;确认并付款&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;modal&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><h4 id="pay页面加载接收order云函数数据"><a href="#pay页面加载接收order云函数数据" class="headerlink" title="pay页面加载接收order云函数数据"></a>pay页面加载接收order云函数数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapState, mapMutations&#125; from &#39;vuex&#39;</span><br><span class="line">    import listCell from &#39;@&#x2F;components&#x2F;list-cell&#x2F;list-cell&#39;</span><br><span class="line">    import modal from &#39;@&#x2F;components&#x2F;modal&#x2F;modal&#39;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line">            listCell,</span><br><span class="line">            modal</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                cart: [],</span><br><span class="line">                totalFee:&#39;&#39;,</span><br><span class="line">                form: &#123;</span><br><span class="line">                    remark: &#39;&#39;</span><br><span class="line">                &#125;,</span><br><span class="line">                ensureAddressModalVisible: false,</span><br><span class="line">                order_id:&#39;&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            ...mapState([&#39;orderType&#39;, &#39;choseAddress&#39;, &#39;choseStore&#39;]),</span><br><span class="line">            costTime () &#123;</span><br><span class="line">                let mydate&#x3D; new Date();</span><br><span class="line">                let myNewDate &#x3D; new Date(mydate.setMinutes(mydate.getMinutes()+20));</span><br><span class="line">                 return myNewDate.getHours() + &quot;:&quot; + myNewDate.getMinutes()</span><br><span class="line">            &#125;,</span><br><span class="line">            total() &#123;</span><br><span class="line">                if(this.orderType &#x3D;&#x3D; &#39;takein&#39;)&#123;</span><br><span class="line">                    return this.cart.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0) </span><br><span class="line">                &#125; else if (this.orderType &#x3D;&#x3D; &#39;takeout&#39;) &#123;</span><br><span class="line">                    return this.cart.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0) +3</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        onLoad(option) &#123;</span><br><span class="line">            if(option.order_id) &#123;</span><br><span class="line">                uni.setStorage(&#123;</span><br><span class="line">                    key:&#39;orderId&#39;,</span><br><span class="line">                    data:option.order_id</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            this.order_id &#x3D; uni.getStorageSync(&#39;orderId&#39;) </span><br><span class="line">            this.init(this.order_id)</span><br><span class="line">            const &#123;remark&#125; &#x3D; option</span><br><span class="line">            remark &amp;&amp; this.$set(this.form, &#39;remark&#39;, remark)</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            ...mapMutations([&#39;SET_ORDER&#39;]),</span><br><span class="line">            &#x2F;&#x2F;初始化函数</span><br><span class="line">            init(id) &#123;</span><br><span class="line">                </span><br><span class="line">                return uniCloud.callFunction(&#123;</span><br><span class="line">                    name:&#39;order&#39;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        action:&#39;getOrder&#39;,</span><br><span class="line">                        order_id:id</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then(resData &#x3D;&gt; &#123;</span><br><span class="line">                    </span><br><span class="line">                    let data &#x3D; resData.result.data[0]</span><br><span class="line">                    if(data.order_type &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        this.SET_STORE(data.chooseStore)</span><br><span class="line">                         this.cart &#x3D; data.goodsInOrder</span><br><span class="line">                         this.totalFee &#x3D; data.totalFee</span><br><span class="line">                    &#125; else if(data.order_type &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">                        this.cart &#x3D; data.goodsInOrder</span><br><span class="line">                        this.totalFee &#x3D; data.totalFee</span><br><span class="line">                        let id &#x3D; data.order_address</span><br><span class="line">                        return uniCloud.callFunction(&#123;</span><br><span class="line">                            name:&#39;address&#39;,</span><br><span class="line">                            data: id</span><br><span class="line">                        &#125;).then(resAddress &#x3D;&gt; &#123;</span><br><span class="line">                            if(resAddress.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                                this.SET_ADDRESS(resAddress.result.data)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            goToRemark() &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &#39;&#x2F;pages&#x2F;remark&#x2F;remark?remark&#x3D;&#39; + this.form.remark</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            chooseAddress() &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &#39;&#x2F;pages&#x2F;address&#x2F;address&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            goToPackages() &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &#39;&#x2F;pages&#x2F;packages&#x2F;index&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            submit() &#123;</span><br><span class="line">                if(this.orderType &#x3D;&#x3D; &#39;takeout&#39;) &#123;</span><br><span class="line">                    this.ensureAddressModalVisible &#x3D; true</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    this.pay()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>address云函数添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">else if (event.action &#x3D;&#x3D; &#39;getOne&#39;) &#123;</span><br><span class="line">        const _id &#x3D; event.id</span><br><span class="line">        const res &#x3D; await db.collection(&#39;addresses&#39;).where(&#123;_id&#125;).limit(1).get()</span><br><span class="line">        const resData &#x3D; res.data</span><br><span class="line">        return &#123;</span><br><span class="line">            status:0,</span><br><span class="line">            data:resData</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>order云函数添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">else if(event.action &#x3D;&#x3D; &#39;getOrder&#39;) &#123;</span><br><span class="line">        let order_id &#x3D; event.order_id</span><br><span class="line">        const orderResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).get()</span><br><span class="line">        return orderResult</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="pay页面完善"><a href="#pay页面完善" class="headerlink" title="pay页面完善"></a>pay页面完善</h4><p>计算送餐时间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">costTime () &#123;</span><br><span class="line">                let mydate&#x3D; new Date();</span><br><span class="line">                let myNewDate &#x3D; new Date(mydate.setMinutes(mydate.getMinutes()+20));</span><br><span class="line">                 return myNewDate.getHours() + &quot;:&quot; + myNewDate.getMinutes()</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>前端计算商品总价和后端数据效验</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">total() &#123;</span><br><span class="line">                if(this.orderType &#x3D;&#x3D; &#39;takein&#39;)&#123;</span><br><span class="line">                    return this.cart.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0) </span><br><span class="line">                &#125; else if (this.orderType &#x3D;&#x3D; &#39;takeout&#39;) &#123;</span><br><span class="line">                    return this.cart.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0) +3</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">submit() &#123;</span><br><span class="line">        if(this.orderType &#x3D;&#x3D; &#39;takeout&#39;) &#123;</span><br><span class="line">            this.ensureAddressModalVisible &#x3D; true</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            this.pay()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    pay() &#123;</span><br><span class="line">        return uniCloud.callFunction(&#123;</span><br><span class="line">            name:&#39;pay&#39;,</span><br><span class="line">            data:&#123;</span><br><span class="line">                provider:&#39;wxpay&#39;,</span><br><span class="line">                order_id : this.order_id,</span><br><span class="line">                token:uni.getStorageSync(&#39;token&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h4 id="订单备注模块"><a href="#订单备注模块" class="headerlink" title="订单备注模块"></a>订单备注模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goToRemark() &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &#39;&#x2F;pages&#x2F;remark&#x2F;remark?remark&#x3D;&#39; + this.form.remark</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>data插入对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">form: &#123;</span><br><span class="line">                    remark: &#39;&#39;</span><br><span class="line">                &#125;,</span><br></pre></td></tr></table></figure><p>remark</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;container w-100 h-100 overflow-hidden&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;textarea&quot;&gt;</span><br><span class="line">            &lt;textarea placeholder-class&#x3D;&quot;text-color-assist font-size-base&quot; v-model&#x3D;&quot;remark&quot;</span><br><span class="line">                class&#x3D;&quot;bg-white w-100 border-box font-size-base remark&quot;</span><br><span class="line">                :class&#x3D;&quot;&#123;&#39;text-color-danger&#39;: remarkLength &gt; 50, &#39;text-color-assist&#39; : remarkLength &lt;&#x3D;50&#125;&quot;</span><br><span class="line">                placeholder&#x3D;&quot;请填写备注信息&quot; focus&#x2F;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;tips&quot; :class&#x3D;&quot;&#123;&#39;text-color-danger&#39;: remarkLength &gt; 50, &#39;text-color-assist&#39; : remarkLength &lt;&#x3D;50&#125;&quot;&gt;</span><br><span class="line">                &#123;&#123; remarkLength &#125;&#125;&#x2F;50</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;d-flex font-size-base text-color-assist&quot; style&#x3D;&quot;margin: 40rpx 0;&quot;&gt;</span><br><span class="line">            快捷输入</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;quick-inputs d-flex flex-wrap justify-content-start&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;quick-input&quot; v-for&#x3D;&quot;(item, index) in quickInputs&quot; :key&#x3D;&quot;index&quot; @tap&#x3D;&quot;handleQuickInput(item)&quot;&gt;</span><br><span class="line">                &#123;&#123; item &#125;&#125;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;d-flex just-content-center align-items-center&quot; style&#x3D;&quot;margin-top: 60rpx;&quot;&gt;</span><br><span class="line">            &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;submit-btn font-size-base&quot; @tap&#x3D;&quot;submit&quot;&gt;完成&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                remark: &#39;&#39;,</span><br><span class="line">                quickInputs: [</span><br><span class="line">                    &#39;请放门把手上&#39;, &#39;请放门口&#39;, &#39;请放前台桌上&#39;, &#39;如地址封闭管理，请电话与我联系&#39;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLoad(&#123;remark&#125;) &#123;</span><br><span class="line">            this.remark &#x3D; remark</span><br><span class="line">        &#125;,</span><br><span class="line">        computed: &#123;</span><br><span class="line">            remarkLength() &#123;</span><br><span class="line">                return this.remark.length</span><br><span class="line">            &#125;,</span><br><span class="line">            isDanger() &#123;</span><br><span class="line">                return this.remark.length &gt; 50</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleQuickInput(item) &#123;</span><br><span class="line">                this.remark &#x3D; this.remark.concat(&quot; &quot;, item)</span><br><span class="line">            &#125;,</span><br><span class="line">            submit() &#123;</span><br><span class="line">                uni.navigateTo(&#123;</span><br><span class="line">                    url: &quot;&#x2F;pages&#x2F;pay&#x2F;pay?remark&#x3D;&quot; + this.remark</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">    .container &#123;</span><br><span class="line">        padding: 30rpx 40rpx;</span><br><span class="line">        </span><br><span class="line">        .textarea &#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            </span><br><span class="line">            .remark &#123;</span><br><span class="line">                border-radius: 8rpx;</span><br><span class="line">                padding: 30rpx 40rpx;</span><br><span class="line">                height: 320rpx;</span><br><span class="line">                color: $font-size-base;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .tips &#123;</span><br><span class="line">                position: absolute;</span><br><span class="line">                bottom: 30rpx;</span><br><span class="line">                right: 40rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .quick-inputs &#123;</span><br><span class="line">            padding-right: 20rpx;</span><br><span class="line">            </span><br><span class="line">            .quick-input &#123;</span><br><span class="line">                background-color: #FFFFFF;</span><br><span class="line">                border: 2rpx solid $color-primary;</span><br><span class="line">                color: $color-primary;</span><br><span class="line">                font-size: $font-size-base;</span><br><span class="line">                padding: 16rpx 26rpx;</span><br><span class="line">                margin-right: 20rpx;</span><br><span class="line">                margin-bottom: 20rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        .submit-btn &#123;</span><br><span class="line">            width: 90%;</span><br><span class="line">            height: 80rpx;</span><br><span class="line">            border-radius: 40rpx;</span><br><span class="line">            line-height: 80rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在pay页面onload当中加载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const &#123;remark&#125; &#x3D; option</span><br><span class="line">remark &amp;&amp; this.$set(this.form, &#39;remark&#39;, remark)</span><br></pre></td></tr></table></figure><h4 id="提交订单触发支付"><a href="#提交订单触发支付" class="headerlink" title="提交订单触发支付"></a>提交订单触发支付</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">submit() &#123;</span><br><span class="line">                if(this.orderType &#x3D;&#x3D; &#39;takeout&#39;) &#123;</span><br><span class="line">                    this.ensureAddressModalVisible &#x3D; true</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    this.pay()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>pay</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">pay() &#123;</span><br><span class="line">                uni.showLoading(&#123;</span><br><span class="line">                    title:&#39;数据加载中...&#39;</span><br><span class="line">                &#125;);</span><br><span class="line">                return uniCloud.callFunction(&#123;</span><br><span class="line">                    name:&#39;validateToken&#39;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        token:uni.getStorageSync(&#39;token&#39;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then((res)&#x3D;&gt;&#123;</span><br><span class="line">                    if(res.result.status &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        return uniCloud.callFunction(&#123;</span><br><span class="line">                            name:&#39;pay&#39;,</span><br><span class="line">                            </span><br><span class="line">                            data:&#123;</span><br><span class="line">                                 provider:&#39;wxpay&#39;,</span><br><span class="line">                                 openId:res.result.openId,</span><br><span class="line">                                 order_id : this.order_id,</span><br><span class="line">                                 remark:this.form.remark</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">                    console.log(res);</span><br><span class="line">                    if (res.result.orderInfo) &#123;</span><br><span class="line">                        return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">                            uni.requestPayment(&#123;</span><br><span class="line">                                </span><br><span class="line">                                &#x2F;&#x2F; #ifdef MP-WEIXIN</span><br><span class="line">                                ...res.result.orderInfo,</span><br><span class="line">                                &#x2F;&#x2F; #endif</span><br><span class="line">                                </span><br><span class="line">                                complete() &#123;</span><br><span class="line">                                    resolve(res.result.order_id)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        throw new Error(res.result.msg)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then((order_id) &#x3D;&gt; &#123;</span><br><span class="line">                    return uniCloud.callFunction(&#123;</span><br><span class="line">                        name: &#39;order&#39;,</span><br><span class="line">                        data:&#123;</span><br><span class="line">                            action:&#39;getOrder&#39;,</span><br><span class="line">                            order_id:order_id</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">                    let resData &#x3D; res.result.data[0]</span><br><span class="line">                    if (resData.status &#x3D;&#x3D;&#x3D; 2) &#123;</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content: &#39;订单已支付&#39;,</span><br><span class="line">                            showCancel: false</span><br><span class="line">                        &#125;)</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        uni.removeStorageSync(&#39;cart&#39;)</span><br><span class="line">                        uni.reLaunch(&#123;</span><br><span class="line">                            url: &#39;&#x2F;pages&#x2F;take-foods&#x2F;take-foods&#39;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content: &#39;订单未支付&#39;,</span><br><span class="line">                            showCancel: false</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">                    uni.showModal(&#123;</span><br><span class="line">                        content: err.message || &#39;支付失败&#39;,</span><br><span class="line">                        showCancel: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        uni.hideLoading()</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content: res.result.msg,</span><br><span class="line">                            showCancel: false</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                                </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p><code>uni-app</code>前端已经封装的全端支付 api <code>uni.requestPayment</code>，现在服务端也封装好了<code>unipay for uniCloud</code>，从此开发者可以极快的完成前后一体的支付业务。</p><p>引入unipay</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这里直接从插件市场引入</span><br><span class="line">https:&#x2F;&#x2F;ext.dcloud.net.cn&#x2F;plugin?id&#x3D;1835</span><br></pre></td></tr></table></figure><p>设置config 公共函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;)</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F; 微信小程序端对应的微信支付及登录配置配置</span><br><span class="line">    wxConfigMp: &#123;</span><br><span class="line">        appId: &#39;&#39;,</span><br><span class="line">        secret: &#39;&#39;,</span><br><span class="line">        mchId: &#39;&#39;,</span><br><span class="line">        key: &#39;&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; App端对应的微信支付配置</span><br><span class="line">    wxConfigApp: &#123;</span><br><span class="line">        appId: &#39;&#39;,</span><br><span class="line">        mchId: &#39;&#39;,</span><br><span class="line">        key: &#39;&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 微信PC网站支付</span><br><span class="line">    wxConfigH5: &#123;</span><br><span class="line">        appId: &#39;&#39;,</span><br><span class="line">        mchId: &#39;&#39;,</span><br><span class="line">        key: &#39;&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 支付宝小程序端对应的支付宝支付及登录配置</span><br><span class="line">    aliConfigMp: &#123;</span><br><span class="line">        mchId: &quot;&quot;,</span><br><span class="line">        appId: &quot;&quot;,</span><br><span class="line">        alipayPublicKey: &quot;&quot;,</span><br><span class="line">        privateKey: &quot;&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; App端对应的支付宝支付配置</span><br><span class="line">    aliConfigApp: &#123;</span><br><span class="line">        mchId: &quot;&quot;,</span><br><span class="line">        appId: &quot;&quot;,</span><br><span class="line">        alipayPublicKey: &quot;&quot;,</span><br><span class="line">        privateKey: &quot;&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; App端对应的支付宝支付配置</span><br><span class="line">    aliConfigApp: &#123;</span><br><span class="line">        mchId: &quot;&quot;,</span><br><span class="line">        appId: &quot;&quot;,</span><br><span class="line">        privateKey: &quot;&quot;,</span><br><span class="line">        alipayRootCertPath: path.resolve(__dirname, &#39;.&#x2F;cert&#x2F;alipayRootCert.crt&#39;),</span><br><span class="line">        appCertPath: path.resolve(__dirname, &#39;.&#x2F;cert&#x2F;appCertPublicKey.crt&#39;),</span><br><span class="line">        alipayPublicCertPath: path.resolve(__dirname, &#39;.&#x2F;cert&#x2F;alipayCertPublicKey_RSA2.crt&#39;),</span><br><span class="line">        sandbox: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置require</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const &#123;</span><br><span class="line">    wxConfigMp,</span><br><span class="line">    wxConfigApp,</span><br><span class="line">    wxConfigH5,</span><br><span class="line">    aliConfigMp,</span><br><span class="line">    aliConfigApp,</span><br><span class="line">    aliConfigH5,</span><br><span class="line">    &#x2F;&#x2F; aliConfigSandbox</span><br><span class="line">&#125; &#x3D; require(&#39;config&#39;)</span><br><span class="line"></span><br><span class="line">const uniPay &#x3D; require(&#39;unipay&#39;)</span><br></pre></td></tr></table></figure><h4 id="Pay支付流程"><a href="#Pay支付流程" class="headerlink" title="Pay支付流程"></a>Pay支付流程</h4><p>1.获取订单信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let &#123;</span><br><span class="line">        provider,</span><br><span class="line">        order_id,</span><br><span class="line">        remark,</span><br><span class="line">        openId</span><br><span class="line">    &#125; &#x3D; event</span><br><span class="line"></span><br><span class="line">const orderList &#x3D; await db.collection(&#39;orders&#39;).where(&#123;</span><br><span class="line">        order_id</span><br><span class="line">    &#125;).get()</span><br><span class="line"></span><br><span class="line">    if (orderList.data.length !&#x3D;&#x3D; 1 || orderList.data[0].status !&#x3D;&#x3D; 1) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            code: -2,</span><br><span class="line">            msg: &#39;订单状态不正确&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>2.添加订单支付方式和备注</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">await db.collection(&#39;orders&#39;).where(&#123;</span><br><span class="line">        order_id,</span><br><span class="line">    &#125;).update(&#123;</span><br><span class="line">        payment_channel: provider,</span><br><span class="line">        order_remark:remark</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p>3.声明参数</p><p>官网获取支付参数</p><p><a href="https://uniapp.dcloud.io/uniCloud/unipay">https://uniapp.dcloud.io/uniCloud/unipay</a></p><p>云函数的传入参数有两个，一个是<code>event</code>对象，一个是<code>context</code>对象。<code>event</code>指的是触发云函数的事件，当客户端调用云函数时，<code>event</code>就是客户端调用云函数时传入的参数。<code>context</code> 对象包含了此处调用的调用信息和运行状态，可以用它来了解服务运行的情况。<code>uniCloud</code>会自动将客户端的操作系统（<code>os</code>）、运行平台（<code>platform</code>）、应用信息（<code>appid</code>）等注入<code>context</code>中，开发者可通过<code>context</code>获取每次调用的上下文</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">let uniPayInstance,</span><br><span class="line">        notifyUrl &#x3D;</span><br><span class="line">        &#96;https:&#x2F;&#x2F;uni937d4b0-6cc760.service.tcloudbase.com&#x2F;payment-notify&#x2F;$&#123;provider&#125;_$&#123;context.PLATFORM&#125;&#96;,</span><br><span class="line">        openid,</span><br><span class="line">        tradeType</span><br><span class="line">        </span><br><span class="line">switch (provider + &#39;_&#39; + context.PLATFORM) &#123;</span><br><span class="line">            case &#39;wxpay_mp-weixin&#39;:</span><br><span class="line">                uniPayInstance &#x3D; uniPay.initWeixin(wxConfigMp)</span><br><span class="line">                openid &#x3D; openId</span><br><span class="line">                tradeType &#x3D; &#39;JSAPI&#39;</span><br><span class="line">                break;</span><br><span class="line">            case &#39;alipay_mp-alipay&#39;:</span><br><span class="line">                uniPayInstance &#x3D; uniPay.initAlipay(aliConfigMp)</span><br><span class="line">                openid &#x3D; userInfo.ali_openid</span><br><span class="line">                break;</span><br><span class="line">            case &#39;wxpay_app-plus&#39;:</span><br><span class="line">                uniPayInstance &#x3D; uniPay.initWeixin(wxConfigApp)</span><br><span class="line">                tradeType &#x3D; &#39;APP&#39;</span><br><span class="line">                break;</span><br><span class="line">            case &#39;alipay_app-plus&#39;:</span><br><span class="line">                uniPayInstance &#x3D; uniPay.initAlipay(aliConfigApp)</span><br><span class="line">                break;</span><br><span class="line">            case &#39;wxpay_h5&#39;:</span><br><span class="line">                uniPayInstance &#x3D; uniPay.initWeixin(wxConfigH5)</span><br><span class="line">                tradeType &#x3D; &#39;NATIVE&#39;</span><br><span class="line">                break;</span><br><span class="line">            case &#39;alipay_h5&#39;:</span><br><span class="line">                uniPayInstance &#x3D; uniPay.initAlipay(aliConfigH5)</span><br><span class="line">                &#x2F;&#x2F; uniPayInstance &#x3D; uniPay.initAlipay(aliConfigSandbox)</span><br><span class="line">                tradeType &#x3D; &#39;NATIVE&#39;</span><br><span class="line">                break;    </span><br><span class="line">            default:</span><br><span class="line">                return &#123;</span><br><span class="line">                    code: -1,</span><br><span class="line">                    msg: &#39;参数错误&#39;</span><br><span class="line">                &#125;    </span><br><span class="line">        &#125;        </span><br></pre></td></tr></table></figure><p>提取订单总价</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const &#123;</span><br><span class="line">        totalFee,</span><br><span class="line">    &#125; &#x3D; orderList.data[0]</span><br><span class="line">    </span><br><span class="line">    let orderInfo</span><br></pre></td></tr></table></figure><p>提交getOrderInfo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">        &#x2F;&#x2F; 获取支付信息</span><br><span class="line">        orderInfo &#x3D; await uniPayInstance.getOrderInfo(&#123;</span><br><span class="line">            openid, &#x2F;&#x2F; App端支付时不需要openid，传入个undefined也没有影响</span><br><span class="line">            order_id,</span><br><span class="line">            totalFee,</span><br><span class="line">            subject: &quot;订单标题&quot;,</span><br><span class="line">            body: &quot;奈雪的茶订单详情&quot;,</span><br><span class="line">            notifyUrl,</span><br><span class="line">            tradeType</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        console.log(e.message)</span><br><span class="line">        return &#123;</span><br><span class="line">            code: -3,</span><br><span class="line">            msg: &#39;获取支付信息失败，请稍后再试&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;返回orderInfo</span><br><span class="line">return &#123;</span><br><span class="line">        order_id,</span><br><span class="line">        orderInfo</span><br><span class="line">    &#125;        </span><br></pre></td></tr></table></figure><p>payment_notify云函数负责支付结果通知地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const &#123;</span><br><span class="line">    wxConfigMp,</span><br><span class="line">    wxConfigApp,</span><br><span class="line">    wxConfigH5,</span><br><span class="line">    aliConfigMp,</span><br><span class="line">    aliConfigApp,</span><br><span class="line">    aliConfigH5,</span><br><span class="line">    &#x2F;&#x2F; aliConfigSandbox</span><br><span class="line">&#125; &#x3D; require(&#39;config&#39;)</span><br><span class="line">const uniPay &#x3D; require(&#39;unipay&#39;)</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    let uniPayInstance</span><br><span class="line">    switch (event.path.substring(1)) &#123;</span><br><span class="line">        case &#39;wxpay_mp-weixin&#39;:</span><br><span class="line">            uniPayInstance &#x3D; uniPay.initWeixin(wxConfigMp)</span><br><span class="line">            break;</span><br><span class="line">        case &#39;wxpay_app-plus&#39;:</span><br><span class="line">            uniPayInstance &#x3D; uniPay.initWeixin(wxConfigApp)</span><br><span class="line">            break;</span><br><span class="line">        case &#39;wxpay_h5&#39;:</span><br><span class="line">            uniPayInstance &#x3D; uniPay.initWeixin(wxConfigH5)</span><br><span class="line">            break;</span><br><span class="line">        case &#39;alipay_mp-alipay&#39;:</span><br><span class="line">            uniPayInstance &#x3D; uniPay.initAlipay(aliConfigMp)</span><br><span class="line">            break;</span><br><span class="line">        case &#39;alipay_app-plus&#39;:</span><br><span class="line">            uniPayInstance &#x3D; uniPay.initAlipay(aliConfigApp)</span><br><span class="line">            break;</span><br><span class="line">        case &#39;alipay_h5&#39;:</span><br><span class="line">            uniPayInstance &#x3D; uniPay.initAlipay(aliConfigH5)</span><br><span class="line">            &#x2F;&#x2F; uniPayInstance &#x3D; uniPay.initAlipay(aliConfigSandbox)</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            console.log(&#39;---------参数错误-------&#39;)</span><br><span class="line">            return &#123;</span><br><span class="line">                code: -1,</span><br><span class="line">                msg: &#39;参数错误&#39;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    let verifyResult &#x3D; await uniPayInstance.verifyPaymentNotify(event)</span><br><span class="line">    if (!verifyResult) &#123;</span><br><span class="line">        console.log(&#39;---------!verifyResult-------&#39;)</span><br><span class="line">        return &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    let &#123;</span><br><span class="line">        order_id,</span><br><span class="line">        totalFee,</span><br><span class="line">        transactionId,</span><br><span class="line">        resultCode</span><br><span class="line">    &#125; &#x3D; verifyResult</span><br><span class="line"></span><br><span class="line">    const orderList &#x3D; await db.collection(&#39;orders&#39;).where(&#123;</span><br><span class="line">        order_id</span><br><span class="line">    &#125;).get()</span><br><span class="line"></span><br><span class="line">    if (orderList.data.length &lt; 0) &#123;</span><br><span class="line">        console.log(&#39;---------orderList.data.length &lt; 0-------&#39;)</span><br><span class="line">        return &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const orderDetail &#x3D; orderList.data[0]</span><br><span class="line"></span><br><span class="line">    if (totalFee &#x3D;&#x3D;&#x3D; orderDetail.totalFee &amp;&amp; (resultCode &#x3D;&#x3D;&#x3D; &#39;SUCCESS&#39; || resultCode &#x3D;&#x3D;&#x3D; &#39;FINISHED&#39;)) &#123;</span><br><span class="line">        console.log(&#39;---------updatedb-------&#39;)</span><br><span class="line">        await db.collection(&#39;orders&#39;).where(&#123;</span><br><span class="line">            order_id</span><br><span class="line">        &#125;).update(&#123;</span><br><span class="line">            status: 2,</span><br><span class="line">            transactionId</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&quot;verifyResult: &quot; + JSON.stringify(verifyResult));</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="order流程-进入取餐界面"><a href="#order流程-进入取餐界面" class="headerlink" title="order流程,进入取餐界面"></a>order流程,进入取餐界面</h4><p>订单流程: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">生成订单 - status :1</span><br><span class="line"></span><br><span class="line">订单支付 - status: 2</span><br><span class="line"></span><br><span class="line">制作中  -     status:3</span><br><span class="line"></span><br><span class="line">配送中(外卖)  -    status:4</span><br><span class="line"></span><br><span class="line">待取餐 (自取) -    status:5</span><br><span class="line"></span><br><span class="line">订单完成 -  stauts:6</span><br></pre></td></tr></table></figure><p>返回数据:</p><p>这个流程,用户已经完成了订单支付</p><p>支付完成才算真正开始下单,</p><p>在order云函数返回参数包括门店名称,商品 ,数量,总价,支付方式外还需要,</p><p>并且排队人数和取单时间变化,take_food需要定时刷新</p><ol><li>下单时间;  </li><li>生成取单号;</li><li>查询status:3的订单数量,确定排队人数</li><li>根据排队人数计算取单时间;</li></ol><p>统一在后端处理时间问题;</p><p>*</p><p>门店名称 chooseStore</p><p>订单状态 status</p><p>订单类型 order_type</p><p>订单制作状态 peopleNum</p><p>订单商品信息 (商品名称\商品规格\商品数量\商品价格)</p><p>支付方式 payment_channel</p><p>订单总价 totalFee</p><p>下单时间 time</p><p>订单号 order_id</p><p>取单号: sort_num</p><p>享用方式:自取/外卖</p><p>下单时间: createOrderTime</p><p>自取待取餐时间:takeTime</p><p>备注: remark</p><p>测试pay 虚拟订单号 进入 takefood取餐信息页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pay() &#123;</span><br><span class="line">            </span><br><span class="line">            uni.removeStorageSync(&#39;cart&#39;);</span><br><span class="line">            uni.reLaunch(&#123;</span><br><span class="line">                url: &#39;&#x2F;pages&#x2F;take-foods&#x2F;take-foods?order_id&#x3D;&#39; + &quot;1598597261a5a19b39&quot;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="take-food取餐页面"><a href="#take-food取餐页面" class="headerlink" title="take_food取餐页面"></a>take_food取餐页面</h4><p>取餐页面一</p><p>搞定v-if页面加载动画</p><h4 id="unicloud公共模块时区"><a href="#unicloud公共模块时区" class="headerlink" title="unicloud公共模块时区"></a>unicloud公共模块时区</h4><p>首先解决时间</p><p>*时区问题**</p><p>uniCloud云端的云函数使用的时区是utc+0，本地运行时使用的是本机时间，中国一般是+8。在使用“时间戳”时两者没有差异，但如果要获取年、月、日、小时要注意时区的差异。</p><p>以下方式可以获取指定时区的年、月、日、小时，可以参考一下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取偏移后的Date对象，例如utc+x时offset就传x</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOffsetDate</span> (<span class="params">offset</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(</span><br><span class="line">    <span class="built_in">Date</span>.now() + (<span class="keyword">new</span> <span class="built_in">Date</span>().getTimezoneOffset() + (offset || <span class="number">0</span>) * <span class="number">60</span>) * <span class="number">60000</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取utc+8的小时数</span></span><br><span class="line"><span class="keyword">const</span> hour = getOffsetDate(<span class="number">8</span>).getHours()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取时间戳无需使用此方式utc+0时间戳是与utc+8时间戳一致的</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function getNowFormatDate(e) &#123; &#x2F;&#x2F; 获取时间格式“yyyy-MM-dd HH:MM:SS”</span><br><span class="line">    var date &#x3D; e;</span><br><span class="line">    var seperator1 &#x3D; &quot;-&quot;;</span><br><span class="line">    var seperator2 &#x3D; &quot;:&quot;;</span><br><span class="line">    var month &#x3D; date.getMonth() + 1;</span><br><span class="line">    var strDate &#x3D; date.getDate();</span><br><span class="line">    var strHours &#x3D; date.getHours();</span><br><span class="line">    var strMinutes &#x3D; date.getMinutes();</span><br><span class="line">    var strSeconds &#x3D; date.getSeconds();</span><br><span class="line">    if (month &gt;&#x3D; 1 &amp;&amp; month &lt;&#x3D; 9) &#123;</span><br><span class="line">        month &#x3D; &quot;0&quot; + month;</span><br><span class="line">    &#125;</span><br><span class="line">    if (strDate &gt;&#x3D; 0 &amp;&amp; strDate &lt;&#x3D; 9) &#123;</span><br><span class="line">        strDate &#x3D; &quot;0&quot; + strDate;</span><br><span class="line">    &#125;</span><br><span class="line">    if (strHours &gt;&#x3D; 0 &amp;&amp; strHours &lt;&#x3D; 9) &#123;</span><br><span class="line">        strHours &#x3D; &quot;0&quot; + strHours;</span><br><span class="line">    &#125;</span><br><span class="line">    if (strMinutes &gt;&#x3D; 0 &amp;&amp; strMinutes &lt;&#x3D; 9) &#123;</span><br><span class="line">        strMinutes &#x3D; &quot;0&quot; + strMinutes;</span><br><span class="line">    &#125;</span><br><span class="line">    if (strSeconds &gt;&#x3D; 0 &amp;&amp; strSeconds &lt;&#x3D; 9) &#123;</span><br><span class="line">        strSeconds &#x3D; &quot;0&quot; + strSeconds;</span><br><span class="line">    &#125;</span><br><span class="line">    var currentdate &#x3D; date.getFullYear() + seperator1 + month + seperator1 + strDate</span><br><span class="line">            + &quot; &quot; + strHours + seperator2 + strMinutes</span><br><span class="line">            + seperator2 + strSeconds;</span><br><span class="line">    return currentdate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来数据封装,返回到前端</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">let order_id &#x3D; event.order_id</span><br><span class="line">         </span><br><span class="line">        const num &#x3D; Math.floor(Math.random()*700 + 800)</span><br><span class="line">        let nowTime &#x3D; getOffsetDate(8)</span><br><span class="line">        &#x2F;&#x2F;获取当前时间</span><br><span class="line">        let time &#x3D; getNowFormatDate(nowTime)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;查询制作中的订单数</span><br><span class="line">        const peopleNum &#x3D; await db.collection(&#39;orders&#39;).where(&#123;status:3&#125;)</span><br><span class="line">        .count().then(res &#x3D;&gt; &#123;</span><br><span class="line">                  return res.total</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">        &#x2F;&#x2F;计算取餐时间</span><br><span class="line">        let mydate &#x3D; getOffsetDate(8);</span><br><span class="line">        let myNewDate &#x3D; new Date(mydate.setMinutes(mydate.getMinutes() + peopleNum * 2));</span><br><span class="line">    </span><br><span class="line">        let takeTime &#x3D; getNowFormatDate(myNewDate)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;保存订单创建时间,并生成取单号</span><br><span class="line">        const resResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).update(&#123;</span><br><span class="line">            createOrderTime:time,</span><br><span class="line">            sort_num:num,</span><br><span class="line">            takeTime:takeTime,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        const fields &#x3D; &#123;</span><br><span class="line">            chooseStore:1,</span><br><span class="line">            order_id:1,</span><br><span class="line">            status:1,</span><br><span class="line">            order_type:1,</span><br><span class="line">            goodsInOrder:1,</span><br><span class="line">            totalFee:1,</span><br><span class="line">            remark:1,</span><br><span class="line">            sort_num:1,</span><br><span class="line">            payment_channel:1,</span><br><span class="line">            createOrderTime:1,</span><br><span class="line">            takeTime:1</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 查询fields数据</span><br><span class="line">        let ResultOK &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(fields).get()</span><br><span class="line">        let ResultData &#x3D; ResultOK.data[0];</span><br><span class="line">        if (resResult.id || resResult.updated &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">              &quot;status&quot;: 0,</span><br><span class="line">              &quot;data&quot;: ResultData,</span><br><span class="line">              &quot;peopleNum&quot;:peopleNum</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;view v-if&#x3D;&quot;!orderCurrent.order_id&quot; class&#x3D;&quot;d-flex w-100 h-100 flex-column just-content-center align-items-center&quot;&gt;</span><br><span class="line">            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;loading.gif&quot; class&#x3D;&quot;drinks-img&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;tips d-flex flex-column align-items-center font-size-base text-color-assist&quot;&gt;</span><br><span class="line">                &lt;view&gt;您还没有点单&lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view&gt;快去犒劳一下自己吧~&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;button type&#x3D;&quot;primary&quot; class&#x3D;&quot;drink-btn&quot; size&#x3D;&quot;default&quot; @tap&#x3D;&quot;menu&quot;&gt;去点餐&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;font-size-sm text-color-primary&quot; @tap&#x3D;&quot;orders&quot;&gt;查看历史订单&lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapMutations &#125; from &#39;vuex&#39;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                peopleNum:&#39;&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLoad(option) &#123;</span><br><span class="line">            </span><br><span class="line">                this.init(option.order_id)</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">            ...mapState([&#39;orderCurrent&#39;]),</span><br><span class="line">            &#x2F;&#x2F;支付方式</span><br><span class="line">            payMethods()&#123;</span><br><span class="line">                if(this.orderCurrent.payment_channel &#x3D;&#x3D; &#39;wxpay&#39;) &#123;</span><br><span class="line">                    return &#39;微信支付&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            ...mapMutations([&#39;SET_ORDERID&#39;]),</span><br><span class="line">            &#x2F;&#x2F;初始化加载数据</span><br><span class="line">            init(id) &#123;</span><br><span class="line">                if(Object.keys(this.orderCurrent).length &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                    return uniCloud.callFunction(&#123;</span><br><span class="line">                        name:&#39;order&#39;,</span><br><span class="line">                        data:&#123;</span><br><span class="line">                            action: &#39;currentOrder&#39;,</span><br><span class="line">                            order_id: id</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;).then(res &#x3D;&gt; &#123;</span><br><span class="line">                        console.log(res)</span><br><span class="line">                        this.SET_ORDERID(res.result.data)</span><br><span class="line">                        </span><br><span class="line">                        this.peopleNum &#x3D; res.result.peopleNum</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            menu() &#123;</span><br><span class="line">                uni.switchTab(&#123;</span><br><span class="line">                    url: &#39;&#x2F;pages&#x2F;menu&#x2F;menu&#39;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="order云函数回调数据"><a href="#order云函数回调数据" class="headerlink" title="order云函数回调数据"></a>order云函数回调数据</h4><p>查询正在制作中的订单号,并返回保存到小程序缓存中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">let order_id &#x3D; event.order_id</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;查询订单所属门店</span><br><span class="line">            const store &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(&#123;chooseStore:1&#125;)</span><br><span class="line">            .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                return res.data[0].chooseStore</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F;查询订单制作中status:3状态的订单数量</span><br><span class="line">            const num &#x3D; await db.collection(&#39;orders&#39;)</span><br><span class="line">            .where(&#123;</span><br><span class="line">                status:3,</span><br><span class="line">                chooseStore:store</span><br><span class="line">            &#125;)</span><br><span class="line">            .count().then(res &#x3D;&gt; &#123;</span><br><span class="line">                return res.total</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F;获取订单制作中的订单号</span><br><span class="line">            const currentId &#x3D; await db.collection(&#39;orders&#39;)</span><br><span class="line">            .where(&#123;</span><br><span class="line">                status:3,</span><br><span class="line">                chooseStore:store                </span><br><span class="line">            &#125;).field(&#123;order_id:1&#125;)</span><br><span class="line">            .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                return res.data</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F;生成下单时间,从支付完成开始算起</span><br><span class="line">            const time &#x3D; getOffsetDate(8)</span><br><span class="line">            const nowTime &#x3D; getNowFormatDate(time)</span><br><span class="line">            &#x2F;&#x2F;计算取餐时间 制作订单数量*2分钟</span><br><span class="line">            const nTime &#x3D; new Date(time.setMinutes(time.getMinutes() + num*2))</span><br><span class="line">            const takeTime &#x3D; getNowFormatDate(nTime)</span><br><span class="line">            &#x2F;&#x2F;生成取餐码</span><br><span class="line">            const code &#x3D; Math.floor(Math.random()*700 + 800)</span><br><span class="line">            &#x2F;&#x2F;更新数据</span><br><span class="line">            const updateResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).update(&#123;</span><br><span class="line">                createOrderTime:nowTime,</span><br><span class="line">                takeTime:takeTime,</span><br><span class="line">                sort_num:code,</span><br><span class="line">                status:3</span><br><span class="line">                </span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F;field封装数据</span><br><span class="line">            const fields &#x3D; &#123;</span><br><span class="line">                            chooseStore:1,</span><br><span class="line">                            order_id:1,</span><br><span class="line">                            status:1,</span><br><span class="line">                            order_type:1,</span><br><span class="line">                            goodsInOrder:1,</span><br><span class="line">                            totalFee:1,</span><br><span class="line">                            remark:1,</span><br><span class="line">                            sort_num:1,</span><br><span class="line">                            payment_channel:1,</span><br><span class="line">                            createOrderTime:1,</span><br><span class="line">                            takeTime:1</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F;查询封装数据类型输出</span><br><span class="line">            </span><br><span class="line">            const resResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(fields)</span><br><span class="line">            .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                return res.data[0]</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            let current &#x3D; &#123;&#125;</span><br><span class="line">            current.currentId &#x3D; currentId</span><br><span class="line">            current.peopleNum &#x3D; num</span><br><span class="line">            </span><br><span class="line">            if(updateResult.id || updateResult.updated &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">                return &#123;</span><br><span class="line">                    &#39;status&#39;:0,</span><br><span class="line">                    &#39;data&#39;: resResult,</span><br><span class="line">                    &#39;current&#39;: current</span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return &#123;</span><br><span class="line">                    &#39;status&#39;:1,</span><br><span class="line">                    &#39;msg&#39;: &#39;后台数据错误&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br></pre></td></tr></table></figure><h4 id="取餐页面数据渲染"><a href="#取餐页面数据渲染" class="headerlink" title="取餐页面数据渲染"></a>取餐页面数据渲染</h4><p>引入组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import listCell from &#39;@&#x2F;components&#x2F;list-cell&#x2F;list-cell&#39;</span><br></pre></td></tr></table></figure><p>css样式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">    &#x2F;* #ifdef H5 *&#x2F;</span><br><span class="line">    page &#123;</span><br><span class="line">        min-height: 100%;</span><br><span class="line">        background-color: $bg-color;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;* #endif *&#x2F;</span><br><span class="line">    .order-box &#123;</span><br><span class="line">        padding: 20rpx;</span><br><span class="line">        &#x2F;* #ifdef H5 *&#x2F;</span><br><span class="line">        margin-bottom: 100rpx;</span><br><span class="line">        &#x2F;* #endif *&#x2F;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .drinks-img &#123;</span><br><span class="line">        width: 260rpx;</span><br><span class="line">        height: 260rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .tips &#123;</span><br><span class="line">        margin: 60rpx 0 80rpx;</span><br><span class="line">        line-height: 48rpx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .drink-btn &#123;</span><br><span class="line">        width: 320rpx;</span><br><span class="line">        border-radius: 50rem !important;</span><br><span class="line">        margin-bottom: 40rpx;</span><br><span class="line">        font-size: $font-size-base;</span><br><span class="line">        line-height: 3.0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @mixin arch &#123;</span><br><span class="line">        content: &quot;&quot;;</span><br><span class="line">        position: absolute;</span><br><span class="line">        background-color: $bg-color;</span><br><span class="line">        width: 30rpx;</span><br><span class="line">        height: 30rpx;</span><br><span class="line">        bottom: -15rpx;</span><br><span class="line">        z-index: 10;</span><br><span class="line">        border-radius: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .section &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        </span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">            @include arch;</span><br><span class="line">            left: -15rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &amp;::after &#123;</span><br><span class="line">            @include arch;</span><br><span class="line">            right: -15rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .pay-cell &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        font-size: $font-size-base;</span><br><span class="line">        color: $text-color-base;</span><br><span class="line">        margin-bottom: 40rpx;</span><br><span class="line"></span><br><span class="line">        &amp;:nth-last-child(1) &#123;</span><br><span class="line">            margin-bottom: 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .sort-num &#123;</span><br><span class="line">        font-size: 64rpx;</span><br><span class="line">        font-weight: bold;</span><br><span class="line">        color: $text-color-base;</span><br><span class="line">        line-height: 2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .steps__img-column &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        margin: 30rpx 0;</span><br><span class="line">        </span><br><span class="line">        .steps__img-column-item &#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            </span><br><span class="line">            image &#123;</span><br><span class="line">                width: 80rpx;</span><br><span class="line">                height: 80rpx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .steps__text-column &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        margin-bottom: 40rpx;</span><br><span class="line">        </span><br><span class="line">        .steps__text-column-item &#123;</span><br><span class="line">            flex: 1;</span><br><span class="line">            display: inline-flex;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            font-size: $font-size-base;</span><br><span class="line">            color: $text-color-assist;</span><br><span class="line">            </span><br><span class="line">            &amp;.active &#123;</span><br><span class="line">                color: $text-color-base;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                </span><br><span class="line">                .steps__column-item-line &#123;</span><br><span class="line">                    background-color: $text-color-base;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .steps__column-item-line&#123;</span><br><span class="line">                flex: 1;</span><br><span class="line">                height: 2rpx;</span><br><span class="line">                background-color: #919293;</span><br><span class="line">                transform: scaleY(0.5);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            .steps__text-column-item-text &#123;</span><br><span class="line">                margin: 0 8px;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>v-else template</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-else&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;order-box&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;bg-white&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;section&quot;&gt;</span><br><span class="line">                &lt;!-- store info begin --&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;w-100 d-flex align-items-center&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;d-flex flex-column w-60&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;w-100 font-size-lg text-color-base text-truncate&quot;&gt;&#123;&#123; orderCurrent.chooseStore&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;d-flex justify-content-end align-items-center w-40&quot;&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;mobile.png&quot; style&#x3D;&quot;width: 60rpx; height: 60rpx;margin-right: 30rpx;&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                            &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;navigation.png&quot; style&#x3D;&quot;width: 60rpx; height: 60rpx;&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;!-- store info end --&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot; padding&#x3D;&quot;50rpx 30rpx&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;d-flex align-items-center just-content-center&quot; v-if&#x3D;&quot;orderCurrent.order_type &#x3D;&#x3D; 0&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;sort-num&quot;&gt;&#123;&#123; orderCurrent.sort_num &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;!-- steps begin --&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;d-flex just-content-center&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;steps d-flex flex-column&quot; :class&#x3D;&quot;&#123;&#39;w-80&#39;: orderCurrent.order_type &#x3D;&#x3D; 0, &#39;w-100&#39;: orderCurrent.order_type &#x3D;&#x3D; 1&#125;&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;steps__img-column&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__img-column-item&quot;&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;ordered_selected.png&quot; v-if&#x3D;&quot;orderCurrent.status &gt;&#x3D; 2&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;ordered_selected.png&quot; v-else&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__img-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 3&#125;&quot;&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;production_selected.png&quot; v-if&#x3D;&quot;orderCurrent.status &gt;&#x3D; 3&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;production.png&quot; v-else&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__img-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 4&#125;&quot; v-if&#x3D;&quot;orderCurrent.order_type &#x3D;&#x3D; 1&quot;&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;delivery_selected.png&quot; v-if&#x3D;&quot;orderCurrent.status &gt;&#x3D; 4&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;delivered.png&quot; v-else&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__img-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 5&#125;&quot;&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;delivered_selected.png&quot; v-if&#x3D;&quot;orderCurrent.status &gt;&#x3D; 5&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                        &lt;image src&#x3D;&quot;&#x2F;static&#x2F;images&#x2F;order&#x2F;delivered.png&quot; v-else&gt;&lt;&#x2F;image&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;steps__text-column&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__text-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 2&#125;&quot;&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line bg-transparent&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__text-column-item-text&quot;&gt;已下单&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__text-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 3&#125;&quot;&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__text-column-item-text&quot;&gt;制作中&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__text-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 4&#125;&quot; v-if&#x3D;&quot;orderCurrent.order_type &#x3D;&#x3D; 1&quot;&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__text-column-item-text&quot;&gt;配送中&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;steps__text-column-item&quot; :class&#x3D;&quot;&#123;active: orderCurrent.status &gt;&#x3D; 5&#125;&quot;&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__text-column-item-text&quot;&gt;</span><br><span class="line">                                            &#123;&#123; orderCurrent.order_type &#x3D;&#x3D; 1 ? &#39;已送达&#39; : &#39;请取餐&#39; &#125;&#125;</span><br><span class="line">                                        &lt;&#x2F;view&gt;</span><br><span class="line">                                        &lt;view class&#x3D;&quot;steps__column-item-line bg-transparent&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;!-- steps end --&gt;</span><br><span class="line">                        &lt;view v-if&#x3D;&quot;orderCurrent.status&lt;&#x3D;3&quot; class&#x3D;&quot;d-flex just-content-center align-items-center font-size-base text-color-assist mb-40&quot;&gt;</span><br><span class="line">                            您前面还有 &lt;text class&#x3D;&quot;text-color-primary mr-10 ml-10&quot;&gt;&#123;&#123;peopleNum&#125;&#125;&lt;&#x2F;text&gt; 单待制作</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;!-- goods begin --&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;w-100 d-flex flex-column position-relative mt-30&quot; style&#x3D;&quot;margin-bottom: -40rpx;&quot;&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;w-100 d-flex align-items-center mb-40&quot; v-for&#x3D;&quot;(good, index) in orderCurrent.goodsInOrder&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;d-flex flex-column w-60 overflow-hidden&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;font-size-lg text-color-base mb-10 text-truncate&quot;&gt;&#123;&#123; good.name &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;font-size-sm text-color-assist text-truncate&quot;&gt;&#123;&#123; good.property &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;view class&#x3D;&quot;d-flex w-40 align-items-center justify-content-between pl-30&quot;&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;font-size-base text-color-base&quot;&gt;x&#123;&#123; good.number &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                    &lt;view class&#x3D;&quot;font-size-base text-color-base font-weight-bold&quot;&gt;￥&#123;&#123; good.price &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                                &lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;!-- goods end --&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;section&quot;&gt;</span><br><span class="line">                &lt;!-- payment and amount begin --&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot; padding&#x3D;&quot;50rpx 30rpx&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                            &lt;view&gt;支付方式&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; payMethods &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                            &lt;view&gt;金额总计&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;￥&#123;&#123; orderCurrent.totalFee &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;!-- payment and amount end --&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;section&quot;&gt;</span><br><span class="line">                &lt;!-- order info begin --&gt;</span><br><span class="line">                &lt;list-cell :hover&#x3D;&quot;false&quot; padding&#x3D;&quot;50rpx 30rpx&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                            &lt;view&gt;下单时间&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; orderCurrent.createOrderTime &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                            &lt;view&gt;下单门店&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; orderCurrent.chooseStore&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                            &lt;view&gt;支付方式&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; payMethods &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                            &lt;view&gt;订单号&lt;&#x2F;view&gt;</span><br><span class="line">                            &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; orderCurrent.order_id &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;list-cell&gt;</span><br><span class="line">                &lt;!-- order info end --&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;!-- order other info begin --&gt;</span><br><span class="line">            &lt;list-cell :hover&#x3D;&quot;false&quot; padding&#x3D;&quot;50rpx 30rpx 20rpx&quot; last&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;w-100 d-flex flex-column&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                        &lt;view&gt;取单号&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; orderCurrent.sort_num &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                        &lt;view&gt;享用方式&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;自取&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                        &lt;view&gt;取餐时间&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;立即取餐&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                        &lt;view&gt;完成制作时间&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; orderCurrent.takeTime &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;pay-cell&quot;&gt;</span><br><span class="line">                        &lt;view&gt;备注&lt;&#x2F;view&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;font-weight-bold&quot;&gt;&#123;&#123; orderCurrent.remark &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;list-cell&gt;</span><br><span class="line">            &lt;!-- order other info end --&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure><h4 id="status值的转换"><a href="#status值的转换" class="headerlink" title="status值的转换"></a>status值的转换</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 数据初始化</span><br><span class="line">        init(id) &#123;</span><br><span class="line">            if(Object.keys(this.orderCurrent).length &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                return uniCloud.callFunction(&#123;</span><br><span class="line">                    name:&#39;order&#39;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        action:&#39;orderCurrent&#39;,</span><br><span class="line">                        order_id:id</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).then(res &#x3D;&gt; &#123;</span><br><span class="line">                    if(res.result.status &#x3D;&#x3D;&#x3D; 0 ) &#123;</span><br><span class="line">                        console.log(res)</span><br><span class="line">                        let result &#x3D; res.result</span><br><span class="line">                        this.SET_ORDERCURRENT(result.data)</span><br><span class="line">                        this.peopleNum &#x3D; result.current.peopleNum</span><br><span class="line">                        </span><br><span class="line">                    &#125; else if(res.result.status &#x3D;&#x3D;&#x3D; -1) &#123;</span><br><span class="line">                        uni.showModal(&#123;</span><br><span class="line">                            content:res.result.msg</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; else if(res.result.status &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">                        console.log(res)</span><br><span class="line">                        </span><br><span class="line">                        let result &#x3D; res.result</span><br><span class="line">                        this.SET_ORDERCURRENT(result.data)</span><br><span class="line">                        this.update(this.orderCurrent.order_id)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        update(id) &#123;</span><br><span class="line">            </span><br><span class="line">            return uniCloud.callFunction(&#123;</span><br><span class="line">                name:&#39;order&#39;,</span><br><span class="line">                data:&#123;</span><br><span class="line">                    action:&#39;orderUpdate&#39;,</span><br><span class="line">                    order_id:id,</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).then(res &#x3D;&gt; &#123;</span><br><span class="line">                console.log(res)</span><br><span class="line">                this.SET_ORDERCURRENTSTATUS(res.result)</span><br><span class="line">                if(res.result &#x3D;&#x3D;&#x3D; 6) &#123;</span><br><span class="line">                    this.CLEAR_ORDERCURRENT()</span><br><span class="line">                    uni.redirectTo(&#123;</span><br><span class="line">                        url:&#39;&#x2F;pages&#x2F;take-foods&#x2F;take-foods&#39;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>后端数据根据status状态返回不同数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line">&#39;use strict&#39;;</span><br><span class="line">const crypto &#x3D; require(&#39;crypto&#39;)</span><br><span class="line">const &#123;getOffsetDate,getNowFormatDate&#125; &#x3D; require(&#39;time&#39;)</span><br><span class="line">const db &#x3D; uniCloud.database()</span><br><span class="line">const _ &#x3D; db.command</span><br><span class="line">exports.main &#x3D; async (event, context) &#x3D;&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 判定 order 行为</span><br><span class="line">    if(event.action &#x3D;&#x3D; &#39;addTakein&#39;) &#123;</span><br><span class="line">        &#x2F;&#x2F; 获取openId和carts</span><br><span class="line">        const &#123;</span><br><span class="line">            openId,</span><br><span class="line">            goodsInOrder</span><br><span class="line">        &#125; &#x3D; event.data</span><br><span class="line">        </span><br><span class="line">        const uid &#x3D; openId</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 生成订单号</span><br><span class="line">        const order_id &#x3D; parseInt(Date.now() &#x2F; 1000) + crypto</span><br><span class="line">            .createHash(&#39;md5&#39;)</span><br><span class="line">            .update(uid, &#39;utf-8&#39;)</span><br><span class="line">            .digest(&#39;hex&#39;).substring(0, 8);</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 计算订单总金额</span><br><span class="line">        const totalFee &#x3D; goodsInOrder.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 门店位置</span><br><span class="line">        const chooseStore &#x3D; event.data.chooseStore</span><br><span class="line">        &#x2F;&#x2F; 生成订单</span><br><span class="line">        const orderResult &#x3D; await db.collection(&#39;orders&#39;).add(&#123;</span><br><span class="line">            uid, &#x2F;&#x2F;用户openid</span><br><span class="line">            order_id, &#x2F;&#x2F;用户和时间编译的订单号</span><br><span class="line">            order_type:0, &#x2F;&#x2F;0为自取订单,1为外卖</span><br><span class="line">            goodsInOrder, &#x2F;&#x2F;购物车列表</span><br><span class="line">            totalFee,  &#x2F;&#x2F;订单总价</span><br><span class="line">            chooseStore, &#x2F;&#x2F;选择的门店</span><br><span class="line">            status:1 &#x2F;&#x2F;1为未支付,2为已经支付</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        if(!orderResult.id) &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                code:-3,</span><br><span class="line">                msg:&#39;提交订单失败,请稍后再试&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            return &#123;</span><br><span class="line">                order_id</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; else if(event.action &#x3D;&#x3D; &#39;addTakeout&#39;) &#123;</span><br><span class="line">          &#x2F;&#x2F;获取用户openId和goodsInOrder</span><br><span class="line">                const &#123;</span><br><span class="line">                    goodsInOrder,</span><br><span class="line">                    openId</span><br><span class="line">                &#125; &#x3D; event.data</span><br><span class="line">                &#x2F;&#x2F; 关联用户openId</span><br><span class="line">                const uid &#x3D; openId</span><br><span class="line">                &#x2F;&#x2F; 生成订单Id</span><br><span class="line">                const order_id &#x3D; parseInt(Date.now() &#x2F; 1000) + crypto</span><br><span class="line">                    .createHash(&#39;md5&#39;)</span><br><span class="line">                    .update(uid, &#39;utf-8&#39;)</span><br><span class="line">                    .digest(&#39;hex&#39;).substring(0, 8);</span><br><span class="line">                &#x2F;&#x2F; 计算总金额</span><br><span class="line">                const totalFee &#x3D; goodsInOrder.reduce((acc, cur) &#x3D;&gt; acc + cur.number * cur.price, 0) + 3</span><br><span class="line">                const order_address &#x3D; event.data.order_address</span><br><span class="line">                </span><br><span class="line">                const orderResult &#x3D; await db.collection(&#39;orders&#39;).add(&#123;</span><br><span class="line">                    uid,</span><br><span class="line">                    order_type:1, &#x2F;&#x2F; 1- 外卖订单</span><br><span class="line">                    order_id,</span><br><span class="line">                    goodsInOrder,</span><br><span class="line">                    totalFee,</span><br><span class="line">                    order_address,</span><br><span class="line">                    status: 1 &#x2F;&#x2F; 1 - 未支付，2 - 已支付</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                if (!orderResult.id) &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        code: -3,</span><br><span class="line">                        msg: &#39;创建订单失败，请稍后再试&#39;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                return &#123;</span><br><span class="line">                    order_id</span><br><span class="line">                &#125;</span><br><span class="line">    &#125; else if(event.action &#x3D;&#x3D; &#39;getOrder&#39;) &#123;</span><br><span class="line">        let order_id &#x3D; event.order_id</span><br><span class="line">        const resResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).get()</span><br><span class="line">        return resResult</span><br><span class="line">    &#125; else if(event.action &#x3D;&#x3D; &#39;orderCurrent&#39;) &#123;</span><br><span class="line">            let order_id &#x3D; event.order_id</span><br><span class="line">            &#x2F;&#x2F;查询当前订单status</span><br><span class="line">            const status &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(&#123;status:1&#125;)</span><br><span class="line">            .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                return res.data[0].status</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            if(status &#x3D;&#x3D;&#x3D; 2) &#123;</span><br><span class="line">                &#x2F;&#x2F;查询订单所属门店</span><br><span class="line">                const store &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(&#123;chooseStore:1&#125;)</span><br><span class="line">                .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                    return res.data[0].chooseStore</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;查询订单制作中status:3状态的订单数量</span><br><span class="line">                const num &#x3D; await db.collection(&#39;orders&#39;)</span><br><span class="line">                .where(&#123;</span><br><span class="line">                    status:3,</span><br><span class="line">                    chooseStore:store</span><br><span class="line">                &#125;)</span><br><span class="line">                .count().then(res &#x3D;&gt; &#123;</span><br><span class="line">                    return res.total</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;获取订单制作中的订单号</span><br><span class="line">                const currentId &#x3D; await db.collection(&#39;orders&#39;)</span><br><span class="line">                .where(&#123;</span><br><span class="line">                    status:3,</span><br><span class="line">                    chooseStore:store                </span><br><span class="line">                &#125;).field(&#123;order_id:1&#125;)</span><br><span class="line">                .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                    return res.data</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;生成下单时间,从支付完成开始算起</span><br><span class="line">                const time &#x3D; getOffsetDate(8)</span><br><span class="line">                const nowTime &#x3D; getNowFormatDate(time)</span><br><span class="line">                &#x2F;&#x2F;计算取餐时间 制作订单数量*2分钟</span><br><span class="line">                const nTime &#x3D; new Date(time.setMinutes(time.getMinutes() + num*2))</span><br><span class="line">                const takeTime &#x3D; getNowFormatDate(nTime)</span><br><span class="line">                &#x2F;&#x2F;生成取餐码</span><br><span class="line">                const code &#x3D; Math.floor(Math.random()*700 + 800)</span><br><span class="line">                &#x2F;&#x2F;更新数据</span><br><span class="line">                const updateResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).update(&#123;</span><br><span class="line">                    createOrderTime:nowTime,</span><br><span class="line">                    takeTime:takeTime,</span><br><span class="line">                    sort_num:code,</span><br><span class="line">                    status:3</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;field封装数据</span><br><span class="line">                const fields &#x3D; &#123;</span><br><span class="line">                                chooseStore:1,</span><br><span class="line">                                order_id:1,</span><br><span class="line">                                status:1,</span><br><span class="line">                                order_type:1,</span><br><span class="line">                                goodsInOrder:1,</span><br><span class="line">                                totalFee:1,</span><br><span class="line">                                remark:1,</span><br><span class="line">                                sort_num:1,</span><br><span class="line">                                payment_channel:1,</span><br><span class="line">                                createOrderTime:1,</span><br><span class="line">                                takeTime:1</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;查询封装数据类型输出</span><br><span class="line">                </span><br><span class="line">                const resResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(fields)</span><br><span class="line">                .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                    return res.data[0]</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                let current &#x3D; &#123;&#125;</span><br><span class="line">                current.currentId &#x3D; currentId</span><br><span class="line">                current.peopleNum &#x3D; num</span><br><span class="line">                </span><br><span class="line">                if(updateResult.id || updateResult.updated &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        &#39;status&#39;:0,</span><br><span class="line">                        &#39;data&#39;: resResult,</span><br><span class="line">                        &#39;current&#39;: current</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        &#39;status&#39;:-1,</span><br><span class="line">                        &#39;msg&#39;: &#39;后台数据错误&#39;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if(status &#x3D;&#x3D;&#x3D; 3 || status &#x3D;&#x3D;&#x3D;4 || status&#x3D;&#x3D;&#x3D;5) &#123;</span><br><span class="line">                &#x2F;&#x2F;field封装数据</span><br><span class="line">                const fields &#x3D; &#123;</span><br><span class="line">                                chooseStore:1,</span><br><span class="line">                                order_id:1,</span><br><span class="line">                                status:1,</span><br><span class="line">                                order_type:1,</span><br><span class="line">                                goodsInOrder:1,</span><br><span class="line">                                totalFee:1,</span><br><span class="line">                                remark:1,</span><br><span class="line">                                sort_num:1,</span><br><span class="line">                                payment_channel:1,</span><br><span class="line">                                createOrderTime:1,</span><br><span class="line">                                takeTime:1</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;查询封装数据类型输出</span><br><span class="line">                </span><br><span class="line">                const resResult &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(fields)</span><br><span class="line">                .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">                    return res.data[0]</span><br><span class="line">                &#125;)</span><br><span class="line">                    </span><br><span class="line">                    return &#123;</span><br><span class="line">                        &#39;status&#39;:1,</span><br><span class="line">                        &#39;data&#39;: resResult</span><br><span class="line">                    &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">    &#125;  else if(event.action &#x3D;&#x3D;&#x3D; &#39;orderUpdate&#39;) &#123;</span><br><span class="line">        let order_id &#x3D; event.order_id</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;查询当前订单status</span><br><span class="line">        const status &#x3D; await db.collection(&#39;orders&#39;).where(&#123;order_id&#125;).field(&#123;status:1&#125;)</span><br><span class="line">        .get().then(res &#x3D;&gt; &#123;</span><br><span class="line">            return res.data[0].status</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        return status</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;项目介绍以及基础配置&quot;&gt;&lt;a href=&quot;#项目介绍以及基础配置&quot; class=&quot;headerlink&quot; title=&quot;项目介绍以及基础配置&quot;&gt;&lt;/a&gt;项目介绍以及基础配置&lt;/h3&gt;&lt;h4 id=&quot;uni-app介绍&quot;&gt;&lt;a href=&quot;#uni-app介绍&quot; c
      
    
    </summary>
    
    
      <category term="实战课程" scheme="http://weimumu.top/categories/%E5%AE%9E%E6%88%98%E8%AF%BE%E7%A8%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>Hexo-theme-butterfly修改调整教程</title>
    <link href="http://weimumu.top/2020/ckfi3nyx10001u0nleuk123uv/"/>
    <id>http://weimumu.top/2020/ckfi3nyx10001u0nleuk123uv/</id>
    <published>2020-08-07T01:29:13.000Z</published>
    <updated>2020-08-07T23:41:16.063Z</updated>
    
    <content type="html"><![CDATA[<h3 id="修改备案"><a href="#修改备案" class="headerlink" title="修改备案"></a>修改备案</h3><p>1.修改主题配置文件<code>themes/Butterfly/_config.yml</code>的<code>ICP</code>属性，为其添加国徽图标的路径<code>pic</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ICP: # Chinese ICP License</span><br><span class="line">   enable: true</span><br><span class="line">   url: http:&#x2F;&#x2F;www.beian.gov.cn</span><br><span class="line">   text: 湘ICP备16002296号</span><br><span class="line">   icon: &#x2F;img&#x2F;icp.png</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;修改备案&quot;&gt;&lt;a href=&quot;#修改备案&quot; class=&quot;headerlink&quot; title=&quot;修改备案&quot;&gt;&lt;/a&gt;修改备案&lt;/h3&gt;&lt;p&gt;1.修改主题配置文件&lt;code&gt;themes/Butterfly/_config.yml&lt;/code&gt;的&lt;code&gt;ICP&lt;
      
    
    </summary>
    
    
      <category term="Hexo" scheme="http://weimumu.top/categories/Hexo/"/>
    
    
  </entry>
  
  <entry>
    <title>hexo创建分类和tag</title>
    <link href="http://weimumu.top/2020/ckfi3nyxd0005u0nlefoha35r/"/>
    <id>http://weimumu.top/2020/ckfi3nyxd0005u0nlefoha35r/</id>
    <published>2020-08-07T00:22:24.000Z</published>
    <updated>2020-08-07T03:51:30.367Z</updated>
    
    <content type="html"><![CDATA[<p>在themes _config.yml 中设置menu 的home和categories</p><p>使导航有分类和首页</p><h4 id="1-创建“分类”选项"><a href="#1-创建“分类”选项" class="headerlink" title="1. 创建“分类”选项"></a>1. 创建“分类”选项</h4><p>生成“分类”页并添加tpye属性,进入博客目录。执行命令下方命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page categories</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>categories文件夹下会有index.md这个文件，打开后默认内容是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">title: categories</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>添加type: “categories”到内容中，添加后是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">title: 分类</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type: categories</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并关闭文件。</p><p>给文章添加“categories”属性</p><p>打开需要添加分类的文章，为其添加categories属性。下方的categories:Hexo表示这篇文章添加到到“Hexo”这个分类。注意：一篇文章只会添加到一个分类中，如果是多个默认放到第一个分类中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">title: Hexo 添加分类及标签</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">categories: Hexo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。</p><h4 id="2-创建“标签”选项"><a href="#2-创建“标签”选项" class="headerlink" title="2. 创建“标签”选项"></a>2. 创建“标签”选项</h4><p>生成“标签”页并添加tpye属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page tags</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在tags文件夹下，找到index.md这个文件，打开后默认内容是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">title: 标签</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>添加type: “tags”到内容中，添加后是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">title: 标签</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type: tags</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并关闭文件。</p><p>给文章添加“tags”属性,打开需要添加标签的文章，为其添加tags属性。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">title: Hexo 添加分类及标签</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">date: 2019-04-24 15:40:24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">categories: </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           - Hexo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tags:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           - 博客</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在themes _config.yml 中设置menu 的home和categories&lt;/p&gt;
&lt;p&gt;使导航有分类和首页&lt;/p&gt;
&lt;h4 id=&quot;1-创建“分类”选项&quot;&gt;&lt;a href=&quot;#1-创建“分类”选项&quot; class=&quot;headerlink&quot; title=&quot;1. 
      
    
    </summary>
    
    
      <category term="Hexo" scheme="http://weimumu.top/categories/Hexo/"/>
    
    
  </entry>
  
  <entry>
    <title>hexo+github从0开始创建个人博客</title>
    <link href="http://weimumu.top/2020/ckfi3nyxb0004u0nl88xzbmw6/"/>
    <id>http://weimumu.top/2020/ckfi3nyxb0004u0nl88xzbmw6/</id>
    <published>2020-08-06T09:02:23.000Z</published>
    <updated>2020-08-11T10:57:37.989Z</updated>
    
    <content type="html"><![CDATA[<div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="//player.bilibili.com/player.html?aid=711630848&bvid=BV1zD4y1U7za&cid=221376924&page=1&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;"> </iframe></div><h3 id="第一步：下载并安装nodejs"><a href="#第一步：下载并安装nodejs" class="headerlink" title="第一步：下载并安装nodejs"></a>第一步：下载并安装nodejs</h3><p>下载地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;nodejs.org&#x2F;en&#x2F;</span><br></pre></td></tr></table></figure><p>验证是否安装成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><h3 id="第二步：-安装cnpm"><a href="#第二步：-安装cnpm" class="headerlink" title="第二步： 安装cnpm"></a>第二步： 安装cnpm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry&#x3D;&#x3D;https:&#x2F;&#x2F;registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>验证cnpm是否安装成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm -v</span><br></pre></td></tr></table></figure><h3 id="第三步：-安装hexo框架"><a href="#第三步：-安装hexo框架" class="headerlink" title="第三步： 安装hexo框架"></a>第三步： 安装hexo框架</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>安装后验证下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure><h3 id="第四步：初始化项目本地运行"><a href="#第四步：初始化项目本地运行" class="headerlink" title="第四步：初始化项目本地运行"></a>第四步：初始化项目本地运行</h3><p>dir创建一个文件夹hexo-blog，在当前文件夹下初始化hexo，并且本地运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;初始化项目</span><br><span class="line">hexo init</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;本地运行</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><h3 id="第五步：部署到github"><a href="#第五步：部署到github" class="headerlink" title="第五步：部署到github"></a>第五步：部署到github</h3><p>Github上新建repository</p><p>名称必须用github的username+.github.io</p><p>比如我的Git用户名为 calvin008,就起名为calvin008.github.io</p><p>安装部署工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure><p>在hexo-blog目录下_config.yml文件修改deploy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https:&#x2F;&#x2F;github.com&#x2F;calvin008&#x2F;calvin008.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p>这个时候执行两个命令就能自动部署</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure><p>查看</p><p>访问username.github.io即可</p><h3 id="第六步：绑定域名"><a href="#第六步：绑定域名" class="headerlink" title="第六步：绑定域名"></a>第六步：绑定域名</h3><p>ping calvin008.github.io</p><p>得到网址ip</p><p>绑定 到我万网域名解析</p><ul><li>万网的域名控制台，点击”域名和网站”中的”域名解析”</li><li>解析：<ul><li>记录类型选A 【ip地址】或CNAME【域名】</li><li>解析记录设置两个www和@</li><li>TTL指域名解析生效时间</li></ul></li></ul><h2 id><a href="#" class="headerlink" title></a></h2><p>新增 CNAME 文件</p><p>目录 hexo/source/CNAME</p><hr><p>在 github 上面，打开 <a href="http://username.github.io/">username.github.io</a> 项目的（Settings）设置，然后在 <code>GitHub Pages</code>的 <code>Custom domain</code>设置里填上购买的域名</p>]]></content>
    
    <summary type="html">
    
      
      
        

&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;
    &lt;iframe src=&quot;//player.bilibili.com/player.html?aid=7116
      
    
    </summary>
    
    
      <category term="Hexo" scheme="http://weimumu.top/categories/Hexo/"/>
    
    
  </entry>
  
</feed>
